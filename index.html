<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Targowisko Klanowe - Elite Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffd700;
            --gold-bright: #fff2a6;
            --bg: #0f0f0f;
            --card: #1a1a1a;
            --border: #332b00;
            --green: #2ecc71; --blue: #3498db; --red: #e74c3c;
            --purple: #9b59b6;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg);
            background-image: radial-gradient(circle at top, #1a1500 0%, #0f0f0f 100%);
            color: #eee;
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--border); padding-bottom: 20px; margin-bottom: 30px;
            flex-wrap: wrap; gap: 10px;
        }

        h1 { font-family: 'MedievalSharp', cursive; color: var(--gold); margin: 0; font-size: 2.5em; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); letter-spacing: 2px; }

        .login-btn {
            background: linear-gradient(to bottom, #fff, #ccc); color: #333; border: none; padding: 10px 20px;
            border-radius: 5px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 10px; 
            transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .user-profile { display: none; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 5px 15px; border-radius: 50px; border: 1px solid var(--border); }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--gold); }
        .logout-link { color: #ff6666; font-size: 0.75em; text-decoration: none; cursor: pointer; text-transform: uppercase; font-weight: bold; }

        .filters { display: flex; gap: 10px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap; align-items: center; }
        .filter-btn {
            background: #222; color: #888; border: 1px solid #444; padding: 8px 16px; 
            border-radius: 5px; cursor: pointer; transition: 0.3s; font-family: 'MedievalSharp'; font-size: 1em;
        }
        .filter-btn:hover { border-color: var(--gold); color: #fff; }
        .filter-btn.active { background: var(--gold); color: #000; border-color: var(--gold-bright); }

        .panel {
            background: var(--card); padding: 25px; border-radius: 12px; border: 1px solid var(--border);
            margin-bottom: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); display: none;
        }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: 1 / -1; }

        input, select, textarea {
            background: #0a0a0a; border: 1px solid #333; color: white;
            padding: 12px; border-radius: 6px; width: 100%; box-sizing: border-box; outline: none;
        }
        
        .search-box { background: #151500; border-color: var(--border); color: var(--gold); }

        .action-btn {
            background: linear-gradient(to bottom, #ffd700, #b89b00); color: #000; border: none; padding: 15px;
            font-weight: 800; width: 100%; cursor: pointer; border-radius: 6px; text-transform: uppercase; transition: 0.3s;
        }

        .offers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }

        .offer-card {
            background: #181818; border: 1px solid #2a2a2a; border-radius: 10px; padding: 20px; 
            position: relative; transition: 0.4s; display: flex; flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .offer-card:hover { transform: translateY(-5px); border-color: var(--gold); }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .tag { padding: 4px 10px; border-radius: 4px; font-size: 0.7em; font-weight: 800; text-transform: uppercase; }
        .tag.sprzedam { background: var(--green); color: #000; }
        .tag.kupie { background: var(--blue); color: #fff; }
        .tag.zamienie { background: var(--red); color: #fff; }

        .item-title { font-size: 1.1em; font-weight: bold; color: var(--gold); line-height: 1.2; flex-grow: 1; }
        .item-img { width: 60px; height: 60px; object-fit: contain; filter: drop-shadow(0 0 5px rgba(255,215,0,0.3)); }
        
        .item-source { 
            font-size: 0.85em; color: #cca3ff; margin: 12px 0; display: flex; align-items: center; gap: 10px;
            background: rgba(155, 89, 182, 0.1); padding: 8px; border-radius: 6px; border: 1px solid rgba(155,89,182,0.2);
        }
        .item-source img { height: 35px; width: auto; }

        .price-tag { font-size: 1.3em; color: #fff; font-weight: bold; margin: 10px 0; }
        .price-tag span { color: var(--gold); }

        .reservation-box {
            background: rgba(46, 204, 113, 0.15); border: 1px dashed var(--green);
            padding: 8px; border-radius: 6px; margin: 10px 0; font-size: 0.8em; color: var(--green);
            display: flex; align-items: center; gap: 8px;
        }

        .seller-info { margin-top: auto; padding-top: 15px; border-top: 1px dotted #444; display: flex; align-items: center; justify-content: space-between; font-size: 0.85em; }
        .seller-left { display: flex; align-items: center; gap: 10px; }
        .tiny-avatar { width: 28px; height: 28px; border-radius: 50%; border: 1px solid var(--gold); }

        .btn-group { display: flex; gap: 5px; }
        .small-btn { padding: 4px 8px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.7em; border: 1px solid transparent; }
        .reserve-btn { background: var(--green); color: #000; }
        .unreserve-btn { background: #444; color: #fff; }
        .edit-added { border: 1px solid var(--gold); color: var(--gold); background: none; }
        .delete-btn { background: #333; color: #888; }

        .preview-box {
            grid-column: 1 / -1; display: none; align-items: center; justify-content: space-between; 
            flex-direction: row-reverse; background: linear-gradient(270deg, #251f00 0%, #1a1a1a 100%);
            border: 2px solid var(--gold); padding: 15px 25px; border-radius: 12px; margin: 10px 0;
        }
        .preview-content { display: flex; flex-direction: column; align-items: flex-start; }
        .preview-text { font-size: 1.4em; color: var(--gold); font-family: 'MedievalSharp'; }
        .preview-icon-wrapper { background: radial-gradient(circle, #333 0%, #000 100%); padding: 8px; border-radius: 10px; border: 1px solid var(--gold); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>锔 Targowisko Kondor Airlines</h1>
        <button id="googleLoginBtn" class="login-btn">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/pwa_googleg_color_64dp.png" width="18">
            Zaloguj przez Google
        </button>
        <div id="userProfile" class="user-profile">
            <img id="userAvatar" class="user-avatar" src="" alt="">
            <div>
                <div id="userNickDisplay" style="font-weight:bold; color:var(--gold); font-size:0.9em;">...</div>
                <div class="logout-link" onclick="logout()">Wyloguj</div>
            </div>
        </div>
    </header>

    <div class="filters">
        <button class="filter-btn active" id="f-all" onclick="setFilter('type', 'all')">Wszystkie</button>
        <button class="filter-btn" id="f-sprzedam" onclick="setFilter('type', 'sprzedam')">Sprzedam</button>
        <button class="filter-btn" id="f-kupie" onclick="setFilter('type', 'kupie')">Kupi</button>
        <span style="color:#444; margin: 0 10px;">|</span>
        <button class="filter-btn" id="f-herosi" onclick="setFilter('cat', 'herosi')">Herosi</button>
        <button class="filter-btn" id="f-e2" onclick="setFilter('cat', 'e2')">Elity II</button>
        <input type="text" id="globalSearch" class="search-box" placeholder=" Szukaj na targu..." oninput="renderOffers()" style="max-width: 200px; padding: 8px;">
    </div>
    
    <div id="offerStats" style="text-align:center; font-size:0.8em; color:#666; margin-bottom:20px;"></div>

    <div id="addOfferPanel" class="panel">
        <h3 style="margin-top:0; color:var(--gold); font-family:'MedievalSharp';">Wystaw Artefakt</h3>
        <div class="form-grid">
            <select id="offerType">
                <option value="sprzedam">Sprzedam</option>
                <option value="kupie">Kupi</option>
                <option value="zamienie">Zamieni</option>
            </select>
            <input type="text" id="itemPrice" placeholder="Cena (np. 150m)" maxlength="30">
            <select id="sourceCategory" class="full-width" onchange="updateSourceList()">
                <option value="">-- Wybierz Kategori --</option>
                <option value="herosi">Herosi</option>
                <option value="e2">Elity II</option>
            </select>
            <input type="text" id="sourceSearch" class="full-width search-box" placeholder=" Szukaj przeciwnika..." oninput="updateSourceList()" style="display:none;">
            <select id="itemSource" class="full-width" onchange="updateLootList()"><option value="">-- Przeciwnik --</option></select>
            <input type="text" id="itemSearch" class="full-width search-box" placeholder=" Szukaj przedmiotu..." oninput="updateLootList()" style="display:none;">
            <select id="itemSelect" class="full-width" onchange="fillItemDetails()"><option value="">-- Przedmiot --</option></select>
            <div id="livePreview" class="preview-box">
                <div class="preview-content"><span class="preview-label">Wybrany artefakt</span><span id="previewName" class="preview-text">...</span></div>
                <div class="preview-icon-wrapper"><img id="previewIcon" src="" alt="" style="width:55px; height:55px; display:block; object-fit: contain;"></div>
            </div>
            <div style="display:flex; gap:10px; align-items:center;" class="full-width">
                <input type="text" id="itemName" placeholder="Nazwa przedmiotu" maxlength="50">
                <button class="helper-btn" onclick="searchMargo()"></button>
            </div>
            <input type="text" id="itemImg" placeholder="Link do obrazka" class="full-width">
            <textarea id="itemDesc" placeholder="Dodatkowy opis..." class="full-width" maxlength="150" rows="2"></textarea>
            <button class="action-btn full-width" onclick="addOffer()">Opublikuj na Targu</button>
        </div>
    </div>

    <div id="offersList" class="offers-grid"></div>
</div>

<div id="editModal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div class="modal-content-full" style="background: #1a1a1a; padding: 30px; border: 2px solid #ffd700; border-radius: 15px; width: 95%; max-width: 600px;">
        <h3 style="color:#ffd700; font-family:'MedievalSharp'; margin-top:0;">Modyfikuj Ogoszenie</h3>
        <input type="text" id="fullEditName" placeholder="Nazwa" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
        <input type="text" id="fullEditPrice" placeholder="Cena" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
        <input type="text" id="fullEditImg" placeholder="Link do obrazka" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
        <textarea id="fullEditDesc" rows="4" placeholder="Opis" style="width:100%; background:#000; color:white; border:1px solid #444; padding:10px;"></textarea>
        <div style="display:flex; gap:15px; margin-top: 15px;">
            <button onclick="confirmFullEdit()" style="flex:2; background:#ffd700; padding:10px; cursor:pointer; font-weight:bold; border:none;">ZATWIERD殴</button>
            <button onclick="closeFullEdit()" style="flex:1; background:#333; color:white; padding:10px; cursor:pointer; border:none;">ANULUJ</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyApFYFkAghXreeX_xptg-PTCSxtPdiXYdA",
      authDomain: "targowisko-klanu.firebaseapp.com",
      projectId: "targowisko-klanu",
      storageBucket: "targowisko-klanu.firebasestorage.app",
      messagingSenderId: "1002027435908",
      appId: "1:1002027435908:web:56419c7bc38e148cf0ffd1"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    window.isValidImageUrl = (url) => url && /^https?:\/\/[^<>"]+\.(jpeg|jpg|gif|png|webp|bmp)$/i.test(url);
    const ADMIN_NICK = "Stachu Drzymaa";
    let currentUser = null;
    let currentNick = null;
    let allOffers = [];
    let currentFilters = { type: 'all', cat: 'all' };
    let currentEditId = null;

    const monstersList = {
        herosi: [
            { name: "Mroczny Patryk (35 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/bardzozlypatryk.gif" },
            { name: "Karmazynowy Mciciel (45 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/klanowe/heros_karm_msc.gif" },
            { name: "Zodziej (51 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/zlodziej.gif" },
            { name: "Zy Przewodnik (63 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/mnich-zly2.gif" },
            { name: "Optany Paladyn (74 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/opetanypaladyn02.gif" },
            { name: "Piekielny Kociej (85 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/piekielny_kosciej.gif" },
            { name: "Koziec Mciciel cie偶ek (94lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/koziec_maciciel_sciezek.gif" },
            { name: "Kochanka Nocy (102 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/kochanka-nocy.gif" },
            { name: "Ksi偶 Kasim (116 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/ksiaze-kasim.gif" },
            { name: "wity Braciszek (123 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/sw_braciszek.gif" },
            { name: "Zoty Roger (135 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/szkielet_pirata.gif" },
            { name: "Baca bez owiec (144 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/baca-bez-lowiec.gif" },
            { name: "Czarujca Atalia (157 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/czarujaca-atalia.gif" },
            { name: "Obkany owca Ork贸w (165 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/oblakany_ac1dae9d.gif" },
            { name: "Lichwiarz Grauhaz (177 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/lichwiarz_grauhaz.gif" },
            { name: "Viviana Nandin (185 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/viv_nandin_i3bd1.gif" },
            { name: "Przeraza (194 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/przeraza.gif" },
            { name: "Demonis Pan Nicoci (205 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/sekta_demon_cz_s.gif" },
            { name: "Mulher Ma (214 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/mulher_ma.gif" },
            { name: "Vapor Veneno (231 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/joziniec_bagienny.gif" },
            { name: "Dboro偶ec (244 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/zwierz_kniei.gif" },
            { name: "Tepeyollotl (258 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/tep_35ecb966.gif" },
            { name: "Widmo Triady (265 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/trist2_widmo_triady.gif" },
            { name: "Negthotep Czarny Kapan (271 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/negthotep.gif" },
            { name: "Mody Smok (282 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/smokbarb.gif" }
        ],
        e2: [
            { name: "Mushita", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/st-puma.gif" },
            { name: "Kotoak Tropiciel", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e1/kotolak_lowca.gif" },
            { name: "Shae Phu", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/demonszef.gif" },
            { name: "Zorg Jednooki Baron", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zbir-e2-zorg.gif" },
            { name: "Wadca Rzek", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gobmag2.gif" },
            { name: "Gobbos", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gobsamurai.gif" },
            { name: "Tyrtajos", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/dzik.gif" },
            { name: "Szczet alias Gadki", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zbir-szczet.gif" },
            { name: "Tollok Shimager", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tollok_shimger.gif" },
            { name: "Razuglag Oklash", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/razuglag.gif" },
            { name: "Agar", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/glut_agar.gif" },
            { name: "Foverk Turrim", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/kobold07.gif" },
            { name: "Owadzia Matka", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zadlak-e2-owadzia-matka.gif" },
            { name: "Vari Kruger", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnoll11.gif" },
            { name: "Furruk Kozug", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnoll12.gif" },
            { name: "Jotun", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/kam_olbrzym-b.gif" },
            { name: "Tollok Atamatu", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tollok_jask_atamatu.gif" },
            { name: "Lisz", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/lisz_demilisze.gif" },
            { name: "Grabarz witynny", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/nieu_mnich_grabarz.gif" },
            { name: "Pody zbrojmistrz", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/magaz_zbrojmistrz.gif" },
            { name: "Wielka Stopa", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wlochacze_wielka_stopa.gif" },
            { name: "Choukker", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/dlawiciel5.gif" },
            { name: "Nadzorczyni krasnolud贸w", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/nadzorczyni_krasnoludow.gif" },
            { name: "Morthen", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/krasnolud_boss.gif" },
            { name: "呕elazorki Ohydziarz", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/ugrape2.gif" },
            { name: "Lene Widmo", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/lesne_widmo.gif" },
            { name: "Goplana", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goplana.gif" },
            { name: "Gnom Figlid", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnom_figlid.gif" },
            { name: "Kambion", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/kambion.gif" },
            { name: "Jertek Moxos", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/moloch-jertek.gif" },
            { name: "Mionik owc贸w", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/blotniaki_milosnik_lowcow.gif" },
            { name: "Mionik rycerzy", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/blotniaki_milosnik_rycerzy.gif" },
            { name: "Mionik magii", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/blotniaki_milosnik_magii.gif" },
            { name: "owca czaszek", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/alghul-czaszka-1a.gif" },
            { name: "Ozirus Wadca Hieroglif贸w", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mumia-ozirus.gif" },
            { name: "Morski potw贸r", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/osmiornica-1b.gif" },
            { name: "Krab pustelnik", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/krab_big3.gif" },
            { name: "Borgoros Garamir III", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/ingotia_minotaur-7a.gif" },
            { name: "Stworzyciel", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/stworzyciel.gif" },
            { name: "Ifryt", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/magradit_ifryt.gif" },
            { name: "Henry Kaprawe Oko", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e1/pirat5b.gif" },
            { name: "Helga Opiekunka Rumu", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/pirat-2b.gif" },
            { name: "Mody Jack Truciciel", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/pirat01.gif" },
            { name: "Eol", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/piaskowy_potwor-6a.gif" },
            { name: "Grubber Ochlaj", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/grubber-ochlaj.gif" },
            { name: "Mistrz Worundriel", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/worundriel02.gif" },
            { name: "W贸jt Fistua", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goral-e2-wojt-fistula.gif" },
            { name: "Teciowa Rumcajsa", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goral-e2-tesciowa-rumcajsa.gif" },
            { name: "Berserker Amuno", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/amuno.gif" },
            { name: "Fodug Zolash", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/fodug_zolash.gif" },
            { name: "Sheba Orcza Szamanka", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/r_orc_sheba.gif" },
            { name: "Burkog Lorulk", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/orkczd.gif" },
            { name: "Duch Wadcy Klan贸w", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/duch_wladcy_kl.gif" },
            { name: "Bragarth Myliwy Dusz", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/praork_low_elita.gif" },
            { name: "Fursharag Po偶eracz Umys贸w", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/praork_mag_elita.gif" },
            { name: "Ziuggrael Stra偶nik Kr贸lowej", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/praork_woj_elita.gif" },
            { name: "Kr贸lowa niegu", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/krolowa-sniegu.gif" },
            { name: "Lusgrathera Kr贸lowa Pramatka", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/prakrolowa.gif" },
            { name: "Wrzosera", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wrzosera-1b.gif" },
            { name: "Chryzoprenia", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/chryzoprenia-1a.gif" },
            { name: "Cantedewia", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/cantedewia-1a.gif" },
            { name: "Ogr Stalowy Pazur", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/ogr_stalowy_pazur-1a.gif" },
            { name: "Toruia Ankelwald", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/thuz-patr1.gif" },
            { name: "Piknotka Miso偶erna", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zmutowana-roslinka.gif" },
            { name: "Breheret 呕elazny eb", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/draki-breheret-1b.gif" },
            { name: "Cerasus", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/cerasus-1a.gif" },
            { name: "Mysiur Mywi贸rowy Kr贸l", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mysiur_myswiorowy_krol-1a.gif" },
            { name: "Sadolia Nadzorczyni Hurys", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-sadolia.gif" },
            { name: "Bergermona Krwawa Hrabina", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-bergermona.gif" },
            { name: "Sataniel Skrytob贸jca", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-sataniel.gif" },
            { name: "Annaniel Wysysacz Marze", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-annaniel.gif" },
            { name: "Gothardus Kolekcjoner G贸w", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-gothardus.gif" },
            { name: "Zufulus Smakosz Serc", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-zufulus.gif" },
            { name: "Czempion Furboli", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/forbol03.gif" },
            { name: "Arachniregina Colosseus", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/regina-e2.gif" },
            { name: "Al'diphrin Ilythirahel", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/drow-aldiphrin-wladca.gif" },
            { name: "Marlloth Malignitas", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/drider-marlloth.gif" },
            { name: "Arytodam olbrzymi", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/arytodam_olbrzymi-1b.gif" },
            { name: "Mocny Maddoks", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mocny_maddoks-1a.gif" },
            { name: "Fangaj", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/grzyb-humanoid-1b.gif" },
            { name: "Dendroculus", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/dendroculus.gif" },
            { name: "Tolypeutes", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/bolita.gif" },
            { name: "Cuaitl Citlalin", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/maho-cuaitl.gif" },
            { name: "Yaotl", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mahoplowca.gif" },
            { name: "Quetzalcoatl", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/quetzalcoatl-1a.gif" },
            { name: "Wabicielka", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/trist2_wabicielka-1a.gif" },
            { name: "Pogardliwa Sybilla", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tri2_witch_e2.gif" },
            { name: "Chopesz", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/chopesh2.gif" },
            { name: "Neferkar Set", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/szkiel_set.gif" },
            { name: "Chaegd Agnrakh", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/bar_smokoszef.gif" },
            { name: "Vaenra Charkhaam", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/bar_smoczyca.gif" },
            { name: "Terrozaur", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/terrorzaur_pus.gif" },
            { name: "Nymphemonia", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/nymphemonia.gif" },
            { name: "Zorin", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wl-mrozu01.gif" },
            { name: "Furion", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wl-mrozu02.gif" },
            { name: "Artenius", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wl-mrozu03.gif" }
        ]
    };

    const lootTable = {
        "Mroczny Patryk (35 lvl)": [{img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm749.gif", stats: "Kapelusz wiecznej udrki||rarity=legendary"},{img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm748.gif", stats: "Splot szalestwa||rarity=legendary"},{img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1365.gif", stats: "Korona taczcych pomieni||rarity=legendary"},{img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy||rarity=legendary"}],
        "Mushita": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien361.gif", stats: "Nimb emanujcego ka||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka lodowej mocy||rarity=legendary" }],
        "Kotoak Tropiciel": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm721.gif", stats: "Maska dziewiciu 偶ywot贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm720.gif", stats: "Kamufla偶 przyczajonego kocura||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm719.gif", stats: "Kask wied藕miego chowaca||rarity=legendary" }],
        "Shae Phu": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1243.gif", stats: "Czaszka Przeznaczenia||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice805.gif", stats: "Nekromantki cmentarnej dziewicy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice806.gif", stats: "Szpony Ciemnego Varga||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Lekka skrytka fizycznej mocy||rarity=legendary" }],
        "Zorg Jednooki Baron": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1203.gif", stats: "Obuwie upadego barona||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1205.gif", stats: "Magiczne ci偶emki Zorga||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1204.gif", stats: "Buciory lidera szajki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy||rarity=legendary" }],
        "Wadca Rzek": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien836.gif", stats: "Studnia 呕ycze||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien837.gif", stats: "Klejnot Wielkich Jezior||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien835.gif", stats: "Rzeka Marze||rarity=legendary" }],
        "Adariel": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1194.gif", stats: "Wied藕mi apacz sn贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1242.gif", stats: "Piecz czarnej magii||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1193.gif", stats: "Ampuka brzydoty||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy||rarity=legendary" }],
        "Goons Asterus": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1352.gif", stats: "System celowniczy Asterusa||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1185.gif", stats: "Gobliskie ustrojstwo||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/torba53.gif", stats: "Wielofunkcyjna torba goblina||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy||rarity=legendary" }],
        "Fodug Zolash": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1209.gif", stats: "Sygnet aski i zawahania||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1208.gif", stats: "Piecz pana twierdzy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1274.gif", stats: "Krwawe dyrygentki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy||rarity=legendary" }],
        "Sheba Orcza Szamanka": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1199.gif", stats: "殴r贸do wielkiego nieszczcia||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1198.gif", stats: "Przebudzone lepie demona||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1199.gif", stats: "Miniaturowy portal||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy||rarity=legendary" }],
        "Burkog Lorulk": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1208.gif", stats: "Odrbana do Burkoga||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1099.gif", stats: "Skarb praorczej dynastii||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1259.gif", stats: "Wyraz olbrzymiej pogardy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy||rarity=legendary" }],
        "Duch Wadcy Klan贸w": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1350.gif", stats: "Maska orczej wyroczni||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1349.gif", stats: "Odznaczenie smokobija||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1348.gif", stats: "Przybica wielkiego zaszczytu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy||rarity=legendary" }],
        "Bragarth Myliwy Dusz": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik631.gif", stats: "Kolia owcy Dusz||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien627.gif", stats: "Bysk smoczego oka||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy||rarity=legendary" }],
        "Fursharag Po偶eracz Umys贸w": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik636.gif", stats: "Ozdoba Po偶eracza Umys贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm564.gif", stats: "Esencja smoczej t偶yzny||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy||rarity=legendary" }],
        "Ziuggrael Stra偶nik Kr贸lowej": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice644.gif", stats: "Rkawice ze smoczej sk贸ry||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik635.gif", stats: "Naszyjnik Kr贸lewskiego Stra偶nika||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy||rarity=legendary" }],
        "Kr贸lowa niegu": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1230.gif", stats: "Skostniae paluchy monarchini||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1231.gif", stats: "Ucisk nieskoczonej nie偶ycy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1314.gif", stats: "Nienawistny chwyt kr贸lowej||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy||rarity=legendary" }],
        "Lusgrathera Kr贸lowa Pramatka": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien638.gif", stats: "Ukryta potga praork贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien637.gif", stats: "Kr贸lewski piercie pramatki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy||rarity=legendary" }],
        "Wrzosera": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1270.gif", stats: "Wrzosowa plecionka driady||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty686.gif", stats: "wita Dbina||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1403.gif", stats: "Przybica pani wrzosowisk||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy||rarity=legendary" }],
        "Chryzoprenia": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1264.gif", stats: "Pk Wabiciel||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1402.gif", stats: "Chryzantemowy diadem||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1225.gif", stats: "Cholewy lenej monarchii||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy||rarity=legendary" }],
        "Cantedewia": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1224.gif", stats: "Bezszelestny ch贸d mch贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1401.gif", stats: "Korona 偶yciodajnych kalii||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal109.gif", stats: "wite kwiecie driad||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy||rarity=legendary" }],
        "Ogr Stalowy Pazur": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1246.gif", stats: "Stalowe piecideko||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1382.gif", stats: "Hem ogrzego szalestwa||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1218.gif", stats: "Buciory krwawego obdu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Skrytka lodowej mocy||rarity=legendary" }],
        "Toruia Ankelwald": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1272.gif", stats: "Zoty ksi偶yc Ankelwald贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik722.gif", stats: "Osiem N贸g Fortuny||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik723.gif", stats: "Oko Opatrznoci||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy||rarity=legendary" }],
        "Piknotka Miso偶erna": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1263.gif", stats: "Wonne kwiecie dezynfekcji||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1262.gif", stats: "Trio miso偶ernych pk贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1264.gif", stats: "Pikno peni rozkwitu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy||rarity=legendary" }],
        "Breheret 呕elazny eb": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1410.gif", stats: "呕elazna Twarz||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1392.gif", stats: "Krwawa szczka Valmira||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1318.gif", stats: "Dekapitorki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy||rarity=legendary" }],
        "Cerasus": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1259.gif", stats: "殴r贸do lenego mroku||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1220.gif", stats: "Pnie wymuszonej symbiozy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1219.gif", stats: "Cholewy krwawego przebudzenia||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy||rarity=legendary" }],
        "Mysiur Mywi贸rowy Kr贸l": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1221.gif", stats: "Szczuroapki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1223.gif", stats: "Pantofle opasego gryzonia||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1222.gif", stats: "Mywi贸rowe kaprysy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy||rarity=legendary" }],
        "Sadolia Nadzorczyni Hurys": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik684.gif", stats: "Tchnienie Nagej Grozy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik683.gif", stats: "Podmuch Wiecznie Potpionych||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik682.gif", stats: "Piekielny Nietoperz||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Skrytka lodowej mocy||rarity=legendary" }],
        "Bergermona Krwawa Hrabina": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien697.gif", stats: "Piercie Mistrzyni Tortur||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1404.gif", stats: "Nawiedzona chusta hrabiny||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/pie/pierscien694.gif", stats: "Do Diaba||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ci偶ka skrytka elektrycznej mocy||rarity=legendary" }],
        "Sataniel Skrytob贸jca": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1316.gif", stats: "Szpon krwawych przesucha||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1313.gif", stats: "acuchy ujarzmiania demon贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1317.gif", stats: "Kryj贸wka demonicznych sugestii||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ci偶ka skrytka jadowej mocy||rarity=legendary" }],
        "Annaniel Wysysacz Marze": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien699.gif", stats: "Szpon Bahaala||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien695.gif", stats: "Ozdoba Piekielnego Portalu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal69.gif", stats: "Przenony otarz Annaniela||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ci偶ka skrytka ognistej mocy||rarity=legendary" }],
        "Gothardus Kolekcjoner G贸w": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty679.gif", stats: "Powolny Puls Demona||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien698.gif", stats: "Pomie 呕ywnej Wiary||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien696.gif", stats: "Kociany Stra偶nik||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ci偶ka skrytka stalowej mocy||rarity=legendary"}],
        "Zufulus Smakosz Serc": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm617.gif", stats: "Korona Wiecznej Gehenny||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm616.gif", stats: "Maska Smakosza Serc||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm615.gif", stats: "Diadem Tysica wiec||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Ci偶ka skrytka lodowej mocy||rarity=legendary" }],
        "Czempion Furboli": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1265.gif", stats: "wiato odstraszajce pajki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1271.gif", stats: "Medalion doskonaoci||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1315.gif", stats: "Dziedzictwo linii czempion贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ci偶ka skrytka stalowej mocy||rarity=legendary" }],
        "Arachniregina Colosseus": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1343.gif", stats: "Stalowe pajki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1342.gif", stats: "Pici zawodowego bohatera||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1344.gif", stats: "Municie powiewajcych pajczyn||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ci偶ka skrytka jadowej mocy||rarity=legendary" }],
        "Al'diphrin Ilythirahel": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1342.gif", stats: "Podeszwy uzurpatora||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1341.gif", stats: "up z Tass Zhil||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1343.gif", stats: "Cholewy chwilowej ekscytacji||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ci偶ka skrytka elektrycznej mocy||rarity=legendary" }],
        "Marlloth Malignitas": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1441.gif", stats: "Wspomnienie sromotnej pora偶ki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1333.gif", stats: "Stukot historii||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1442.gif", stats: "Magazyn si chaosu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ci偶ka skrytka ognistej mocy||rarity=legendary" }],
        "Arytodam olbrzymi": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1357.gif", stats: "Pokraczne apy Arytodama||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1356.gif", stats: "Klamry degradacji rodowiska||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1355.gif", stats: "Kajdany bagiennego bulgotania||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Ci偶ka skrytka lodowej mocy||rarity=legendary" }],
        "Mocny Maddoks": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1452.gif", stats: "Stary 呕abiec||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1453.gif", stats: "Smakosz Ambrozji Maddok贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1451.gif", stats: "Genealogiczne Algi||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Ci偶ka skrytka lodowej mocy||rarity=legendary" }],
        "Fangaj": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1366.gif", stats: "殴r贸do grzybowej zarazy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1368.gif", stats: "Sznur psylocybk贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1367.gif", stats: "Najbardziej wyjtkowy okaz||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ci偶ka skrytka elektrycznej mocy||rarity=legendary" }],
        "Dendroculus": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1383.gif", stats: "呕ywiczne korzonki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1342.gif", stats: "Oculus||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1382.gif", stats: "Konarowce||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ci偶ka skrytka jadowej mocy||rarity=legendary" }],
        "Tolypeutes": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1404.gif", stats: "Rkawice ze sk贸ry Tolypeutesa||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1402.gif", stats: "Mankiety obrocy bog贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1403.gif", stats: "Gest Teomama||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ci偶ka skrytka stalowej mocy||rarity=legendary" }],
        "Cuaitl Citlalin": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1365.gif", stats: "Sygnet z koci konkwistador贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1366.gif", stats: "Ollin||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ci偶ka skrytka ognistej mocy||rarity=legendary" }],
        "Yaotl": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm420.gif", stats: "Pozacana podobizna b贸stwa||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm419.gif", stats: "Pomienna maska kapana||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm418.gif", stats: "Czaszka Huitzilopochtli||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ci偶ka skrytka jadowej mocy||rarity=legendary" }],
        "Quetzalcoatl": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1400.gif", stats: "Wyobra偶enie Mictlantecuhtliego||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1401.gif", stats: "Stpanie Dw贸ch Soc||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1402.gif", stats: "Cholewy boskiego lnienia||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Ci偶ka skrytka lodowej mocy||rarity=legendary" }],
        "Wabicielka": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1375.gif", stats: "Zal偶ek Chaosu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1414.gif", stats: "Szaowe pazury Wabicielki||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1413.gif", stats: "Do wadcy podziemi||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ci偶ka skrytka stalowej mocy||rarity=legendary" }],
        "Pogardliwa Sybilla": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1423.gif", stats: "Wszechstronne obcasy Sybilli||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1422.gif", stats: "Pantofle infiltracji umys贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1421.gif", stats: "Buciory wied藕miej potgi||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ci偶ka skrytka ognistej mocy||rarity=legendary" }],
        "Chopesz": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ci偶ka skrytka stalowej mocy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty514.gif", stats: "Lazur w贸d Wernoradu||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty515.gif", stats: "Bojowe obuwie Chopesza||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty516.gif", stats: "Skarb antycznych||rarity=legendary" }],
        "Neferkar Set": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ci偶ka skrytka elektrycznej mocy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/set_but3.gif", stats: "Magia mrocznego Seta||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/set_but2.gif", stats: "Furia pot偶nego Seta||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/set_but1.gif", stats: "Niezomno bezlitosnego Seta||rarity=legendary" }],
        "Chaegd Agnrakh": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ci偶ka skrytka jadowej mocy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik736.gif", stats: "Obro偶a Przeistoczenia||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyj446.gif", stats: "Klejnot kr贸lewski||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien201.gif", stats: "Kryszta w obrczce Agnrakha||rarity=legendary" }],
        "Vaenra Charkhaam": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ci偶ka skrytka elektrycznej mocy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik447.gif", stats: "Klejnot witynny||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien197.gif", stats: "Kryszta w obrczce Vaenry||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty731.gif", stats: "Smocze Kroki||rarity=legendary" }],
        "Terrozaur": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ci偶ka skrytka ognistej mocy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice580.gif", stats: "Ucisk wirujcych piask贸w||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice581.gif", stats: "Pancerna pi wojownika Shaiharrud||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice579.gif", stats: "Szpony gadzik je藕d藕c贸w||rarity=legendary" }],
        "Nymphemonia": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif.gif", stats: "Ci偶ka skrytka lodowej mocy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik700.gif", stats: "Skarb Kr贸lestwa Driad||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice711.gif", stats: "Palce wymuszonej symbiozy||rarity=legendary" }, { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice712.gif", stats: "Szpony lenego runa||rarity=legendary" }],
        "Zorin": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ci偶ka skrytka stalowej mocy||rarity=legendary" }],
        "Furion": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ci偶ka skrytka jadowej mocy||rarity=legendary" }],
        "Artenius": [{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ci偶ka skrytka ognistej mocy||rarity=legendary" }]
    };

function escapeHtml(text) { return text ? text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") : ""; }

    window.setFilter = (type, val) => {
        if (type === 'cat' && currentFilters.cat === val) currentFilters.cat = 'all';
        else currentFilters[type] = val;
        
        document.querySelectorAll('.filter-btn').forEach(b => {
            const id = b.id.replace('f-', '');
            if (type === 'type' && ['all','sprzedam','kupie'].includes(id)) b.classList.toggle('active', id === currentFilters.type);
            if (type === 'cat' && ['herosi','e2'].includes(id)) b.classList.toggle('active', id === currentFilters.cat);
        });
        window.renderOffers();
    };

    window.updateSourceList = () => {
        const cat = document.getElementById('sourceCategory').value;
        const sel = document.getElementById('itemSource');
        const search = document.getElementById('sourceSearch');
        if(!cat) { search.style.display = 'none'; return; }
        search.style.display = 'block';
        sel.innerHTML = '<option value="">-- Przeciwnik --</option>';
        monstersList[cat].filter(m => m.name.toLowerCase().includes(search.value.toLowerCase())).forEach(m => {
            let o = document.createElement('option'); o.value = m.name; o.dataset.img = m.img; o.innerText = m.name; sel.appendChild(o);
        });
    };

    window.updateLootList = () => {
        const src = document.getElementById('itemSource').value;
        const sel = document.getElementById('itemSelect');
        const search = document.getElementById('itemSearch');
        if(!src || !lootTable[src]) { search.style.display = 'none'; sel.style.display = 'none'; return; }
        search.style.display = 'block'; sel.style.display = 'block';
        sel.innerHTML = '<option value="">-- Przedmiot --</option>';
        lootTable[src].filter(i => i.stats.split('||')[0].toLowerCase().includes(search.value.toLowerCase())).forEach(i => {
            let o = document.createElement('option'); o.value = JSON.stringify(i); o.innerText = i.stats.split('||')[0]; sel.appendChild(o);
        });
    };

    window.fillItemDetails = () => {
        const val = document.getElementById('itemSelect').value;
        if(!val) return;
        const data = JSON.parse(val);
        const name = data.stats.split('||')[0];
        document.getElementById('itemName').value = name;
        document.getElementById('itemImg').value = data.img;
        document.getElementById('livePreview').style.display = 'flex';
        document.getElementById('previewIcon').src = data.img;
        document.getElementById('previewName').innerText = name;
    };

    onAuthStateChanged(auth, async (user) => {
        currentUser = user;
        if(user) {
            const ref = doc(db, "users", user.uid);
            const snap = await getDoc(ref);
            if(snap.exists()) currentNick = snap.data().nick;
            else {
                let n = prompt("Tw贸j nick:");
                if(n) { currentNick = n; await setDoc(ref, {nick:n}); } else await signOut(auth);
            }
            document.getElementById('googleLoginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';
            document.getElementById('addOfferPanel').style.display = 'block';
            document.getElementById('userNickDisplay').innerText = currentNick;
            document.getElementById('userAvatar').src = user.photoURL;
        } else {
            document.getElementById('googleLoginBtn').style.display = 'flex';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('addOfferPanel').style.display = 'none';
        }
        window.renderOffers();
    });

    window.renderOffers = () => {
        const list = document.getElementById('offersList');
        const search = document.getElementById('globalSearch').value.toLowerCase();
        list.innerHTML = "";
        let count = 0;
        allOffers.forEach(data => {
            const isHeros = monstersList.herosi.some(m => m.name === data.source);
            const isE2 = monstersList.e2.some(m => m.name === data.source);
            if(currentFilters.type !== 'all' && data.type !== currentFilters.type) return;
            if(currentFilters.cat === 'herosi' && !isHeros) return;
            if(currentFilters.cat === 'e2' && !isE2) return;
            if(!data.name.toLowerCase().includes(search)) return;
            count++;
            const isOwner = currentUser && data.userId === currentUser.uid;
            const isAdmin = currentNick === ADMIN_NICK;
            let resHtml = data.reservedBy ? `<div class="reservation-box"> Zarezerwowane przez: <b>${data.reservedBy}</b></div>` : "";
            let btnRes = !data.reservedBy ? `<button class="small-btn reserve-btn" onclick="reserveOffer('${data.id}')">ZAREZERWUJ</button>` : (isOwner || isAdmin ? `<button class="small-btn unreserve-btn" onclick="cancelReservation('${data.id}')">COFNIJ REZ.</button>` : "");
            
            list.innerHTML += `
                <div class="offer-card legendary-item">
                    <div class="card-header">
                        <div class="tag ${data.type}">${data.type.toUpperCase()}</div>
                        <div class="item-title">${escapeHtml(data.name)}</div>
                        ${window.isValidImageUrl(data.img) ? `<img src="${data.img}" class="item-img">` : ""}
                    </div>
                    <div class="item-source"><img src="${data.sourceImg}"> <span>${data.source}</span></div>
                    <div class="price-tag">Cena: <span>${escapeHtml(data.price)}</span></div>
                    ${resHtml}
                    <div style="color:#aaa; font-size:0.85em; margin:10px 0; font-style:italic;" class="item-description">
                        ${escapeHtml(data.desc)}
                    </div>
                    <div class="seller-info">
                        <div class="seller-left"><img src="${data.avatar}" class="tiny-avatar"><b>${data.nick}</b></div>
                        <div class="btn-group">
                            ${btnRes}
                            ${isOwner ? `<button class="small-btn edit-added" onclick="openFullEdit('${data.id}','${data.name}','${data.price}','${data.desc}','${data.img}')">EDYTUJ</button>` : ""}
                            ${isOwner || isAdmin ? `<button class="small-btn delete-btn" onclick="deleteOffer('${data.id}')"></button>` : ""}
                        </div>
                    </div>
                </div>`;
        });
        document.getElementById('offerStats').innerText = `Widocznych ofert: ${count}`;
    };

    window.addOffer = async () => {
        const sel = document.getElementById('itemSource');
        if(!sel.value) return alert("Wybierz przeciwnika!");
        await addDoc(collection(db, "oferty"), {
            userId: currentUser.uid, nick: currentNick, avatar: currentUser.photoURL,
            type: document.getElementById('offerType').value,
            name: document.getElementById('itemName').value,
            price: document.getElementById('itemPrice').value,
            source: sel.value, sourceImg: sel.options[sel.selectedIndex].dataset.img,
            desc: document.getElementById('itemDesc').value,
            img: document.getElementById('itemImg').value,
            date: new Date().toISOString(), reservedBy: null
        });
        location.reload();
    };

    window.reserveOffer = async (id) => { if(!currentNick) return alert("Zaloguj si!"); await updateDoc(doc(db, "oferty", id), { reservedBy: currentNick }); };
    window.cancelReservation = async (id) => { await updateDoc(doc(db, "oferty", id), { reservedBy: null }); };
    window.deleteOffer = async (id) => { if(confirm("Usun?")) await deleteDoc(doc(db, "oferty", id)); };
    window.logout = () => signOut(auth);
    window.searchMargo = () => window.open(`https://margoworld.pl/item?name=${encodeURIComponent(document.getElementById('itemName').value)}`);
    window.openFullEdit = (id, n, p, d, i) => { currentEditId = id; document.getElementById('fullEditName').value=n; document.getElementById('fullEditPrice').value=p; document.getElementById('fullEditDesc').value=d; document.getElementById('fullEditImg').value=i; document.getElementById('editModal').style.display='flex'; };
    window.closeFullEdit = () => document.getElementById('editModal').style.display='none';
    window.confirmFullEdit = async () => { await updateDoc(doc(db, "oferty", currentEditId), { name: document.getElementById('fullEditName').value, price: document.getElementById('fullEditPrice').value, desc: document.getElementById('fullEditDesc').value, img: document.getElementById('fullEditImg').value }); window.closeFullEdit(); };

    onSnapshot(query(collection(db, "oferty"), orderBy("date", "desc")), (snap) => {
        allOffers = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        window.renderOffers();
    });
</script>
</body>
</html>





