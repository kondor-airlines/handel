<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Targowisko Klanowe - Kondor Airlines</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚔️</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffd700; --gold-bright: #fff2a6; --bg: #0f0f0f; --card: #1a1a1a;
            --border: #332b00; --green: #2ecc71; --blue: #3498db; --red: #e74c3c;
            --purple: #9b59b6; --orange: #e67e22; --heroic: #3498db; --unique: #e67e22; --legendary: #ffd700;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(-45deg, #050505, #1a1200, #2e2000, #000000);
            background-size: 400% 400%; animation: livingBackground 20s ease infinite;
            color: #eee; margin: 0; padding: 20px; padding-bottom: 80px; min-height: 100vh; background-attachment: fixed;
        }
        @keyframes livingBackground { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* UI COMPONENTS */
        .container { max-width: 1200px; margin: 0 auto; margin-top: 40px; }
		
		header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 2px solid var(--border); 
            padding-bottom: 15px; 
            margin-bottom: 30px; 
            flex-wrap: nowrap; /* Wymusza jedną linię na komputerze */
            gap: 10px; 
        }

		h1 { 
            font-family: 'MedievalSharp', cursive; 
            margin: 0; 
            font-size: 1.6em; 
            letter-spacing: 1px; 
            background: linear-gradient(to bottom, #ffd700 20%, #b8860b 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.3));
            white-space: nowrap; /* Zapobiega łamaniu tytułu */
        }
		
        .login-btn { background: rgba(255, 255, 255, 0.05); color: #fff; border: 1px solid var(--gold); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 12px; transition: all 0.3s ease; text-transform: uppercase; font-size: 0.85em; z-index: 99; position: relative; }
        .login-btn:hover { background: var(--gold); color: #000; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); transform: translateY(-2px); }

		.user-profile { 
            display: none; 
            align-items: center; 
            gap: 5px; /* Jeszcze mniejszy odstęp między ikonkami */
            background: rgba(255,255,255,0.05); 
            padding: 4px 10px; /* Mniejsze marginesy wewnątrz paska */
            border-radius: 50px; 
            border: 1px solid var(--border);
            margin-left: auto; /* Dopycha do prawej strony */
            flex-shrink: 0; /* Zapobiega zgniataniu paska profilu */
        }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--gold); position: relative; }
        .logout-link { color: #ff6666; font-size: 0.75em; text-decoration: none; cursor: pointer; text-transform: uppercase; font-weight: bold; }


		/* Styl dla Skrzynek */
        .offer-card.type-chest { border-color: #8d6e63; box-shadow: inset 0 0 20px rgba(141, 110, 99, 0.2); }
        .tag.chest { background: #8d6e63; color: #fff; }
        
        /* Wygląd wiersza w formularzu skrzynek */
		
        .chest-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; animation: slideIn 0.3s; }
        .chest-row select { flex: 3; }
        .chest-row input { flex: 1; text-align: center; }
        .remove-chest-btn { background: var(--red); color: white; border: none; border-radius: 4px; cursor: pointer; padding: 0 10px; height: 42px; font-weight: bold; }
		/* Kontener na wiele skrzynek */
        .multi-chest-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin: 15px auto 10px auto;
            max-width: 100%;
        }
        /* Mała ikonka skrzynki w zestawie */
        .mini-chest-img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.3));
            transition: 0.3s;
        }
        .mini-chest-img:hover { transform: scale(1.2); }
		
        /* --- NOWY UKŁAD FILTRÓW --- */
        .filters-container {
            display: flex;
            flex-direction: column; /* Układa grupy jedna pod drugą */
            gap: 15px;
            align-items: center;
            margin-bottom: 25px;
        }

        .filter-group {
            background: rgba(255, 255, 255, 0.03); /* Delikatne tło dla grupy */
            border: 1px solid #333;
            border-radius: 50px; /* Zaokrąglone paski */
            padding: 8px 20px;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
        }

        .group-label {
            color: #666;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 5px;
            font-weight: bold;
            font-family: 'Montserrat', sans-serif;
        }

        .separator {
            color: #444;
            font-size: 1.2em;
            margin: 0 5px;
            opacity: 0.5;
        }

		/* --- STYLOWE PRZYCISKI FILTRÓW --- */
        .filter-btn {
            background: rgba(0, 0, 0, 0.6); /* Ciemne tło */
            color: #aaa; /* Szary tekst nieaktywny */
            border: 1px solid #444; /* Ciemna ramka */
            padding: 8px 16px;
            border-radius: 20px; /* Zaokrąglone rogi (pastylka) */
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        /* Efekt najechania (Hover) */
        .filter-btn:hover {
            border-color: var(--gold);
            color: #fff;
            background: rgba(255, 215, 0, 0.1); /* Lekka złota poświata */
            transform: translateY(-2px); /* Lekkie uniesienie */
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        /* Aktywny przycisk (wybrany) */
        .filter-btn.active {
            background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%) !important; /* Złoty gradient */
            color: #000 !important; /* Czarny tekst dla kontrastu */
            border: 1px solid #ffd700 !important;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4) !important; /* Świecenie */
            font-weight: 800;
        }

        /* Specjalne kolory dla specyficznych przycisków po aktywacji (Opcjonalne, ale fajne) */
        /* Jeśli chcesz, żeby "Kupię" było niebieskie, a "Sprzedam" zielone jak są aktywne: */
        
        /* Sprzedam - Zielony */
        .filter-btn#f-sprzedam.active {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%) !important;
            border-color: #2ecc71 !important;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.4) !important;
            color: #fff !important;
        }

        /* Kupię - Niebieski */
        .filter-btn#f-kupie.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%) !important;
            border-color: #3498db !important;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.4) !important;
            color: #fff !important;
        }

        /* Zamienię - Pomarańczowy */
        .filter-btn#f-zamienie.active {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%) !important;
            border-color: #e67e22 !important;
            box-shadow: 0 0 15px rgba(230, 126, 34, 0.4) !important;
            color: #fff !important;
        }

        /* Exp - Fioletowy */
        .filter-btn#f-exp.active {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%) !important;
            border-color: #9b59b6 !important;
            box-shadow: 0 0 15px rgba(155, 89, 182, 0.4) !important;
            color: #fff !important;
        }
        
/* --- RWD: WYGLĄD NA TELEFONACH (POPRAWIONY) --- */
        @media (max-width: 768px) {
            /* 1. Filtry na całą szerokość */
            .filter-group {
                border-radius: 12px; 
                width: 100%;
            }

            /* 2. Nagłówek - układ pionowy */
            header { 
                flex-wrap: wrap; 
                justify-content: center; 
                gap: 10px;
            }
            
            h1 { 
                white-space: normal; 
                text-align: center; 
                font-size: 1.8em;        
                width: 100%; 
            }
            
            /* 3. NAPRAWA PANELU UŻYTKOWNIKA */
            .user-profile { 
                margin-left: 0; 
                width: 100%;             /* Panel na całą szerokość */
                justify-content: center; /* Wyśrodkowanie elementów */
                flex-wrap: wrap;         /* KLUCZOWE: Pozwala ikonkom spaść do nowej linii */
                height: auto;            /* Panel rośnie w pionie, żeby pomieścić ikonki */
                gap: 8px;                /* Odstępy między elementami */
                padding: 10px;           /* Trochę więcej miejsca w środku */
                margin-top: 10px;
            }

            /* Opcjonalnie: Nick i Wyloguj w osobnej linii na samym dole dla porządku */
            .user-profile > div:last-child {
                flex-basis: 100%;        /* Zajmuje całą szerokość */
                text-align: center;      /* Wyśrodkowany tekst */
                margin-top: 5px;
                padding-top: 5px;
                border-top: 1px solid rgba(255,255,255,0.1); /* Delikatna linia oddzielająca */
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
            }
        }

        .advanced-filters { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; background: rgba(255, 255, 255, 0.02); padding: 10px; border-radius: 8px; border: 1px solid #333; align-items: center; }
        .filter-select { background: #0a0a0a; border: 1px solid #444; color: var(--gold); padding: 8px; border-radius: 5px; cursor: pointer; font-family: 'Montserrat', sans-serif; }
        .lvl-group { display: flex; align-items: center; gap: 5px; color: #888; font-size: 0.9em; }
        .lvl-input { width: 60px; background: #0a0a0a; border: 1px solid #444; color: #eee; padding: 8px; border-radius: 5px; text-align: center; }
        
        .panel { background: linear-gradient(135deg, #151515 0%, #1a1a1a 100%); padding: 25px; border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.3); margin-bottom: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); display: none; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: 1 / -1; }
        input, select, textarea { background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 12px; border-radius: 6px; width: 100%; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--gold); background: #111; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        .search-box { background: #151500; border-color: var(--border); color: var(--gold); }
        .action-btn { background: linear-gradient(to bottom, #ffd700, #b89b00); color: #000; border: none; padding: 15px; font-weight: 800; width: 100%; cursor: pointer; border-radius: 6px; text-transform: uppercase; transition: 0.3s; }

        /* PODGLĄD */
        .preview-box { grid-column: 1 / -1; display: none; align-items: center; justify-content: flex-end; background: linear-gradient(270deg, #251f00 0%, #1a1a1a 100%); border: 2px solid var(--gold); padding: 15px 25px; border-radius: 12px; margin-bottom: 15px; gap: 20px; }
        .preview-content { display: flex; flex-direction: column; align-items: flex-end; text-align: right; }
        .preview-text { font-size: 1.4em; color: var(--gold); font-family: 'MedievalSharp'; }
        .preview-icon-wrapper { width: 70px; height: 70px; background: radial-gradient(circle, #333 0%, #000 100%); border-radius: 10px; border: 2px solid var(--gold); display: flex; align-items: center; justify-content: center; }
        .preview-icon-wrapper img { max-width: 90%; max-height: 90%; object-fit: contain; }

        /* KARTY OFERT */
        .offers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .offer-card { background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(5px); border: 2px solid #333; border-radius: 12px; padding: 15px; position: relative; transition: 0.3s; display: flex; flex-direction: column; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.5); animation: cardAppear 0.5s ease-out backwards; overflow: visible; }
        .offer-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.7); }
        .offer-card.type-sprzedam { border-color: var(--green); box-shadow: inset 0 0 20px rgba(46, 204, 113, 0.1); }
        .offer-card.type-kupie { border-color: var(--blue); box-shadow: inset 0 0 20px rgba(52, 152, 219, 0.1); }
        .offer-card.type-zamienie { border-color: var(--orange); box-shadow: inset 0 0 20px rgba(230, 126, 34, 0.1); }
		/* Nowe style dla Złota, Expa i Innych */
        .offer-card.type-gold { border-color: #ffd700;
            box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.1); }
        .offer-card.type-exp { border-color: #9b59b6;
            box-shadow: inset 0 0 20px rgba(155, 89, 182, 0.1); }
        .offer-card.type-other { border-color: #7f8c8d;
            box-shadow: inset 0 0 20px rgba(127, 140, 141, 0.1); }

        .tag.gold { background: #ffd700; color: #000; }
        .tag.exp { background: #9b59b6; color: #fff; }
        .tag.other { background: #7f8c8d; color: #fff; }

        .tag { position: absolute; top: 10px; left: 10px; padding: 4px 8px; border-radius: 4px; font-size: 0.65em; font-weight: 800; text-transform: uppercase; z-index: 2; }
        .tag.sprzedam { background: var(--green); color: #000; }
        .tag.kupie { background: var(--blue); color: #fff; }
        .tag.zamienie { background: var(--orange); color: #fff; }
        .fav-btn { position: absolute; top: 5px; right: 5px; background: none; border: none; font-size: 1.5em; cursor: pointer; color: #555; transition: 0.3s; z-index: 5; }
        .fav-btn:hover, .fav-btn.active { color: var(--red); transform: scale(1.2); }

        .item-img { width: 70px; height: 70px; object-fit: contain; margin: 25px auto 10px auto; filter: drop-shadow(0 0 8px rgba(255,255,255,0.2)); transition: 0.3s; }
        .offer-card:hover .item-img { transform: scale(1.1); }
        .item-title { font-size: 1.1em; font-weight: bold; text-align: center; color: var(--gold); margin-bottom: 5px; line-height: 1.3; }
        .item-source { display: flex; align-items: center; gap: 5px; font-size: 0.8em; color: #888; margin-bottom: 10px; }
        .price-tag { font-size: 1.4em; color: #fff; font-weight: bold; margin: 5px 0; border-top: 1px solid #333; padding-top: 10px; width: 100%; text-align: center; }
        .price-tag span { color: #4fffa8; text-shadow: 0 0 10px rgba(79, 255, 168, 0.3); }

        /* STOPKA */
        .seller-info { margin-top: auto; width: 100%; padding-top: 15px; border-top: 1px dotted #444; display: flex; flex-direction: column; gap: 12px; }
        .seller-left { display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 0.9em; }
        .tiny-avatar { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--gold); }
        .btn-group { display: flex; gap: 5px; width: 100%; justify-content: space-between; }
        .small-btn { flex: 1; padding: 8px 0; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1.2em; border: 1px solid #333; background: rgba(255,255,255,0.05); color: #aaa; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .small-btn:hover { background: var(--gold); color: #000; border-color: var(--gold); transform: translateY(-2px); }
        .msg-btn:hover { background: var(--purple); color: #fff; border-color: var(--purple); }
        .reserve-btn:hover { background: var(--green); color: #000; border-color: var(--green); }
        .unreserve-btn:hover { background: #555; color: #fff; }
        .delete-btn:hover { background: var(--red); color: #fff; border-color: var(--red); }

        /* TOOLTIP */
        .tooltip-container { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%) translateY(-10px); width: 280px; background: rgba(0, 0, 0, 0.95); border: 2px solid #555; border-radius: 8px; padding: 15px; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.2s ease; pointer-events: none; box-shadow: 0 0 20px rgba(0,0,0,0.8); text-align: center; }
        .offer-card:hover .tooltip-container { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(-5px); }
        .tooltip-name { font-family: 'MedievalSharp'; font-size: 1.3em; margin-bottom: 5px; display: block; }
        .tooltip-name.legendary { color: var(--gold); } .tooltip-name.heroic { color: var(--heroic); } .tooltip-name.unique { color: var(--unique); }
        .tooltip-stats { font-size: 0.8em; color: #ccc; line-height: 1.4; text-align: center; white-space: pre-line; border-top: 1px solid #333; padding-top: 8px; margin-top: 8px; }
        .tooltip-img { width: 64px; height: 64px; object-fit: contain; margin: 0 auto; display: block; }

        .avatar-wrapper { position: relative; width: 30px; height: 30px; display: block; }
        .avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .online-dot { position: absolute; bottom: -2px; right: -2px; width: 9px; height: 9px; background: #2ecc71; border-radius: 50%; border: 2px solid #1a1a1a; box-shadow: 0 0 5px #2ecc71; z-index: 5; }
        
        .icon-btn { background: transparent; border: none; cursor: pointer; position: relative; font-size: 1.5em; margin-right: 15px; transition: 0.3s; }
        .icon-btn:hover { transform: scale(1.1); filter: drop-shadow(0 0 5px var(--gold)); }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--red); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7em; font-weight: bold; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px var(--red); animation: pulseBadge 2s infinite; }

        /* KARCZMA */
        #karczmaPanel { position: fixed; top: 0; right: -350px; width: 320px; height: 100vh; background: rgba(10, 10, 10, 0.95); border-left: 2px solid var(--gold); backdrop-filter: blur(10px); z-index: 20000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        #karczmaPanel.open { right: 0; box-shadow: -10px 0 50px rgba(0,0,0,0.8); }
        .chat-header { padding: 20px; background: linear-gradient(90deg, #332b00, transparent); border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .chat-messages { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        .chat-msg { font-size: 0.85em; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.05); border: 1px solid #333; display: flex; flex-direction: column; gap: 5px; }
        .chat-top-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 4px; margin-bottom: 2px; }
        .chat-nick { color: var(--gold); font-weight: bold; }
        .chat-time { font-size: 0.85em; color: #666; }
        .chat-text { color: #eee; word-wrap: break-word; line-height: 1.4; }
        .chat-input-area { padding: 15px; border-top: 1px solid #333; display: flex; gap: 5px; }

        /* SKRZYNKA & SCROLL */
        .mail-list { display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; }
        .mail-item { background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 15px; border-radius: 8px; position: relative; }
        .mail-item.unread { border-left: 4px solid var(--gold); background: rgba(255, 215, 0, 0.05); }
        .delete-mail-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; color: #ff6666; transition: 0.3s; opacity: 0.5; }
        .delete-mail-btn:hover { opacity: 1; transform: scale(1.2); }
        
        ::-webkit-scrollbar { width: 10px; } ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #332b00 0%, #ffd700 50%, #332b00 100%); border-radius: 6px; border: 1px solid #000; }
        #scrollTopBtn { display: none; position: fixed; bottom: 30px; right: 30px; z-index: 9999; width: 50px; height: 50px; border: 2px solid var(--gold); background-color: rgba(0,0,0,0.8); color: var(--gold); cursor: pointer; border-radius: 50%; font-size: 24px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); transition: 0.3s; backdrop-filter: blur(2px); }
        #scrollTopBtn:hover { background-color: var(--gold); color: #000; transform: translateY(-5px); }
        
        /* TOASTS */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 100000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: rgba(18, 18, 18, 0.95); border-left: 4px solid var(--gold); border: 1px solid #444; color: #fff; padding: 15px 25px; border-radius: 5px; box-shadow: 0 5px 20px rgba(0,0,0,0.8); display: flex; align-items: center; gap: 15px; min-width: 250px; animation: slideIn 0.3s ease-out; backdrop-filter: blur(5px); }
        .toast.success { border-left-color: var(--green); } .toast.error { border-left-color: var(--red); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* ZEGAR & KALKULATOR */
        .game-clock-wrapper { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.8); border: 1px solid var(--gold); padding: 5px 20px; border-radius: 20px; z-index: 1000; font-family: 'MedievalSharp'; color: var(--gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); display: flex; align-items: center; gap: 10px; font-size: 1.1em; }
        .clock-icon { animation: spin 10s linear infinite; font-size: 0.8em; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .calc-inputs { display: flex; gap: 10px; margin-bottom: 10px; }
        .calc-result { background: #111; border: 1px dashed var(--gold); padding: 15px; text-align: center; color: var(--green); font-size: 1.1em; border-radius: 8px; margin-top: 15px; line-height: 1.6; }
        .calc-btn-toggle { position: fixed; bottom: 90px; right: 30px; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #1a1a1a, #332b00); border: 2px solid var(--gold); color: var(--gold); font-size: 1.5em; cursor: pointer; z-index: 999; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: 0.3s; }
        .calc-btn-toggle:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--gold); }
        .toggle-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; font-size: 0.9em; color: #ccc; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 6px; cursor: pointer; }
        .highlight-text { color: var(--gold); font-weight: bold; }
        
        /* --- NOWE STYLE DLA ENCYKLOPEDII (Bestiariusza) --- */
        .encyclo-btn-toggle { position: fixed; bottom: 150px; right: 30px; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid #ccc; color: #ccc; font-size: 1.5em; cursor: pointer; z-index: 999; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: 0.3s; }
        .encyclo-btn-toggle:hover { transform: scale(1.1); box-shadow: 0 0 20px white; color: white; border-color: white; }
        
        .bestiary-tabs { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .tab-btn { background: #333; border: 1px solid #555; color: #888; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-family: 'MedievalSharp'; font-size: 1.1em; transition: 0.3s; }
        .tab-btn:hover { color: white; border-color: #777; }
        .tab-btn.active { background: var(--gold); color: black; border-color: var(--gold); }
        
        .bestiary-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; max-height: 60vh; overflow-y: auto; padding-right: 5px; }
        .bestiary-card { background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .bestiary-mob-name { font-weight: bold; color: var(--gold); margin: 10px 0; text-align: center; }
        .bestiary-mob-img { height: 60px; object-fit: contain; filter: drop-shadow(0 0 5px rgba(255,215,0,0.2)); }
        
        .loot-grid { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; width: 100%; margin-top: 10px; border-top: 1px solid #333; padding-top: 10px; }
        .loot-item { width: 40px; height: 40px; border: 1px solid #444; border-radius: 4px; padding: 2px; background: rgba(0,0,0,0.3); transition: 0.2s; position: relative; }
        .loot-item img { width: 100%; height: 100%; object-fit: contain; }
        .loot-item:hover { border-color: var(--green); transform: scale(1.1); }
        .loot-item:hover::after { content: attr(title); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: black; color: white; padding: 5px; border-radius: 4px; font-size: 0.7em; white-space: nowrap; z-index: 10; pointer-events: none; border: 1px solid #555; }

		/* --- STYL KALKULATORA ESENCJI --- */
        .essence-btn-toggle { 
            position: fixed; 
            bottom: 210px; /* Pozycja nad przyciskiem Bestiariusza */
            right: 30px; 
            width: 50px; height: 50px; 
            border-radius: 50%; 
            background: linear-gradient(135deg, #2d0036, #580063); 
            border: 2px solid #9b59b6; 
            cursor: pointer; z-index: 999; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
            transition: 0.3s; 
            display: flex; align-items: center; justify-content: center;
        }
        .essence-btn-toggle:hover { transform: scale(1.1); box-shadow: 0 0 20px #9b59b6; }
        .essence-btn-toggle img { width: 32px; height: 32px; }

		/* --- ZESZYT DŁUŻNIKÓW --- */
        .debt-btn-toggle { background: transparent; border: none; font-size: 1.5em; cursor: pointer; transition: 0.3s; margin-right:15px; }
        .debt-btn-toggle:hover { transform: scale(1.1); filter: drop-shadow(0 0 5px var(--red)); }
        
        .debt-list { display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; margin-top: 15px; }
        .debt-item { background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; position: relative; }
        .debt-item.paid { border-color: var(--green); opacity: 0.6; }
        .debt-item.paid .debt-amount { text-decoration: line-through; color: #888; }
        .debt-info { display: flex; flex-direction: column; gap: 3px; font-size: 0.9em; }
        .debt-who { color: var(--gold); font-weight: bold; }
        .debt-amount { color: var(--red); font-weight: bold; font-size: 1.1em; }
        .debt-actions { display: flex; gap: 5px; }

        /* --- ARCHIWUM SPRZEDANYCH --- */
        .offer-card.is-sold { filter: grayscale(100%); opacity: 0.7; border-color: #555 !important; box-shadow: none !important; }
        .offer-card.is-sold:hover { transform: none; }
        .sold-stamp { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); font-size: 2em; font-weight: 800; color: #fff; border: 4px solid #fff; padding: 10px 20px; border-radius: 10px; z-index: 10; opacity: 0.8; pointer-events: none; text-shadow: 0 0 10px #000; letter-spacing: 2px; }
        .filter-btn#f-archive.active { background: #555 !important; color: #fff !important; border-color: #999 !important; }

		/* --- TABLICA OGŁOSZEŃ --- */
        .announcement-board {
            max-width: 900px;
            margin: 0 auto 25px auto;
            background: linear-gradient(180deg, rgba(40, 0, 0, 0.8), rgba(20, 0, 0, 0.9));
            border: 2px solid #8B0000; /* Ciemnoczerwona ramka */
            border-radius: 8px;
            padding: 20px;
            position: relative;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
            display: none; /* Ukryte domyślnie, pokaże się jak będzie wpis */
            animation: slideDown 0.5s ease-out;
        }
        .ann-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #551111; padding-bottom: 10px; margin-bottom: 10px;
        }
        .ann-title {
            color: #ff6666; font-family: 'MedievalSharp'; font-size: 1.4em; letter-spacing: 1px;
            text-transform: uppercase; text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }
        .ann-text {
            font-size: 1.1em; line-height: 1.6; color: #ddd; white-space: pre-wrap; /* Zachowuje entery */
        }
        .ann-meta {
            font-size: 0.8em; color: #777; margin-top: 15px; text-align: right; font-style: italic;
        }
        .edit-ann-btn {
            background: none; border: 1px solid #555; color: #aaa; cursor: pointer;
            padding: 5px 10px; border-radius: 5px; font-size: 0.9em; transition: 0.3s;
        }
        .edit-ann-btn:hover { background: #fff; color: #000; }

		/* --- EFEKT ISKIER (BACKGROUND) --- */
        #embers-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; pointer-events: none; z-index: -1; /* Pod spodem */
        }
        .ember {
            position: absolute; bottom: -10px;
            background: orange;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 10px 2px rgba(255, 69, 0, 0.7);
            animation: rise linear infinite;
        }

		/* --- STYLE KREATORA PODZIAŁÓW --- */
    .split-section { background: rgba(255, 255, 255, 0.02); border: 1px solid #333; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    .split-label { color: #888; font-size: 0.8em; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 1px; display: block; }
    .type-btn-split { flex: 1; background: #222; border: 1px solid #444; color: #aaa; padding: 8px; cursor: pointer; transition: 0.2s; font-family: 'Montserrat'; }
    .type-btn-split:hover, .type-btn-split.active { background: #00ffff; color: #000; border-color: #00ffff; box-shadow: 0 0 10px #00ffff; }
    .loot-grid-select { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .loot-card-select { width: 55px; height: 55px; background: #1a1a1a; border: 2px solid #333; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; transition: 0.2s; }
    .loot-card-select img { max-width: 45px; max-height: 45px; }
    .loot-card-select.selected { border-color: #00ffff; background: #002222; box-shadow: 0 0 15px #00ffff; }
	.loot-card-select:hover .loot-name-tooltip { 
    display: block; 
	}
    .user-grid-split { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 5px; }
	.loot-name-tooltip {
        position: absolute;
        bottom: -35px; /* Obniżone, żeby nie zasłaniało grafiki */
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: #fff;
        padding: 4px 8px;
        font-size: 10px;
        white-space: pre-wrap; /* Pozwala zawijać tekst */
        text-align: center;
        z-index: 100;
        border: 1px solid #555;
        border-radius: 4px;
        display: none;
        width: 100px; /* Stała szerokość dla porządku */
    }

	/* --- UPSTRZEŻONA EKIPA --- */
    .user-chip {
        background: #222; 
        border: 1px solid #444; 
        color: #aaa;
        padding: 8px 14px; 
        font-size: 0.8em; 
        cursor: pointer; 
        border-radius: 20px; /* Zaokrąglone pastylki */
        user-select: none; 
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        font-weight: 600;
        text-align: center;
        min-width: 70px;
    }

    .user-chip:hover {
        border-color: #777;
        color: #fff;
        transform: scale(1.05);
    }
    
    /* Aktywny Szef - Złoty neon */
    .boss-active { 
        background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%) !important; 
        color: #000 !important; 
        border-color: #fff !important;
        box-shadow: 0 0 12px rgba(255, 215, 0, 0.5);
    }
    
    /* Aktywna Ekipa - Błękitny neon */
    .team-active { 
        background: linear-gradient(135deg, #00ffff 0%, #008b8b 100%) !important; 
        color: #000 !important; 
        border-color: #fff !important;
        box-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
    }

    /* Przycisk usuwania w historii */
    .del-split-icon {
        cursor: pointer;
        color: #ff4444;
        opacity: 0.4;
        transition: 0.3s;
        padding: 5px;
    }
    .del-split-icon:hover {
        opacity: 1;
        transform: scale(1.2);
    }

	.helper-btn {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            height: 42px; /* Dopasowanie do wysokości inputów */
            white-space: nowrap;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .helper-btn:hover {
            background: var(--gold);
            color: #000;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            transform: translateY(-2px);
        }

        .helper-btn:active {
            transform: translateY(1px);
        }

        .helper-btn-icon {
            font-size: 1.2em;
        }

		/* --- WSPÓLNA BAZA DLA PRZYCISKÓW BOCZNYCH --- */
        .extract-btn-toggle, .upgrade-btn-toggle, .essence-btn-toggle, .encyclo-btn-toggle, .calc-btn-toggle {
            position: fixed;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid;
        }

        /* --- INDYWIDUALNE STYLE I POZYCJE --- */
        .extract-btn-toggle { 
            bottom: 330px; 
            background: linear-gradient(135deg, #001a00, #004d00); 
            border-color: #2ecc71; 
        }
        .extract-btn-toggle:hover { box-shadow: 0 0 20px #2ecc71; transform: scale(1.1); }

        .upgrade-btn-toggle { 
            bottom: 270px; 
            background: linear-gradient(135deg, #1a1a1a, #444); 
            border-color: var(--gold); 
        }
        .upgrade-btn-toggle:hover { box-shadow: 0 0 20px var(--gold); transform: scale(1.1); }

        .essence-btn-toggle { 
            bottom: 210px; 
            background: linear-gradient(135deg, #2d0036, #580063); 
            border-color: #9b59b6; 
        }
        .essence-btn-toggle:hover { box-shadow: 0 0 20px #9b59b6; transform: scale(1.1); }

        .encyclo-btn-toggle { 
            bottom: 150px; 
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a); 
            border-color: #ccc; 
        }
        .encyclo-btn-toggle:hover { box-shadow: 0 0 20px white; transform: scale(1.1); border-color: #fff; }

        .calc-btn-toggle { 
            bottom: 90px; 
            background: linear-gradient(135deg, #1a1a1a, #332b00); 
            border-color: var(--gold); 
        }
        .calc-btn-toggle:hover { box-shadow: 0 0 20px var(--gold); transform: scale(1.1); }

        /* --- IKONY I WIERSZE WYNIKÓW --- */
        .extract-btn-toggle img, .essence-btn-toggle img { width: 32px; height: 32px; object-fit: contain; }
        .upgrade-btn-toggle img { width: 100%; height: 100%; object-fit: cover; }
        
        .upgrade-res-row, .extract-res-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #222;
            font-size: 0.9em;
        }

		/* --- STYL PORADNIKA --- */
        .help-content details {
            background: rgba(255, 255, 255, 0.03);
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #333;
            overflow: hidden;
            transition: 0.3s;
        }
        .help-content details[open] {
            border-color: var(--gold);
            background: rgba(0, 0, 0, 0.5);
        }
        .help-content summary {
            padding: 12px 15px;
            cursor: pointer;
            font-weight: bold;
            color: #eee;
            list-style: none; /* Ukrywa domyślny trójkąt */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .help-content summary::after {
            content: '+'; 
            color: var(--gold); 
            font-weight: bold;
            font-size: 1.2em;
        }
        .help-content details[open] summary::after {
            content: '−';
        }
        .help-content summary:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        .help-content p, .help-content ul {
            padding: 0 15px 15px 15px;
            margin: 0;
            color: #bbb;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .help-content ul {
            padding-left: 35px;
        }
        .help-content li {
            margin-bottom: 5px;
        }

		/* --- STYL OKNA POMOCY (POPRAWKA CENTROWANIA) --- */
    #helpModal {
        /* To gwarantuje, że okno zawsze będzie na środku, gdy JS zmieni display na flex */
        align-items: center;
        justify-content: center;
        
        /* Reszta parametrów tła */
        position: fixed;
        z-index: 10030;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.9);
        backdrop-filter: blur(5px);
    }

		/* Przycisk Złote Usta */
        .quotes-btn-toggle { 
            position: fixed; bottom: 390px; right: 30px; /* Pozycja nad Ekstrakcją */
            width: 50px; height: 50px; border-radius: 50%; 
            background: linear-gradient(135deg, #2c3e50, #000); 
            border: 2px solid var(--gold); color: var(--gold); 
            font-size: 1.5em; cursor: pointer; z-index: 999; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
            transition: 0.3s; 
            display: flex; align-items: center; justify-content: center;
        }
        .quotes-btn-toggle:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--gold); }

        /* Styl Kafelka Cytatu (Pergamin) */
        .quote-card {
            background: #e0cda7; /* Kolor starego papieru */
            color: #3e2723;       /* Ciemnobrązowy tekst */
            padding: 15px;
            border-radius: 2px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.5);
            font-family: 'MedievalSharp', serif;
            position: relative;
            border: 1px solid #8d6e63;
            transform: rotate(-1deg); /* Lekki obrót dla naturalności */
            transition: 0.3s;
        }
        .quote-card:hover { transform: scale(1.02) rotate(0deg); z-index: 5; }
        .quote-text { font-size: 1.1em; font-style: italic; margin-bottom: 10px; line-height: 1.3; }
        .quote-author { text-align: right; font-weight: bold; font-size: 0.9em; border-top: 1px solid #8d6e63; padding-top: 5px; }
        .quote-date { font-size: 0.7em; opacity: 0.7; text-align: right; }
        .del-quote-btn { position: absolute; top: 5px; right: 5px; cursor: pointer; color: #8d6e63; font-weight: bold; font-family: sans-serif; opacity: 0.5; }
        .del-quote-btn:hover { opacity: 1; color: red; }

		/* --- PRZYCISK OTWIERANIA --- */
.jackpot-btn-toggle {
    position: fixed; bottom: 450px; right: 30px; /* Nad Złotymi Ustami */
    width: 50px; height: 50px; border-radius: 50%;
    background: linear-gradient(135deg, #FFD700, #FF8C00);
    border: 2px solid #fff; color: #000;
    font-size: 1.8em; cursor: pointer; z-index: 999;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
    transition: 0.3s; display: flex; align-items: center; justify-content: center;
    animation: pulseGold 2s infinite;
}
.jackpot-btn-toggle:hover { transform: scale(1.1); }

/* --- PASEK RULETKI --- */
.jackpot-rail {
    position: relative;
    width: 100%;
    height: 100px;
    background: #050505;
    border-top: 2px solid #333;
    border-bottom: 2px solid #333;
    overflow: hidden; /* Ukrywa to co poza ekranem */
    display: flex;
    align-items: center;
}

/* Wskaźnik (strzałka) */
.jackpot-pointer {
    position: absolute;
    top: 0; left: 50%; transform: translateX(-50%);
    color: #fff; font-size: 20px; z-index: 10;
    text-shadow: 0 2px 2px #000;
    pointer-events: none;
}
.jackpot-pointer::after {
    content: '▲'; position: absolute; bottom: -85px; left: 0; color: #fff;
}
.jackpot-pointer::before {
    content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
    width: 4px; height: 100px; background: rgba(255,255,255,0.3); z-index: -1;
}

/* Taśma z awatarami */
.jackpot-strip {
    display: flex;
    height: 80px;
    will-change: transform; 
    /* Ważne: usuwamy domyślne wyrównania, liczymy piksele sami */
}

.jp-card {
    /* SZTYWNE WYMIARY - NIE ZMIENIAJ TEGO */
    width: 80px !important; 
    height: 80px !important;
    margin: 0 2px !important; /* 2px z lewej + 2px z prawej = 4px marginesu */
    /* Całkowita szerokość elementu to 80 + 4 = 84px */
    
    background: #222;
    border: 2px solid #444;
    box-sizing: border-box; /* Border wchodzi w wymiar */
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    position: relative;
}
.jp-card img { width: 100%; height: 100%; object-fit: cover; }

/* Lista graczy w panelu */
.jp-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9em;
}
.jp-percent { font-weight: bold; color: var(--gold); }

/* --- NOWY PASEK BOCZNY (SIDEBAR) --- */
    
    /* Główny przycisk sterujący (Oko) */
    .sidebar-toggle-main {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px; height: 50px;
        border-radius: 50%;
        background: #111;
        border: 2px solid #555;
        color: #888;
        font-size: 1.5em;
        cursor: pointer;
        z-index: 10000; /* Zawsze na wierzchu */
        box-shadow: 0 0 10px rgba(0,0,0,0.8);
        transition: 0.3s;
    }
    .sidebar-toggle-main:hover {
        border-color: #fff;
        color: #fff;
        transform: scale(1.1);
    }

    /* Kontener na przyciski (słupek) */
    .sidebar-container {
        position: fixed;
        bottom: 90px; /* Zaczyna się nad przyciskiem Oka */
        right: 30px;
        display: flex;
        flex-direction: column-reverse; /* Układa od dołu do góry */
        gap: 12px; /* Odstęp między ikonkami */
        z-index: 9990;
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Efekt sprężyny */
        transform: translateX(0); /* Domyślnie widoczne */
    }

    /* Klasa ukrywająca */
    .sidebar-hidden {
        transform: translateX(100px); /* Przesuwa w prawo poza ekran */
    }

    /* --- WSPÓLNY STYL DLA WSZYSTKICH PRZYCISKÓW --- */
    .side-btn {
        width: 45px; height: 45px;
        border-radius: 50%;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        transition: 0.2s;
        border: 2px solid;
        position: relative !important; /* Nadpisujemy stare fixed */
        bottom: auto !important;       /* Resetujemy stare pozycje */
        right: auto !important;
    }
    .side-btn:hover { transform: scale(1.15); z-index: 10; }
    .side-btn img { width: 28px; height: 28px; object-fit: contain; }

    /* --- INDYWIDUALNE KOLORY (Skopiowane z Twoich starych styli) --- */
    .jackpot-btn-style {
        background: linear-gradient(135deg, #FFD700, #FF8C00);
        border-color: #fff; color: #000; font-size: 1.5em;
        animation: pulseGold 2s infinite;
    }
    .quotes-btn-style {
        background: linear-gradient(135deg, #2c3e50, #000);
        border-color: var(--gold); color: var(--gold); font-size: 1.2em;
    }
    .extract-btn-style {
        background: linear-gradient(135deg, #001a00, #004d00);
        border-color: #2ecc71;
    }
    .upgrade-btn-style {
        background: linear-gradient(135deg, #1a1a1a, #444);
        border-color: var(--gold);
    }
    .essence-btn-style {
        background: linear-gradient(135deg, #2d0036, #580063);
        border-color: #9b59b6;
    }
    .encyclo-btn-style {
        background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
        border-color: #ccc; color: #ccc; font-size: 1.2em;
    }
    .calc-btn-style {
        background: linear-gradient(135deg, #1a1a1a, #332b00);
        border-color: var(--gold); font-size: 1.2em;
    }

	/* --- ZAKŁADKI JACKPOTA --- */
        .jp-tabs {
            display: flex;
            background: #000;
            border-bottom: 1px solid #333;
        }
        .jp-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
            color: #666;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
        }
        .jp-tab:hover { background: #111; color: #aaa; }
        
        .jp-tab.active-low { color: #2ecc71; border-bottom-color: #2ecc71; background: rgba(46, 204, 113, 0.05); }
        .jp-tab.active-mid { color: #f1c40f; border-bottom-color: #f1c40f; background: rgba(241, 196, 15, 0.05); }
        .jp-tab.active-high { color: #e74c3c; border-bottom-color: #e74c3c; background: rgba(231, 76, 60, 0.05); animation: pulseTab 2s infinite; }

        @keyframes pulseTab { 0% { text-shadow: 0 0 5px rgba(231, 76, 60, 0); } 50% { text-shadow: 0 0 15px rgba(231, 76, 60, 0.5); } 100% { text-shadow: 0 0 5px rgba(231, 76, 60, 0); } }

        /* --- POPRAWKI MOBILNE (RWD) --- */
        .jp-grid-container {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr; /* Komputer: 2 kolumny */
            gap: 20px;
            height: 380px; /* Stała wysokość na PC */
        }

        @media (max-width: 768px) {
            .jackpot-modal-window {
                width: 100% !important;
                height: 100% !important;
                border-radius: 0 !important;
                border: none !important;
            }
            .jp-grid-container {
                display: flex;
                flex-direction: column; /* Telefon: Pionowo */
                height: auto !important; /* Wysokość automatyczna */
                overflow-y: auto; /* Przewijanie całego środka */
                padding-bottom: 80px; /* Miejsce na dole */
            }
            /* Ramki wewnątrz */
            .jp-inner-box {
                min-height: 250px; /* Minimalna wysokość list na telefonie */
            }
        }

@keyframes pulseGold { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }
		
        @keyframes rise {
            0% { opacity: 0; transform: translateY(0) scale(1); }
            10% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 0; transform: translateY(-80vh) scale(0.2); }
        }
		
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes shine { 0% { left: -150%; } 100% { left: 150%; } }
        @keyframes cardAppear { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseBadge { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
<div id="embers-container"></div>
<div class="game-clock-wrapper">
    <span class="clock-icon">⏳</span>
    <span id="gameClock">00:00:00</span>
</div>

<audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="snd-coin" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
<audio id="snd-mail" src="https://assets.mixkit.co/active_storage/sfx/1393/1393-preview.mp3"></audio>
<audio id="snd-chat" src="https://assets.mixkit.co/active_storage/sfx/2347/2347-preview.mp3"></audio>

<div class="container">
    <header>
        <h1>⚔️ Targowisko Kondor Airlines</h1>
        <button id="googleLoginBtn" class="login-btn">
            <img src="https://cdn-icons-png.freepik.com/512/598/598489.png" width="18">
            <span>Zaloguj przez Google</span>
        </button>
        <div id="userProfile" class="user-profile">
			<button class="icon-btn" onclick="toggleHelp()" title="Poradnik Klanowicza">
    		❓
			</button>
            <button class="icon-btn" onclick="toggleMute()" title="Włącz/Wyłącz dźwięk">
                <span id="muteIcon">🔊</span>
            </button>
            <button class="icon-btn" onclick="toggleKarczma()" title="Karczma (Czat)">
                🍻
            </button>
            <button class="icon-btn" onclick="openMailbox()" title="Skrzynka odbiorcza">
                📩 <span id="mailBadge" class="badge" style="display:none;">0</span>
            </button>
			<button class="icon-btn" onclick="toggleDebts()" title="Zeszyt Dłużników">📜</button>
			<button class="icon-btn" onclick="openSplitModal()" title="Podziały Łupów" style="color: #00ffff; position: relative;">
    ⚖️ <span id="splitBadge" class="badge" style="display:none;">0</span>
</button>

			
            <div class="avatar-wrapper">
                <img id="userAvatar" class="user-avatar" src="" alt="">
            </div>
            <div>
                <div id="userNickDisplay" style="font-weight:bold; color:var(--gold); font-size:0.9em;">...</div>
                <div class="logout-link" onclick="logout()">Wyloguj</div>
            </div>
        </div>
    </header>

	<div id="announcementBoard" class="announcement-board">
        <div class="ann-header">
            <span class="ann-title">📢 Obwieszczenie Klanowe</span>
            <button id="editAnnBtn" class="edit-ann-btn" style="display:none;" onclick="openAnnModal()">EDYTUJ</button>
        </div>
        <div id="annContent" class="ann-text">Ładowanie treści...</div>
        <div id="annMeta" class="ann-meta"></div>
    </div>
	
    <div class="filters-container">
        <div class="filter-group">
            <span class="group-label">Handel:</span>
            <button class="filter-btn active" id="f-all" onclick="setFilter('type', 'all')">Wszystkie</button>
            <button class="filter-btn" id="f-sprzedam" onclick="setFilter('type', 'sprzedam')">Sprzedam</button>
            <button class="filter-btn" id="f-kupie" onclick="setFilter('type', 'kupie')">Kupię</button>
            <button class="filter-btn" id="f-zamienie" onclick="setFilter('type', 'zamienie')">Zamienię</button>
        </div>

        <div class="filter-group">
            <span class="group-label">Usługi:</span>
            <button class="filter-btn" id="f-gold" onclick="setFilter('type', 'gold')">💰 Złoto</button>
			<button class="filter-btn" id="f-chest" onclick="setFilter('type', 'chest')">📦 Skrzynki</button>
            <button class="filter-btn" id="f-exp" onclick="setFilter('type', 'exp')">🛡️ Exp/Pomoc</button>
            <button class="filter-btn" id="f-other" onclick="setFilter('type', 'other')">🎲 Inne</button>
			<button class="filter-btn" id="f-archive" onclick="setFilter('type', 'archive')">📂 Archiwum</button>
        </div>

        <div class="filter-group">
            <span class="group-label">Filtry:</span>
            <button class="filter-btn" id="f-mine" onclick="setFilter('type', 'mine')">👤 Moje</button>
            <button class="filter-btn" id="f-fav" onclick="setFilter('type', 'fav')">❤️ Ulubione</button>
            <span class="separator">|</span>
            <button class="filter-btn" id="f-herosi" onclick="setFilter('cat', 'herosi')">Herosi</button>
            <button class="filter-btn" id="f-e2" onclick="setFilter('cat', 'e2')">Elity II</button>
        </div>
    </div>

    <div class="advanced-filters">
        <select id="userFilterSelect" class="filter-select" onchange="renderOffers()">
            <option value="">👤 Wszyscy sprzedawcy</option>
        </select>

	    <select id="profFilter" class="filter-select" onchange="renderOffers()">
            <option value="">⚔️ Wszystkie profesje</option>
            <option value="w">Wojownik (w)</option>
            <option value="p">Paladyn (p)</option>
            <option value="b">Tancerz Ostrzy (b)</option>
            <option value="m">Mag (m)</option>
            <option value="t">Tropiciel (t)</option>
            <option value="h">Łowca (h)</option>
            <option value="a">Wszystkie profesje (a)</option>
            <option value="i">Inne (i)</option>
        </select>
		
        <div class="lvl-group">
            <span>Poziom:</span>
            <input type="number" id="minLvlInput" class="lvl-input" placeholder="Od" oninput="renderOffers()">
            <span>-</span>
            <input type="number" id="maxLvlInput" class="lvl-input" placeholder="Do" oninput="renderOffers()">
        </div>

        <input type="text" id="globalSearch" class="search-box" placeholder="🔍 Szukaj przedmiotu..." oninput="renderOffers()" style="width: 200px; padding: 8px;">
    </div>
    
    <div id="offerStats" style="text-align:center; font-size:0.8em; color:#666; margin-bottom:20px;"></div>

    <button onclick="toggleAddOfferPanel()" id="toggleAddBtn" 
            style="display:block; margin: 0 auto 20px auto; background: linear-gradient(to bottom, #ffd700, #b8860b); color: #000; font-family: 'MedievalSharp'; font-size: 1.2em; padding: 10px 40px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); transition: 0.3s;">
        + WYSTAW ARTEFAKT
    </button>

    <div id="addOfferPanel" class="panel" style="display: none;">
        <h3 style="margin-top:0; color:var(--gold); font-family:'MedievalSharp';">Wystaw Ogłoszenie</h3>
        <div class="form-grid">
            <select id="offerType" onchange="toggleSpecialFields()" class="full-width" style="font-weight:bold; color:var(--gold);">
                <option value="sprzedam">🗡️ Sprzedam Przedmiot</option>
                <option value="kupie">💰 Kupię Przedmiot</option>
                <option value="zamienie">🔄 Zamienię się</option>
                <option value="gold">⚖️ Handel Złotem</option>
                <option value="chest">📦 Sprzedaż Skrzynek</option>
                <option value="exp">🛡️ Pomoc / Expienie</option>
                <option value="other">🎲 Inne</option>
            </select>

            <div id="field-sell" class="full-width">
                <input type="text" id="itemPrice" placeholder="Cena (np. 150m, 50k, 20 PLN, 100 ZŁ)" 
                       oninput="validatePriceInput(this)">
                <div style="font-size:0.7em; color:#666; margin-top:3px;">*Dozwolone waluty: k, m, g, PLN, ZŁ</div>
            </div>

            <div id="field-buy" class="full-width" style="display:none;">
                <label style="color:#aaa; font-size:0.8em;">Czym płacisz?</label>
                <select id="buyCurrency">
                    <option value="Złoto (m/g)">💰 Tylko Złoto (w grze)</option>
                    <option value="PLN / ZŁ">💸 Gotówka (PLN / BLIK)</option>
                    <option value="Złoto lub PLN">⚖️ Złoto lub PLN (do dogadania)</option>
                </select>
            </div>

            <div id="field-trade" class="full-width" style="display:none; background:rgba(0,0,0,0.3); padding:10px; border-radius:6px; border:1px dashed #444;">
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer; color:#aaa;">
                    <input type="checkbox" id="tradeSurchargeCheck" onchange="toggleSurchargeInput()">
                    <span>Mogę dopłacić do wymiany?</span>
                </label>
                <input type="text" id="tradeSurchargeInput" placeholder="Ile dopłacisz? (np. 100m, 20 PLN)" style="display:none; margin-top:10px; border-color:var(--orange);">
            </div>

            <div id="field-gold" class="full-width" style="display:none; gap:10px; grid-template-columns: 1fr 1fr;">
                <select id="goldAction" style="background:#222; color:var(--gold);">
                    <option value="Sprzedam">Sprzedam Złoto</option>
                    <option value="Kupię">Kupię Złoto</option>
                </select>
                <input type="text" id="goldAmount" placeholder="Ilość (np. 1.5g, 500m)">
            </div>

            <div id="chestBundleContainer" class="full-width" style="display:none; background:rgba(0,0,0,0.3); padding:10px; border-radius:8px; border:1px dashed #555;">
                
                <div id="chestInputsRow" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                    <select id="chestAction" onchange="toggleChestPrice()" style="background:#222; color:var(--gold); font-weight:bold; padding:10px; border:1px solid #444; border-radius:4px; width:100%;">
                        <option value="Sprzedam">📦 Sprzedam</option>
                        <option value="Kupię">💰 Kupię</option>
                    </select>
                    
                    <input type="text" id="chestPrice" placeholder="Cena za zestaw (np. 100m)" 
                           oninput="validatePriceInput(this)" 
                           style="border:1px solid #444;">
                </div>

                <div id="chestRowsArea"></div>
                <button onclick="addChestRow()" class="small-btn" style="width:100%; margin-top:5px; border-style:dashed;">+ Dodaj kolejny rodzaj skrzyni</button>
            </div>
            
            <select id="sourceCategory" class="full-width" onchange="updateSourceList()">
                <option value="">-- Wybierz Kategorię --</option>
                <option value="herosi">Herosi</option>
                <option value="e2">Elity II</option>
            </select>
            
            <input type="text" id="sourceSearch" class="full-width search-box" placeholder="🔍 Szukaj przeciwnika..." oninput="updateSourceList()" style="display:none;">
            <select id="itemSource" class="full-width" onchange="updateLootList()"><option value="">-- Przeciwnik --</option></select>
            <input type="text" id="itemSearch" class="full-width search-box" placeholder="🔍 Szukaj przedmiotu..." oninput="updateLootList()" style="display:none;">
            <select id="itemSelect" class="full-width" onchange="fillItemDetails()"><option value="">-- Przedmiot --</option></select>
            <select id="itemBonding" class="full-width" style="border-color: #444;">
                <option value="bound">🔒 Związany (Standard)</option>
                <option value="unbound">🔓 Odwiązany (Unbound)</option>
                <option value="any" style="display:none;">🔓/🔒 Obojętne (To i to)</option>
            </select>

            <div id="livePreview" class="preview-box" style="display: none;">
                <div class="preview-content">
                    <span class="preview-label">Podgląd</span>
                    <span id="previewName" class="preview-text">Wybierz coś...</span>
                </div>
                <div class="preview-icon-wrapper">
                    <img id="previewIcon" src="https://micc.garmory-cdn.cloud/obrazki/itemy/bag/bag.gif" alt="">
                </div>
            </div>

            <div style="display:flex; gap:10px; align-items:center;" class="full-width">
                <input type="text" id="itemName" placeholder="Nazwa przedmiotu" maxlength="50">
                <button class="helper-btn" onclick="searchMargo()" title="Sprawdź statystyki przedmiotu">
                <span>STATYSTYKI</span> 
                <span class="helper-btn-icon">🔍</span>
                </button>
            </div>
            <div class="full-width" style="display:flex; gap:10px; align-items:center;">
                <input type="text" id="itemImg" placeholder="Link do obrazka (lub wybierz plik obok ➡)" oninput="manualImgPreview()" style="flex-grow:1;">
                <label class="small-btn" style="width:auto; padding:0 15px; cursor:pointer; height:42px; display:flex; align-items:center; justify-content:center; background:#222; border:1px solid #444;" title="Wgraj z komputera">
                    📂
                    <input type="file" id="fileUpload" accept="image/*" style="display:none" onchange="window.handleFileUpload(this)">
                </label>
            </div>
            <textarea id="itemDesc" placeholder="Dodatkowy opis..." class="full-width" maxlength="150" rows="2"></textarea>
            
            <button class="action-btn full-width" onclick="addOffer()">Opublikuj na Targu</button>
        </div>
    </div>

    <div id="offersList" class="offers-grid"></div>
</div>

<div id="karczmaPanel">
    <div class="chat-header">
        <h3 style="color:var(--gold); margin:0;">🍻 Karczma</h3>
        <button onclick="toggleKarczma()" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">✕</button>
    </div>
    <div id="chatMessages" class="chat-messages"></div>
<div class="chat-input-area">
        <button onclick="rollDice()" class="small-btn" style="background:#222; border:1px solid #444; width:40px; margin-right:5px;" title="Rzuć kością (1-100)">🎲</button>
        <input type="text" id="chatInput" placeholder="Napisz coś... (Enter wysyła)" style="flex-grow:1;">
        <button onclick="sendChatMessage()" class="small-btn" style="background:var(--gold); color:black;">➤</button>
    </div>
</div>

<div id="editModal" style="display: none; position: fixed; z-index: 10002; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div class="modal-content-full" style="background: #1a1a1a; padding: 30px; border: 2px solid #ffd700; border-radius: 15px; width: 95%; max-width: 600px;">
        <h3 style="color:#ffd700; font-family:'MedievalSharp'; margin-top:0;">Modyfikuj Ogłoszenie</h3>
        
        <input type="text" id="fullEditName" placeholder="Nazwa" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
        <input type="text" id="fullEditPrice" placeholder="Cena" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
        
        <select id="fullEditBonding" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
            <option value="bound">🔒 Związany (Standard)</option>
            <option value="unbound">🔓 Odwiązany (Unbound)</option>
        </select>

        <input type="text" id="fullEditImg" placeholder="Link do obrazka" style="margin-bottom:10px; width:100%; background:#000; color:white; border:1px solid #444; padding:10px;">
        <textarea id="fullEditDesc" rows="4" placeholder="Opis" style="width:100%; background:#000; color:white; border:1px solid #444; padding:10px;"></textarea>
        
        <div style="display:flex; gap:15px; margin-top: 15px;">
            <button onclick="confirmFullEdit()" style="flex:2; background:#ffd700; padding:10px; cursor:pointer; font-weight:bold; border:none;">ZATWIERDŹ</button>
            <button onclick="closeFullEdit()" style="flex:1; background:#333; color:white; padding:10px; cursor:pointer; border:none;">ANULUJ</button>
        </div>
    </div>
</div>

<div id="mailboxModal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid var(--gold); border-radius: 15px; width: 95%; max-width: 500px; max-height:80vh; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="color:var(--gold); font-family:'MedievalSharp'; margin:0;">Skrzynka Odbiorcza</h3>
            <button onclick="document.getElementById('mailboxModal').style.display='none'" style="background:none; border:none; color:#888; font-size:1.5em; cursor:pointer;">✕</button>
        </div>
        <div id="mailboxContent" class="mail-list"></div>
    </div>
</div>

<div id="debtsModal" style="display: none; position: fixed; z-index: 10010; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center;">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid var(--red); border-radius: 15px; width: 95%; max-width: 500px; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="color:var(--red); font-family:'MedievalSharp'; margin:0;">Zeszyt Dłużników</h3>
            <button onclick="document.getElementById('debtsModal').style.display='none'" style="background:none; border:none; color:#888; font-size:1.5em; cursor:pointer;">✕</button>
        </div>
		
        <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:8px; margin-bottom:10px; display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <input type="text" id="debtWho" placeholder="Kto pożyczył? (Nick)" style="padding:8px;">
            <input type="text" id="debtAmount" placeholder="Ile? (np. 100m)" style="padding:8px;">
            <input type="text" id="debtNote" placeholder="Na co / Data zwrotu" class="full-width" style="padding:8px; grid-column: 1/-1;">
            <button onclick="addDebt()" class="full-width" style="background:var(--red); color:white; border:none; padding:8px; cursor:pointer; font-weight:bold; border-radius:4px;">DODAJ WPIS</button>
        </div>

        <div id="debtsListContent" class="debt-list">Ładowanie...</div>
    </div>
</div>

<div id="annModal" style="display: none; position: fixed; z-index: 10020; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center;">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid #ff6666; border-radius: 12px; width: 90%; max-width: 500px;">
        <h3 style="color:#ff6666; margin-top:0;">Edytuj Ogłoszenie</h3>
        <textarea id="annInputText" rows="6" style="width:100%; margin-bottom:15px; background:#000; color:#eee; border:1px solid #444; padding:10px;" placeholder="Wpisz treść ogłoszenia..."></textarea>
        <div style="display:flex; gap:10px;">
            <button onclick="saveAnnouncement()" class="action-btn" style="background:#8B0000; color:white;">OPUBLIKUJ</button>
            <button onclick="document.getElementById('annModal').style.display='none'" style="background:#333; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer;">ANULUJ</button>
        </div>
    </div>
</div>

<div id="helpModal" style="display: none; position: fixed; z-index: 10030; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid var(--gold); border-radius: 12px; width: 90%; max-width: 600px; max-height: 85vh; overflow-y: auto; position: relative;">
        
        <button onclick="document.getElementById('helpModal').style.display='none'" style="position:absolute; top:15px; right:15px; background:none; border:none; color:#888; font-size:1.5em; cursor:pointer;">✕</button>
        
        <h2 style="color:var(--gold); font-family:'MedievalSharp'; margin-top:0; text-align:center; border-bottom:1px solid #333; padding-bottom:10px;">
            📜 Przewodnik Klanowicza
        </h2>

        <div class="help-content">
            
            <details>
                <summary>🗡️ Jak wystawiać i kupować?</summary>
                <p>Kliknij <b>+ WYSTAW ARTEFAKT</b>. Formularz zmienia się zależnie od tego, co wybierzesz:</p>
                <ul>
                    <li><b>Sprzedam:</b> Podajesz cenę w <i>k, m, g</i> lub walucie <i>PLN/ZŁ</i>.</li>
                    <li><b>Kupię:</b> Nie wpisujesz ceny, tylko wybierasz formę płatności (Złoto, Gotówka, Mix).</li>
                    <li><b>Zamienię:</b> Możesz zaznaczyć opcję "Dopłacam", jeśli dorzucasz coś do wymiany.</li>
                    <li><b>Kłódki:</b> Przy kupnie możesz zaznaczyć "Obojętne (🔓/🔒)", jeśli nie zależy Ci na statusie wiązania.</li>
                </ul>
            </details>

            <details>
                <summary>⚖️ Podziały Łupów (50/50)</summary>
                <p>Kliknij ikonę wagi (⚖️) w menu górnym. Służy do rozliczania bić herosów i E2.</p>
                <ul>
                    <li><b>Równy podział:</b> Cała kwota dzielona jest po równo na wszystkich uczestników.</li>
                    <li><b>Zasada Znalazcy:</b> Wybierasz jednego "Szefa" (dostaje 50%), reszta dzieli się drugą połową.</li>
                    <li><b>Wykrywajka:</b> Dwóch VIP-ów (Szef + Wykrywacz) dzieli między siebie 50%, reszta ekipy bierze drugą połowę.</li>
                </ul>
                <p><small>Historia ostatnich podziałów jest widoczna dla każdego.</small></p>
            </details>

            <details>
                <summary>🧮 Kalkulatory (Prawy pasek)</summary>
                <p>Ikony po prawej stronie ekranu:</p>
                <ul>
                    <li><b style="color:#2ecc71">Zielona (Ekstrakcja):</b> Liczy koszt wyjęcia ulepszenia w złocie i SŁ (uwzględnia zwrot 75% lub 100%).</li>
                    <li><b style="color:var(--gold)">Złota (Ulepszanie):</b> Liczy koszt wbicia przedmiotu na +1, +2 itd. (uwzględnia mnożniki).</li>
                    <li><b style="color:#9b59b6">Fioletowa (Esencja):</b> Szybki przelicznik wartości esencjalnej przedmiotu.</li>
                </ul>
            </details>

            <details>
                <summary>📦 Skrzynki i Drop</summary>
                <ul>
                    <li><b>Sprzedaż skrzynek:</b> W formularzu wybierz typ "Sprzedaż Skrzynek". Możesz dodać kilka rodzajów skrzyń do jednego ogłoszenia (np. zestaw).</li>
                    <li><b>(s) w nazwie:</b> Przedmioty typu "Lekka skrytka..." trafiają automatycznie do zakładki <b>Skrzynki</b>, żeby nie zaśmiecać handlu.</li>
                    <li><b>Bestiariusz:</b> Kliknij księgę (📖) po prawej, by sprawdzić co leci z danego potwora.</li>
                </ul>
            </details>

            <details>
                <summary>📜 Zeszyt Dłużników</summary>
                <p>Ikona papirusu (📜) u góry. To Twoje prywatne notatki. Zapisuj tu, komu pożyczyłeś złoto. Możesz oznaczać długi jako "Spłacone" (zielony ptaszek) lub usuwać je całkowicie.</p>
            </details>

        </div>
        
        <div style="text-align:center; margin-top:20px; color:#666; font-size:0.8em;">
            <em>Kondor Airlines System v2.0</em>
        </div>
    </div>
</div>
	
<div id="composeModal" style="display: none; position: fixed; z-index: 10001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); align-items: center; justify-content: center;">
    <div style="background: #1a1a1a; padding: 25px; border: 1px solid var(--purple); border-radius: 12px; width: 90%; max-width: 400px;">
        <h4 style="color:#cca3ff; margin-top:0;">Wyślij wiadomość</h4>
        <div style="color:#aaa; font-size:0.9em; margin-bottom:10px;">Do: <span id="composeRecipient" style="color:#fff; font-weight:bold;">...</span></div>
        <div style="color:#aaa; font-size:0.9em; margin-bottom:10px;">Dotyczy: <span id="composeSubject" style="color:var(--gold);">...</span></div>
        <textarea id="composeText" rows="4" style="width:100%; margin-bottom:15px;" placeholder="Treść wiadomości..."></textarea>
        <div style="display:flex; gap:10px;">
            <button onclick="sendInternalMessage()" class="action-btn" style="background:var(--purple); color:white;">WYŚLIJ</button>
            <button onclick="document.getElementById('composeModal').style.display='none'" style="background:#333; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer;">ANULUJ</button>
        </div>
    </div>
</div>

<div id="rightSidebar" class="sidebar-container">
    
    <button class="side-btn jackpot-btn-style" onclick="openJackpot()" title="Jackpot">🎰</button>
    
    <button class="side-btn quotes-btn-style" onclick="toggleQuotes()" title="Złote Usta">🏆</button>
    
    <button class="side-btn extract-btn-style" onclick="toggleExtract()" title="Ekstrakcja">
        <img src="https://micc.garmory-cdn.cloud/obrazki/itemy/upg/lege_enh_ball.gif">
    </button>
    
    <button class="side-btn upgrade-btn-style" onclick="toggleUpgrade()" title="Ulepszanie">
        <img src="https://micc.garmory-cdn.cloud/obrazki/npc/mez/npc249.gif">
    </button>
    
    <button class="side-btn essence-btn-style" onclick="toggleEssence()" title="Esencja">
        <img src="https://micc.garmory-cdn.cloud/obrazki/itemy/neu/pyl-sakryfikacji.gif">
    </button>
    
    <button class="side-btn encyclo-btn-style" onclick="toggleEncyclopedia()" title="Bestiariusz">📖</button>
    
    <button class="side-btn calc-btn-style" onclick="toggleCalc()" title="Podział Łupu">💰</button>

</div>

<button class="sidebar-toggle-main" onclick="toggleSidebar()" title="Pokaż/Ukryj Menu">👁️</button>


<div id="extractModal" style="display: none; position: fixed; z-index: 10009; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; backdrop-filter: blur(3px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid #2ecc71; border-radius: 12px; width: 90%; max-width: 400px; position:relative; text-align:center;">
        <button onclick="document.getElementById('extractModal').style.display='none'" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#888; cursor:pointer; font-size:1.2em;">✕</button>
        <h3 style="color:#2ecc71; font-family:'MedievalSharp'; margin-top:0;">Kalkulator Ekstrakcji</h3>
        <img src="https://micc.garmory-cdn.cloud/obrazki/itemy/upg/lege_enh_ball.gif" style="margin-bottom:15px; height: 50px;">
        <div style="text-align:left; display:flex; flex-direction:column; gap:10px;">
            <div>
                <label style="color:#aaa; font-size:0.75em; text-transform:uppercase;">Zainwestowane Punkty Ulepszenia (PU)</label>
                <input type="number" id="extPU" placeholder="np. 50000" style="padding:10px;">
            </div>
            <div>
                <label style="color:#aaa; font-size:0.75em; text-transform:uppercase;">Efektywność odzysku</label>
                <select id="extRate">
                    <option value="0.75">Standardowa (75%)</option>
                    <option value="1.0">Specjalna (100%)</option>
                </select>
            </div>
        </div>
        <button onclick="calculateExtraction()" class="action-btn" style="margin-top:20px; background:#2ecc71; color:white;">Oblicz odzysk</button>
        <div id="extResult" class="calc-result" style="display:none; text-align:left; border-color:#2ecc71;"></div>
    </div>
</div>

<div id="upgradeModal" style="display: none; position: fixed; z-index: 10008; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; backdrop-filter: blur(3px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid var(--gold); border-radius: 12px; width: 90%; max-width: 400px; position:relative; text-align:center;">
        <button onclick="document.getElementById('upgradeModal').style.display='none'" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#888; cursor:pointer; font-size:1.2em;">✕</button>
        <h3 style="color:var(--gold); font-family:'MedievalSharp'; margin-top:0;">Kalkulator Ulepszania</h3>
        <img src="https://micc.garmory-cdn.cloud/obrazki/npc/mez/npc249.gif" style="margin-bottom:15px; height: 60px;">
        <div style="text-align:left; display:flex; flex-direction:column; gap:10px;">
            <div>
                <label style="color:#aaa; font-size:0.75em; text-transform:uppercase;">Poziom przedmiotu (lvl)</label>
                <input type="number" id="upLvl" placeholder="np. 100" style="padding:10px;">
            </div>
            <div>
                <label style="color:#aaa; font-size:0.75em; text-transform:uppercase;">Rzadkość przedmiotu</label>
                <select id="upRarity">
                    <option value="common">Zwykły</option>
                    <option value="unique">Unikatowy</option>
                    <option value="heroic">Heroiczny</option>
                    <option value="improved">Ulepszony</option>
                    <option value="legendary">Legendarny</option>
                </select>
            </div>
            <div>
                <label style="color:#aaa; font-size:0.75em; text-transform:uppercase;">Docelowy poziom (+)</label>
                <select id="upTarget">
                    <option value="1">+1</option>
                    <option value="2">+2</option>
                    <option value="3">+3</option>
                    <option value="4">+4</option>
                    <option value="5">+5</option>
                </select>
            </div>
        </div>
        <button onclick="calculateUpgrade()" class="action-btn" style="margin-top:20px;">Oblicz koszty</button>
        <div id="upResult" class="calc-result" style="display:none; text-align:left; font-size:0.85em;"></div>
    </div>
</div>

<div id="essenceModal" style="display: none; position: fixed; z-index: 10007; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; backdrop-filter: blur(3px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid #9b59b6; border-radius: 12px; width: 90%; max-width: 350px; position:relative; text-align:center;">
        
        <button onclick="document.getElementById('essenceModal').style.display='none'" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#888; cursor:pointer; font-size:1.2em;">✕</button>
        
        <h3 style="color:#cca3ff; font-family:'MedievalSharp'; margin-top:0;">Kalkulator Esencji</h3>
        <img src="https://micc.garmory-cdn.cloud/obrazki/itemy/neu/pyl-sakryfikacji.gif" style="margin-bottom:15px;">

        <div style="margin-bottom:20px; text-align:left;">
            <label style="color:#aaa; font-size:0.8em; display:block; margin-bottom:5px;">Poziom przedmiotu (lvl)</label>
            <input type="number" id="essLvl" placeholder="np. 185" style="width:100%; padding:10px; background:#000; border:1px solid #444; color:white; border-radius:5px;">
        </div>

        <button onclick="calculateEssence()" class="action-btn" style="background:var(--purple); color:white;">OBLICZ WARTOŚĆ</button>
        
        <div id="essResult" class="calc-result" style="display:none; border-color:#9b59b6; color:#cca3ff; margin-top:15px;">
            Wynik...
        </div>
    </div>
</div>
	
<div id="encyclopediaModal" style="display: none; position: fixed; z-index: 10006; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid #ccc; border-radius: 12px; width: 95%; max-width: 700px; height: 80vh; display:flex; flex-direction:column; position:relative;">
        <button onclick="document.getElementById('encyclopediaModal').style.display='none'" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#888; cursor:pointer; font-size:1.5em;">✕</button>
        <h3 style="color:#ccc; font-family:'MedievalSharp'; margin-top:0; text-align:center; font-size: 1.8em;">Bestiariusz & Drop</h3>
        
        <div class="bestiary-tabs">
            <button class="tab-btn active" onclick="switchBestiaryTab('herosi')">Herosi</button>
            <button class="tab-btn" onclick="switchBestiaryTab('e2')">Elity II</button>
        </div>
        
        <div id="bestiaryContent" class="bestiary-grid">
            </div>
    </div>
</div>

<div id="calcModal" style="display: none; position: fixed; z-index: 10005; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; backdrop-filter: blur(3px);">
    <div style="background: #1a1a1a; padding: 25px; border: 2px solid var(--gold); border-radius: 12px; width: 90%; max-width: 400px; position:relative;">
        <button onclick="document.getElementById('calcModal').style.display='none'" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#888; cursor:pointer; font-size:1.2em;">✕</button>
        <h3 style="color:var(--gold); font-family:'MedievalSharp'; margin-top:0; text-align:center;">Kalkulator Łupu</h3>
        
        <label style="color:#aaa; font-size:0.8em;">Kwota sprzedaży (np. 1.2g, 150m)</label>
        <input type="text" id="calcAmount" placeholder="np. 1.2g lub 1200m" style="margin-bottom:10px;">
        
        <label style="color:#aaa; font-size:0.8em;">Liczba osób (razem)</label>
        <input type="number" id="calcPlayers" value="2" min="1" style="margin-bottom:10px;">

        <label style="color:#aaa; font-size:0.8em;">Tryb podziału:</label>
        <select id="calcMode" style="margin-bottom:15px; width: 100%; background: #000; color: #eee; border: 1px solid #444; padding: 10px; border-radius: 5px;">
            <option value="equal">⚖️ Równy podział</option>
            <option value="finder">👑 Zasada Znalazcy (1 os. 50%)</option>
            <option value="detector">👁️ Wykrywajka (2 os. po 25%)</option>
        </select>

        <button onclick="calculateLoot()" class="action-btn" style="background:var(--green);">OBLICZ PODZIAŁ</button>
        <div id="calcOutput" class="calc-result" style="display:none;">Wynik...</div>
    </div>
</div>

	<div id="quotesModal" style="display: none; position: fixed; z-index: 10040; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div style="background: #1a1a1a; padding: 20px; border: 2px solid var(--gold); border-radius: 15px; width: 95%; max-width: 600px; height: 80vh; display:flex; flex-direction:column;">
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:10px;">
            <h3 style="color:var(--gold); font-family:'MedievalSharp'; margin:0; font-size:1.6em;">🏆 Złote Usta Klanu</h3>
            <button onclick="document.getElementById('quotesModal').style.display='none'" style="background:none; border:none; color:#888; font-size:1.5em; cursor:pointer;">✕</button>
        </div>

        <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; margin-bottom:15px; display:flex; gap:5px;">
            <input type="text" id="quoteContent" placeholder="Cytat (np. 'Leczę to!' - Zdzichu, gdy padł)" style="flex:3;">
            <input type="text" id="quoteAuthor" placeholder="Kto to powiedział?" style="flex:1;">
            <button onclick="addQuote()" class="small-btn" style="flex:0.5; background:var(--gold); color:black;">➕</button>
        </div>

        <div id="quotesList" style="flex-grow:1; overflow-y:auto; display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:15px; padding-right:5px;">
            </div>
    </div>
</div>

<button onclick="topFunction()" id="scrollTopBtn" title="Wróć na górę">▲</button>
<div id="toast-container"></div>

<div id="splitModal" style="display: none; position: fixed; z-index: 10050; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center;">
    <div style="background: #0f0f0f; border: 2px solid #00ffff; border-radius: 12px; width: 95%; max-width: 650px; display:flex; flex-direction:column; max-height: 90vh; box-shadow: 0 0 30px rgba(0, 255, 255, 0.1); overflow: hidden;">
        
        <div style="background: linear-gradient(90deg, #111 0%, #1a2a2a 100%); padding: 15px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333;">
            <h3 style="color:#00ffff; font-family:'MedievalSharp'; margin:0; font-size:1.4em;">⚖️ Podziały 50/50</h3>
            <button onclick="document.getElementById('splitModal').style.display='none'" style="background:none; border:none; color:#888; font-size:1.5em; cursor:pointer;">✕</button>
        </div>

        <div style="overflow-y:auto; padding: 20px;">
            <div class="split-section">
                <span class="split-label">1. Wybierz Przeciwnika:</span>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <button class="type-btn-split" onclick="selectSplitMobType('herosi', this)">👹 Herosi</button>
                    <button class="type-btn-split" onclick="selectSplitMobType('e2', this)">💀 E2</button>
                </div>
                <select id="splitMobSelect" onchange="renderSplitLoot(this.value)" style="width:100%; padding:10px; background:#222; color:#fff; border:1px solid #444; display:none;"></select>
            </div>

            <div id="splitLootSection" class="split-section" style="display:none;">
                <span class="split-label">2. Wybierz Przedmiot:</span>
                <div id="splitLootGrid" class="loot-grid-select"></div>
                <input type="hidden" id="splitSelectedName">
				<input type="hidden" id="splitSelectedImg">
            </div>

			<div class="split-section">
                <span class="split-label">Wybierz Tryb Podziału:</span>
                <select id="splitMode" onchange="updateSplitUI(); window.playSound('click')" style="width:100%; padding:10px; background:#222; color:#eee; border:1px solid #444; border-radius:5px;">
                    <option value="equal">⚖️ Równy podział</option>
                    <option value="finder">👑 Zasada Znalazcy (Szef 50%)</option>
                    <option value="detector">👁️ Wykrywajka (Szef + 1 os. po 25%)</option>
                </select>
            </div>
			
            <div class="split-section">
                <span class="split-label">3. Kwota sprzedaży:</span>
                <input type="text" id="splitFinalAmount" placeholder="np. 1.2g lub 500m" style="width:100%; padding:10px; text-align:center; background:#111; color:#00ffff; font-weight:bold; border:1px solid #444;">
            </div>

            <div class="split-section">
    <span class="split-label">4. Wybierz uczestników:</span>
    
    <div id="bossSection">
        <span id="bossLabel" style="color:gold; font-size:0.8em;">👑 SZEF (50%):</span>
        <div id="splitBossGrid" class="user-grid-split"></div>
    </div>

    <div style="margin-top:15px;">
        <span id="teamLabel" style="color:cyan; font-size:0.8em;">⚔️ EKIPA:</span>
        <div id="splitTeamGrid" class="user-grid-split"></div>
    </div>
</div>

            <button onclick="saveFinalSplit()" class="action-btn" style="width:100%; background:#008b8b; color:white; border:1px solid #00ffff;">ZAPISZ I WYŚLIJ</button>

            <div id="splitHistoryContent" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;"></div>
        </div>
    </div>
</div>

<div id="jackpotModal" class="jackpot-modal-window" style="display: none; position: fixed; z-index: 10060; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div style="background: #111; border: 2px solid var(--gold); border-radius: 12px; width: 95%; max-width: 800px; display:flex; flex-direction:column; overflow:hidden; box-shadow: 0 0 50px rgba(255, 215, 0, 0.2); max-height: 95vh;">
        
        <div style="background: linear-gradient(90deg, #222, #000); padding: 10px 15px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:1.5em;">🎰</span>
                <div>
                    <h3 style="color:var(--gold); margin:0; font-family:'MedievalSharp'; line-height:1;">Klanowy JACKPOT</h3>
                </div>
            </div>
            <div id="jackpotTimer" style="font-family:'MedievalSharp'; font-size:1.5em; color:#fff; text-shadow:0 0 10px red; display:none;">60.00</div>
            <button onclick="document.getElementById('jackpotModal').style.display='none'" style="background:none; border:none; color:#888; font-size:1.5em; cursor:pointer;">✕</button>
        </div>

        <div class="jp-tabs">
            <div class="jp-tab active-low" onclick="switchJackpotTier('low')" id="tab-low">🟢 LOW (1m-100m)</div>
            <div class="jp-tab" onclick="switchJackpotTier('medium')" id="tab-medium">🟡 MEDIUM (1m-500m)</div>
            <div class="jp-tab" onclick="switchJackpotTier('high')" id="tab-high">🔴 NO LIMIT (max 10g)</div>
        </div>

        <div class="jackpot-rail">
            <div class="jackpot-pointer">▼</div>
            <div class="jackpot-strip" id="jackpotStrip"></div>
        </div>

        <div class="jp-grid-container">
            
            <div>
                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:8px; margin-bottom:15px; text-align:center;">
                    <div style="color:#aaa; font-size:0.8em; text-transform:uppercase;">Aktualna Pula (<span id="poolLabel">LOW</span>)</div>
                    <div id="jackpotTotalPool" style="font-size:1.8em; color:var(--green); font-weight:bold; text-shadow:0 0 15px rgba(46, 204, 113, 0.4);">0</div>
                </div>

                <div id="jackpotControls">
                    <label style="color:#888; font-size:0.8em;" id="limitLabel">Limit wpłaty: 1m - 100m</label>
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <input type="text" id="jackpotBetAmount" placeholder="np. 50m" style="flex:1;">
                        <button id="joinBtn" onclick="joinJackpot()" class="action-btn" style="flex:1; background:linear-gradient(to bottom, #ffd700, #b8860b); color:black; font-size:0.9em;">WCHODZĘ! 💰</button>
                    </div>
                </div>
                
                <div id="jackpotWinnerDisplay" style="display:none; text-align:center; padding:20px;">
                    <h2 style="color:var(--gold); margin:0;">WYGRYWA:</h2>
                    <div id="winnerNick" style="font-size:1.5em; font-weight:bold; color:#fff;">...</div>
                    <div id="winAmount" style="color:var(--green);">...</div>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:10px; height:100%; overflow:hidden;">
                
                <div class="jp-inner-box" style="background:rgba(0,0,0,0.3); border:1px solid #333; border-radius:8px; display:flex; flex-direction:column; flex:1; min-height:0; overflow:hidden;">
                    <div style="padding:8px; border-bottom:1px solid #333; font-weight:bold; color:#aaa; font-size:0.7em; background:rgba(0,0,0,0.2); flex-shrink: 0;">
                        OBECNA RUNDA
                    </div>
                    <div id="jackpotPlayersList" style="overflow-y:auto; padding:5px; flex-grow: 1;"></div>
                </div>

                <div class="jp-inner-box" style="background:rgba(0,0,0,0.3); border:1px solid #333; border-radius:8px; display:flex; flex-direction:column; flex:1; min-height:0; overflow:hidden;">
                    <div style="padding:8px; border-bottom:1px solid #333; font-weight:bold; color:#aaa; font-size:0.7em; background:rgba(0,0,0,0.2); flex-shrink: 0;">
                        OSTATNI ZWYCIĘZCY
                    </div>
                    <div id="jackpotHistoryList" style="overflow-y:auto; padding:5px; flex-grow: 1;">
                        <div style="text-align:center; color:#555; padding:10px; font-size:0.8em;">Ładowanie...</div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
	
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, getDoc, setDoc, getDocs, updateDoc, where, limit, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyApFYFkAghXreeX_xptg-PTCSxtPdiXYdA",
      authDomain: "targowisko-klanu.firebaseapp.com",
      projectId: "targowisko-klanu",
      storageBucket: "targowisko-klanu.firebasestorage.app",
      messagingSenderId: "1002027435908",
      appId: "1:1002027435908:web:56419c7bc38e148cf0ffd1"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();
    
    window.escapeHtml = function(text) { return text ? text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") : ""; };
    window.isValidImageUrl = (url) => url && /^https?:\/\/[^<>"]+\.(jpeg|jpg|gif|png|webp|bmp)$/i.test(url);
    
    const ADMIN_NICK = "Stachu Drzymała";
    const ADMIN_UID = "9rFgcWVJwBWyykHf6nuIwyGFrPR2"; 
    
    let currentUser = null;
    let currentNick = null;
    // ... dalej reszta Twojego kodu (let allOffers = []; itd.)
    let allOffers = [];
    let inboxMessages = [];
    let activeUsers = {};
    let currentFilters = { type: 'all', cat: 'all' };
    let currentEditId = null;
    let composeTarget = {};
    let isMuted = false;

	// --- TABLICA OGŁOSZEŃ ---
    let annUnsub = null;

    // Funkcja nasłuchująca na zmiany w ogłoszeniu
    function startAnnouncementListener() {
        // Bierzemy zawsze dokument o ID 'main' z kolekcji 'ogloszenia'
        annUnsub = onSnapshot(doc(db, "ogloszenia", "main"), (docSnap) => {
            const board = document.getElementById('announcementBoard');
            const content = document.getElementById('annContent');
            const meta = document.getElementById('annMeta');
            const editBtn = document.getElementById('editAnnBtn');

            // Pokaż przycisk edycji tylko adminowi
            if (currentNick === ADMIN_NICK) {
                editBtn.style.display = 'block';
            }

            if (docSnap.exists()) {
                const data = docSnap.data();
                if (data.text && data.text.trim().length > 0) {
                    board.style.display = 'block'; // Pokaż tablicę tylko jak jest treść
                    content.innerText = data.text;
                    const date = new Date(data.date).toLocaleString();
                    meta.innerText = `Opublikował: ${data.author} | ${date}`;
                } else {
                    // Jeśli treść pusta, ukryj dla zwykłych, pokaż dla admina żeby mógł dodać
                    board.style.display = (currentNick === ADMIN_NICK) ? 'block' : 'none';
                    if(currentNick === ADMIN_NICK) {
                        content.innerHTML = "<i>(Brak ogłoszeń. Kliknij Edytuj, aby coś napisać)</i>";
                        meta.innerText = "";
                    }
                }
            } else {
                // Dokument nie istnieje (pierwsze uruchomienie)
                board.style.display = (currentNick === ADMIN_NICK) ? 'block' : 'none';
                if(currentNick === ADMIN_NICK) {
                    content.innerHTML = "<i>(Brak ogłoszeń. Kliknij Edytuj, aby utworzyć pierwsze)</i>";
                }
            }
        });
    }

    window.openAnnModal = () => {
        const currentText = document.getElementById('annContent').innerText;
        // Jeśli to tekst zastępczy, wyczyść input
        if(currentText.includes("(Brak ogłoszeń")) {
            document.getElementById('annInputText').value = "";
        } else {
            document.getElementById('annInputText').value = currentText;
        }
        document.getElementById('annModal').style.display = 'flex';
    };

    window.saveAnnouncement = async () => {
        const txt = document.getElementById('annInputText').value;
        
        // Zapisujemy pod stałym ID "main", żeby zawsze nadpisywać to samo ogłoszenie
        await setDoc(doc(db, "ogloszenia", "main"), {
            text: txt,
            author: currentNick,
            date: new Date().toISOString()
        });

        document.getElementById('annModal').style.display = 'none';
        window.playSound('coin');
        window.alert("Ogłoszenie zaktualizowane!");
    };

    // Dodaj uruchomienie nasłuchu przy starcie (tam gdzie masz startMailListener)
    // Znajdź w kodzie: if(user) { ... } i dodaj tam:
    // startAnnouncementListener();
	
    // --- SOUND SYSTEM ---
    const sounds = {
        click: document.getElementById('snd-click'),
        coin: document.getElementById('snd-coin'),
        mail: document.getElementById('snd-mail'),
        chat: document.getElementById('snd-chat')
    };
    window.playSound = (type) => {
        if (isMuted || !sounds[type]) return;
        sounds[type].currentTime = 0;
        sounds[type].volume = 0.4;
        sounds[type].play().catch(e => {});
    };
    window.toggleMute = () => {
        isMuted = !isMuted;
        document.getElementById('muteIcon').innerText = isMuted ? '🔇' : '🔊';
        window.alert(isMuted ? "Wyciszono dźwięki." : "Dźwięki włączone.");
    };
    document.addEventListener('click', (e) => {
        if(e.target.tagName === 'BUTTON' || e.target.closest('button')) window.playSound('click');
    });

    // --- ZEGAR GRY ---
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('pl-PL');
        const clockEl = document.getElementById('gameClock');
        if(clockEl) clockEl.innerText = timeString;
    }
    setInterval(updateClock, 1000);
    updateClock();

	// BAZA SKRZYNEK (Uzupełnij linki, jeśli brakuje)
    const chestList = [
        { name: "Skrzynia Mrocznego Patryka", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_patryk1.gif" },
        { name: "Skrzynia Karmazynowego Mściciela", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_karm.gif" },
        { name: "Skrzynia Złodzieja", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_zlodziej.gif" },
        { name: "Skrzynia Złego Przewodnika", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_przew.gif" },
        { name: "Skrzynia Opętanego Paladyna", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_opek.gif" },
        { name: "Skrzynia Piekielnego Kościeja", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_kosciej.gif" },
        { name: "Skrzynia Koźca", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_koziec.gif" },
        { name: "Skrzynia Kochanki Nocy", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_kochanka.gif" },
        { name: "Skrzynia Księcia Kasima", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_kasim1.gif" },
		{ name: "Skrzynia Świętego Braciszka", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_braciszek.gif" },
        { name: "Skrzynia Złotego Rogera", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_pirat_zlota.gif" },
        { name: "Skrzynia Bacy bez łowiec", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz-baca.gif" },
        { name: "Skrzynia Czarującej Atalii", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_atka.gif" },
        { name: "Skrzynia Obłąkanego łowcy orków", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/oblo_chest.gif" },
        { name: "Skrzynia Lichwiarza Grauhaza", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_lichwa.gif" },
        { name: "Skrzynia Viviany Nandin", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/kon/viviana-chest.gif" },
        { name: "Skrzynia Przerazy", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_przeraza.gif" },
        { name: "Skrzynia Demonisa Pana Nicości", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/kon/dem_chest.gif" },
		{ name: "Skrzynia Mulher Ma", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_mulher.gif" },
        { name: "Skrzynia Vapor Veneno", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_vapor.gif" },
        { name: "Skrzynia Dęborożca", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_debo.gif" },
        { name: "Skrzynia Tepeyollotla", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_tepey.gif" },
		{ name: "Skrzynia Widma Triady", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/skrz_triada.gif" }



    ];
	
    const monstersList = {
        herosi: [
            { name: "Mroczny Patryk (35 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/bardzozlypatryk.gif" },
            { name: "Karmazynowy Mściciel (45 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/gnom_msciciel.gif" },
            { name: "Złodziej (51 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/zlodziej.gif" },
            { name: "Zły Przewodnik (63 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/mnich-zly2.gif" },
            { name: "Opętany Paladyn (74 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/opetanypaladyn02.gif" },
            { name: "Piekielny Kościej (85 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/piekielny_kosciej.gif" },
            { name: "Koziec Mąciciel Ścieżek (94lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/koziec_maciciel_sciezek.gif" },
            { name: "Kochanka Nocy (102 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/kochanka-nocy.gif" },
            { name: "Książę Kasim (116 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/ksiaze-kasim.gif" },
            { name: "Święty Braciszek (123 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/sw_braciszek.gif" },
            { name: "Złoty Roger (135 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/szkielet_pirata.gif" },
            { name: "Baca bez łowiec (144 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/baca-bez-lowiec.gif" },
            { name: "Czarująca Atalia (157 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/czarujaca-atalia.gif" },
            { name: "Obłąkany Łowca Orków (165 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/oblakany_ac1dae9d.gif" },
            { name: "Lichwiarz Grauhaz (177 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/lichwiarz_grauhaz.gif" },
            { name: "Viviana Nandin (185 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/viv_nandin_i3bd1.gif" },
            { name: "Przeraza (194 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/przeraza.gif" },
            { name: "Demonis Pan Nicości (205 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/sekta_demon_cz_s.gif" },
            { name: "Mulher Ma (214 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/mulher_ma.gif" },
            { name: "Vapor Veneno (231 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/joziniec_bagienny.gif" },
            { name: "Dęborożec (244 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/zwierz_kniei.gif" },
            { name: "Tepeyollotl (258 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/tep_35ecb966.gif" },
            { name: "Widmo Triady (265 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/trist2_widmo_triady.gif" },
            { name: "Negthotep Czarny Kapłan (271 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/negthotep.gif" },
            { name: "Młody Smok (282 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/her/smokbarb.gif" }
        ],
        e2: [
            { name: "Mushita (23 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/st-puma.gif" },
            { name: "Kotołak Tropiciel (27 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e1/kotolak_lowca.gif" },
            { name: "Shae Phu (30 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/demonszef.gif" },
            { name: "Zorg Jednooki Baron (33 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zbir-e2-zorg.gif" },
            { name: "Władca Rzek (37 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gobmag2.gif" },
            { name: "Gobbos (40 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gobsamurai.gif" },
            { name: "Tyrtajos (42 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/dzik.gif" },
            { name: "Szczet alias Gładki (47 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zbir-szczet.gif" },
            { name: "Tollok Shimager (47 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tollok_shimger.gif" },
            { name: "Razuglag Oklash (51 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/razuglag.gif" },
            { name: "Agar (51 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/glut_agar.gif" },
            { name: "Foverk Turrim (57 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/kobold07.gif" },
            { name: "Owadzia Matka (58 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zadlak-e2-owadzia-matka.gif" },
            { name: "Vari Kruger (66 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnoll11.gif" },
            { name: "Furruk Kozug (66 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnoll12.gif" },
            { name: "Jotun (70 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/kam_olbrzym-b.gif" },
            { name: "Tollok Atamatu (73 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tollok_jask_atamatu.gif" },
            { name: "Lisz (75 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/lisz_demilisze.gif" },
            { name: "Grabarz Świątynny (80 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/nieu_mnich_grabarz.gif" },
            { name: "Podły zbrojmistrz (82 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/magaz_zbrojmistrz.gif" },
            { name: "Wielka Stopa (82 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wlochacze_wielka_stopa.gif" },
            { name: "Choukker (84 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/dlawiciel5.gif" },
            { name: "Nadzorczyni krasnoludów (88 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/nadzorczyni_krasnoludow.gif" },
            { name: "Morthen (89 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/krasnolud_boss.gif" },
            { name: "Żelazoręki Ohydziarz (92 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/ugrape2.gif" },
            { name: "Leśne Widmo (92 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/lesne_widmo.gif" },
            { name: "Goplana (93 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goplana.gif" },
            { name: "Gnom Figlid (96 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnom_figlid.gif" },
	    { name: "Centaur Zyfryd (99 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/gnom_figlid.gif" },
            { name: "Kambion (101 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/kambion.gif" },
            { name: "Jertek Moxos (105 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/moloch-jertek.gif" },
            { name: "Miłośnik łowców (108 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/blotniaki_milosnik_lowcow.gif" },
            { name: "Miłośnik rycerzy (108 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/blotniaki_milosnik_rycerzy.gif" },
            { name: "Miłośnik magii (108 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/blotniaki_milosnik_magii.gif" },
            { name: "Łowca czaszek (112 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/alghul-czaszka-1a.gif" },
            { name: "Ozirus Władca Hieroglifów (115 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mumia-ozirus.gif" },
            { name: "Morski potwór (118 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/osmiornica-1b.gif" },
            { name: "Krab pustelnik (124 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/krab_big3.gif" },
            { name: "Borgoros Garamir III (124 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/ingotia_minotaur-7a.gif" },
            { name: "Stworzyciel (125 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/stworzyciel.gif" },
            { name: "Ifryt (128 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/magradit_ifryt.gif" },
            { name: "Henry Kaprawe Oko (131 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e1/pirat5b.gif" },
            { name: "Helga Opiekunka Rumu (131 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/pirat-2b.gif" },
            { name: "Młody Jack Truciciel (131 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/pirat01.gif" },
            { name: "Eol (135 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/piaskowy_potwor-6a.gif" },
            { name: "Grubber Ochlaj (136 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/grubber-ochlaj.gif" },
            { name: "Mistrz Worundriel (139 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/worundriel02.gif" },
            { name: "Wójt Fistuła (144 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goral-e2-wojt-fistula.gif" },
            { name: "Teściowa Rumcajsa (145 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goral-e2-tesciowa-rumcajsa.gif" },
            { name: "Berserker Amuno (148 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/amuno.gif" },
{ name: "Fodug Zolash (150 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/fodug_zolash.gif" },
{ name: "Goons Asterus (154 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/goons_asterus-1a.gif" },
{ name: "Adariel (155 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tri_adariel.gif" },
{ name: "Sheba Orcza Szamanka (160 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/r_orc_sheba.gif" },
{ name: "Burkog Lorulk (160 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/orkczd.gif" },
{ name: "Duch Władcy Klanów (165 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/duch_wladcy_kl.gif" },
{ name: "Bragarth Myśliwy Dusz (170 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/praork_low_elita.gif" },
{ name: "Fursharag Pożeracz Umysłów (170 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/praork_mag_elita.gif" },
{ name: "Ziuggrael Strażnik Królowej (170 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/praork_woj_elita.gif" },
{ name: "Lusgrathera Królowa Pramatka (175 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/prakrolowa.gif" },
{ name: "Królowa Śniegu (175 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/krolowa-sniegu.gif" },
{ name: "Wrzosera (177 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wrzosera-1b.gif" },
{ name: "Chryzoprenia (177 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/chryzoprenia-1a.gif" },
{ name: "Cantedewia (177 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/cantedewia-1a.gif" },
{ name: "Ogr Stalowy Pazur (183 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/ogr_stalowy_pazur-1a.gif" },
{ name: "Torunia Ankelwald (186 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/thuz-patr1.gif" },
{ name: "Pięknotka Mięsożerna (189 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/zmutowana-roslinka.gif" },
{ name: "Breheret Żelazny Łeb (192 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/draki-breheret-1b.gif" },
{ name: "Cerasus (193 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/cerasus-1a.gif" },
{ name: "Mysiur Myświórowy Król (197 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mysiur_myswiorowy_krol-1a.gif" },
{ name: "Sadolia Nadzorczyni Hurys (200 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-sadolia.gif" },
{ name: "Bergermona Krwawa Hrabina (204 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-bergermona.gif" },
{ name: "Sataniel Skrytobójca (204 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-sataniel.gif" },
{ name: "Annaniel Wysysacz Marzeń (204 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-annaniel.gif" },
{ name: "Gothardus Kolekcjoner Głów (204 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-gothardus.gif" },
{ name: "Zufulus Smakosz Serc (205 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/sekta-zufulus.gif" },
{ name: "Czempion Furboli (210 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/forbol03.gif" },
{ name: "Arachniregina Colosseus (214 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/regina-e2.gif" },
{ name: "Al'diphrin Ilythirahel (218 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/drow-aldiphrin-wladca.gif" },
{ name: "Marlloth Malignitas (220 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/drider-marlloth.gif" },
{ name: "Arytodam olbrzymi (226 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/arytodam_olbrzymi-1b.gif" },
{ name: "Mocny Maddoks (231 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mocny_maddoks-1a.gif" },
{ name: "Fangaj (235 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/grzyb-humanoid-1b.gif" },
{ name: "Dendroculus (240 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/dendroculus.gif" },
{ name: "Tolypeutes (245 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/bolita.gif" },
{ name: "Cuaitl Citlalin (250 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/maho-cuaitl.gif" },
{ name: "Yaotl (258 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/mahoplowca.gif" },
{ name: "Quetzalcoatl (258 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/quetzalcoatl-1a.gif" },
{ name: "Wabicielka (260 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/trist2_wabicielka-1a.gif" },
{ name: "Pogardliwa Sybilla (263 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/tri2_witch_e2.gif" },
{ name: "Chopesz (267 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/chopesh2.gif" },
{ name: "Neferkar Set (274 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/szkiel_set.gif" },
{ name: "Chaegd Agnrakh (280 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/bar_smokoszef.gif" },
{ name: "Vaenra Charkhaam (280 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/bar_smoczyca.gif" },
{ name: "Terrozaur (280 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/terrorzaur_pus.gif" },
{ name: "Nymphemonia (287 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/nymphemonia.gif" },
{ name: "Zorin (300 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wl-mrozu01.gif" },
{ name: "Furion (300 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wl-mrozu02.gif" },
{ name: "Artenius (300 lvl)", img: "https://micc.garmory-cdn.cloud/obrazki/npc/e2/wl-mrozu03.gif" }

        ]
    };

const lootTable = {
        "Mroczny Patryk (35 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm749.gif", stats: "Kapelusz wiecznej udręki (m)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm748.gif", stats: "Splot szaleństwa (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1365.gif", stats: "Korona tańczących płomieni (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Karmazynowy Mściciel (45 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice854.gif", stats: "Stalowe szpony zemsty (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice853.gif", stats: "Chwyt niestygnącej krwi (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice855.gif", stats: "Kajdany gniewnej tułaczki (m)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Złodziej (51 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty535.gif", stats: "Pantofle Madame Baterflaj (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty872.gif", stats: "Podwójne podeszwy złodzieja (b/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty871.gif", stats: "Pamiątka z Tuzmer (t/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Zły Przewodnik (63 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice893.gif", stats: "Dwulicowy chwyt mnicha (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice891.gif", stats: "Dotyk zwodniczych mgieł (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice892.gif", stats: "Zamach wybitnego łgarza (w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Opętany Paladyn (74 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm847.gif", stats: "Zęby klasztornego postrachu (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm845.gif", stats: "Złota maska opętańca (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm846.gif", stats: "Przyłbica przeklętego umysłu (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Piekielny Kościej (85 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik918.gif", stats: "Cząstka siły Azelatho (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik920.gif", stats: "Pamiątka poprzedniego życia (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik919.gif", stats: "Manifestacja mocy Shurako (m)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Koziec Mąciciel Ścieżek (94lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/koziec_craft_02.gif", stats: "Kwiecista narzuta Koźca (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/koziec_craft_03.gif", stats: "Trzeci róg mąciciela (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/koziec_craft_01.gif", stats: "Bukiet kryształowych bazi (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary"}
        ],
        "Kochanka Nocy (102 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm851.gif", stats: "Oblicze smutku (w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm853.gif", stats: "Hełm kochanka Nocnej Kochanki (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm852.gif", stats: "Maska nocnego szlochu (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Książę Kasim (116 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1010.gif", stats: "Klątwa tysiąca i jednej nocy (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1009.gif", stats: "Szpony utraconej nadziei (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1011.gif", stats: "Rękawy z pustynnych krain (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Święty Braciszek (123 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1133.gif", stats: "Medalion smakosza trunków (b/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1135.gif", stats: "Tabernakulum z sekretną recepturą (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1134.gif", stats: "Gwieździsta monstracja (h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Złoty Roger (135 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1189.gif", stats: "Złowrogie czaszki Rogera (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1188.gif", stats: "Wybuchowe przywitanie (h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1190.gif", stats: "Wspomnienie wielkiego korsarza (b/p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Baca bez łowiec (144 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1163.gif", stats: "Serowe wahadełko (w)||rarity=heroic"}, 
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1164.gif", stats: "Sztuczka doświadczonego bacy (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1162.gif", stats: "Eteryczny baran (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Czarująca Atalia (157 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1196.gif", stats: "Otok rodzinnych niesnasek (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1197.gif", stats: "Pamiątka rodu czarownic (w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1195.gif", stats: "Pożeracz zmarszczek (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Obłąkany Łowca Orków (165 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1211.gif", stats: "Stalowa pięść obłąkańca (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1213.gif", stats: "Mankiety z zerwanych sztandarów (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1212.gif", stats: "Miażdżyciele orczych serc (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Lichwiarz Grauhaz (177 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1165.gif", stats: "Sopel z porzuconych kopalni (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1167.gif", stats: "Kolia dumnego rodu (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1166.gif", stats: "Klejnot smoczej choroby (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Viviana Nandin (185 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm627.gif", stats: "Eteryczny wieniec Viviany (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm626.gif", stats: "Poroże leśnej bestii (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm628.gif", stats: "Kaptur strażniczki kniei (w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Przeraza (194 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1371.gif", stats: "Bransolety kwitnącej aberracji (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1370.gif", stats: "Dłonie wielu osobowości (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1372.gif", stats: "Mankiety powiernika woli (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Skrytka mocy (s)||rarity=legendary"}
        ],
        "Demonis Pan Nicości (205 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1284.gif", stats: "Czarne Słońce (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1285.gif", stats: "Krwawa relikwia (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1286.gif", stats: "Nerw wzrokowy demona (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"}
        ],
        "Mulher Ma (214 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1300.gif", stats: "Kołnierz dekapitacji (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1299.gif", stats: "Obręcz Najwyższej Kapłanki (b/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1301.gif", stats: "Wdzięczność Pajęczycy (h/t)||rarity=legendary"}
        ],
        "Vapor Veneno (231 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1319.gif", stats: "Błyskotka humanoidalnej natury (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1320.gif", stats: "Pierścionek toksycznej fascynacji (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1318.gif", stats: "Symbol wodnych narodzin (p/w)||rarity=legendary"}
        ],
        "Dęborożec (244 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1487.gif", stats: "Czaszka wielkiego nieszczęśnika (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1488.gif", stats: "Gniew strażnika kniei (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1489.gif", stats: "Maska Puryfikacji (m)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"}
        ],
        "Tepeyollotl (258 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1358.gif", stats: "Brama do zaświatów (m/p/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1357.gif", stats: "Kręgosłupy boskich bliźniąt (w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1356.gif", stats: "Symbol Wieczności (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"}
        ],
        "Widmo Triady (265 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1501.gif", stats: "Kaptur wyzwolenia ducha (b/h/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1502.gif", stats: "Ofiara eliksiru hydrofilowego (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1503.gif", stats: "Przeklęta klatka na ptaki (m)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"}
        ],
        "Negthotep Czarny Kapłan (271 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice521.gif", stats: "Palce demonicznego kompozytora (m/t)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice520.gif", stats: "Dłonie Czarnego Kapłana (b/h)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice519.gif", stats: "Złoty chwyt generała (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"}
        ],
        "Młody Smok (282 lvl)": [
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal32.gif", stats: "Talizman smoczego boga (i)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm658.gif", stats: "Maska gniewu Shaiharrud (b/h/t)||rarity=legendary"}, 
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm659.gif", stats: "Skupisko smoczej magii (m/p)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm657.gif", stats: "Więzienie gadzich płomieni (p/w)||rarity=legendary"},
            {img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_06.gif.gif", stats: "Ciężka skrytka mocy (s)||rarity=legendary"}
        ],

        // --- ELITY II ---
        "Mushita (23 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien361.gif", stats: "Nimb emanującego kła (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Kotołak Tropiciel (27 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm721.gif", stats: "Maska dziewięciu żywotów (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm720.gif", stats: "Kamuflaż przyczajonego kocura (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm719.gif", stats: "Kask wiedźmiego chowańca (p/w)||rarity=legendary" },
	    	{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Lekka skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Shae Phu (30 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1243.gif", stats: "Czaszka Przeznaczenia (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice805.gif", stats: "Nekromantki cmentarnej dziewicy (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice806.gif", stats: "Szpony Ciemnego Varga (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Lekka skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Zorg Jednooki Baron (33 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1203.gif", stats: "Obuwie upadłego barona (w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1205.gif", stats: "Magiczne ciżemki Zorga (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1204.gif", stats: "Buciory lidera szajki (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Władca Rzek (37 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien836.gif", stats: "Studnia Życzeń (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien837.gif", stats: "Klejnot Wielkich Jezior (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien835.gif", stats: "Rzeka Marzeń (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Gobbos (40 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik812.gif", stats: "Element Mroku (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik813.gif", stats: "Dusza Światła (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hat/maska5.gif", stats: "Maska Akumu (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Tyrtajos (42 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice828.gif", stats: "Naramienniki przywódcy watahy (b/h/p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice827.gif", stats: "Chrumkająca ozdoba dzika (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty842.gif", stats: "Dzikie ryjki (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Lekka skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Szczet alias Gładki (47 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik414.gif", stats: "Zbójeckie złotko (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty852.gif", stats: "Towar pierwszej klasy (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/mug_mask01.gif", stats: "Maska złodzieja (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Lekka skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Tollok Shimager (47 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien856.gif", stats: "Sygnet przyzwania nietoperzy (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien855.gif", stats: "Błękitna duma tolloka (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien857.gif", stats: "Nasiono burzy (p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Lekka skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Razuglag Oklash (51 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm773.gif", stats: "Maska mrocznego sługi (b/h/p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm362.gif", stats: "Kaptur Magii Początku (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/piescien1234.gif", stats: "Zaklęty płomień (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Lekka skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Agar (51 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/gal_l-naszyj.gif", stats: "Plugawe przekleństwo wiedźmy (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/gal_l-naszyj3.gif", stats: "Splamiona kapitańska obręcz (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/gal_l-naszyj2.gif", stats: "Sprofanowany rdzeń świadomości (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Foverk Turrim (57 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik871.gif", stats: "Klejnot Turrimu (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik870.gif", stats: "Rozłupana czaszka Foverka (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Lekka skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Owadzia Matka (58 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice815.gif", stats: "Paskudzące żądła Matki (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice817.gif", stats: "Bransolety lakowego terroru (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice816.gif", stats: "Objęcia propolisu (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Vari Kruger (66 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/piersc94.gif", stats: "Sygnet szmaragdowej potęgi (b/w/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1331.gif", stats: "Klejnot ognistej pożogi (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal112.gif", stats: "Zweglona maska gnolla (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Lekka skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Furruk Kozug (66 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1469.gif", stats: "Przyłbica filtracyjna (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm662.gif", stats: "Futrzana czapa szaleńca (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1377.gif", stats: "Klamry przewrotowca (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Lekka skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Jotun (70 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty866.gif", stats: "Mrozoodporne kamasze Jotuna (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1202.gif", stats: "Podeszwy magicznej wyniosłości (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1206.gif", stats: "Kamienne trzewiki (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Tollok Atamatu (73 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1362.gif", stats: "Rogaty łeb tolloka (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice72.gif", stats: "Brylantowe rękawice tolloka (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik892.gif", stats: "Chluba jaskiniowych tolloków (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Lisz (75 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik882.gif", stats: "Czaszka pośmiertnego stężenia (b/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik884.gif", stats: "Pieczęć dusz śniegu (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik883.gif", stats: "Naczynie odizolowanej duszy (h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Lekka skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Grabarz Świątynny (80 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty888.gif", stats: "Krok żałobnych orszaków (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice902.gif", stats: "Cacko ze splądrowanego grobowca (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice903.gif", stats: "Pneumatyczny chwyt grabarza (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Lekka skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Podły zbrojmistrz (82 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1472.gif", stats: "Rogi niewzruszonej podłości (b/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1470.gif", stats: "Oblicze dokuczliwych biesów (h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1471.gif", stats: "Więzienie obsesyjnych żądz (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Lekka skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Wielka Stopa (82 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien910.gif", stats: "Błyskotka Wielkiej Stopy (w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien912.gif", stats: "Sygnet szczypiącego mrozu (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien911.gif", stats: "Skumulowane światło lodowca (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Choukker (84 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty878.gif", stats: "Popis zapomnianego kowala (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty879.gif", stats: "Cudeńko ze skarbca dławiaczy (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty880.gif", stats: "Łup jaskiniowej hordy (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Lekka skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Nadzorczyni krasnoludów (88 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm861.gif", stats: "Przesłona rządów strachu (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm859.gif", stats: "Wspomnienie Wojny Magów (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm860.gif", stats: "Podarek krasnoludzkiego monarchy (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Lekka skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Morthen (89 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty932.gif", stats: "Zapomniany skarb krasnoludów (b/p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty934.gif", stats: "Odlew najwyższej próby (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1207.gif", stats: "Symbol obsesji (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Lekka skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Żelazoręki Ohydziarz (92 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm874.gif", stats: "Anihilator (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik946.gif", stats: "Pochłaniająca duma urgrapów (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik945.gif", stats: "Mistyczna błyskotka volmatów (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Leśne Widmo (92 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice955.gif", stats: "Skarb borowych (b/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice954.gif", stats: "Trofeum z Leśnego Widma (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1286.gif", stats: "Strzelające palce kniei (h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Lekka skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Goplana (93 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien954.gif", stats: "Nieskalana dusza nimfy (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien955.gif", stats: "Obrączka płynnej żywicy (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien956.gif", stats: "Róża w rozkwicie (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary" }
        ],
        "Gnom Figlid (96 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice942.gif", stats: "Potęga wielkiego Figlida (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty917.gif", stats: "Kamasze gnomiego honoru (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/piescien1233.gif", stats: "Okazała gnomijagoda (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Lekka skrytka mocy (s)||rarity=legendary" }
        ],
        "Centaur Zyfryd (99 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik942.gif", stats: "Ozdoba walecznego centaura (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik943.gif", stats: "Kolia dojrzałych soków (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik944.gif", stats: "Obręcz duszących pnączy (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Lekka skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Kambion (101 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty966.gif", stats: "Stalowe zmiażdżenie (w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty967.gif", stats: "Miękkie racice bandyty (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty968.gif", stats: "Kopyta demonicznej manifestacji (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Jertek Moxos (105 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien980.gif", stats: "Krwawy płomień bluźnierstwa (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm937.gif", stats: "Karminowe opętanie (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien981.gif", stats: "Ozdoba fałszywego bożka (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Miłośnik łowców (108 lvl)": [
	    { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/miloscnicy_sur_02.gif", stats: "Czaszka poległego lewiatana (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1006.gif", stats: "Łapka w górę (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1332.gif", stats: "Symbol uwielbienia łowców (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Miłośnik rycerzy (108 lvl)": [
	    { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/milosnicy_sur_05.gif", stats: "Chorągiew pożartych rycerzy (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm959.gif", stats: "Cuchnąca przyłbica miłośnika (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1334.gif", stats: "Symbol uwielbienia rycerzy (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Miłośnik magii (108 lvl)": [
	    { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/miloscnicy_sur_03.gif", stats: "Pas przesiąknięty magią (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm958.gif", stats: "Zaczarowane bryle (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1333.gif", stats: "Symbol uwielbienia magii (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Łowca czaszek (112 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1008.gif", stats: "Pięści uderzających meteorytów (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1007.gif", stats: "Pazury wiecznej ekshumacji (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik984.gif", stats: "Zasuszona twarz ożywieńca (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Ozirus Władca Hieroglifów (115 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty760.gif", stats: "Obmierzłe cholewy Ozirusa (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty762.gif", stats: "Opieka Skarabeuszy (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty761.gif", stats: "Buty Króla Skorpiona (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Morski potwór (118 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm983.gif", stats: "Tęczowa ośmiorniczka (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1364.gif", stats: "Galaretowate ślepia (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm981.gif", stats: "Macki władzy (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Krab pustelnik (124 lvl)": [
	    { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/craft_krab_panc.gif", stats: "Wspaniały pancerz Kraba (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/krab_craft_02.gif", stats: "Koralowy karapaks (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/sur/krab_craft_03.gif", stats: "Osłona pustelnika (i)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Borgoros Garamir III (124 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1218.gif", stats: "Okowy boskiego pochodzenia (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1217.gif", stats: "Kajtany ziemi obiecanej (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1216.gif", stats: "Klamry dziejotwórczego porozumienia (m)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Stworzyciel (125 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1109.gif", stats: "Cholewy z piaskowego czerwia (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1144.gif", stats: "Cacko wielkiego kreatora (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1143.gif", stats: "Miniaturowe szczęki Stworzyciela (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Ifryt (128 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm970.gif", stats: "Korona Politraki (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1011.gif", stats: "Formacja stygnącej lawy (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1363.gif", stats: "Turban płonących języków (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Henry Kaprawe Oko (131 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1165.gif", stats: "Dostojne rękawy Henrego (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1080.gif", stats: "Pazur abordażowy (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1025.gif", stats: "Duma Mackomordego (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Helga Opiekunka Rumu (131 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1042.gif", stats: "Ciężka stopa Helgi (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1040.gif", stats: "Kozaki zza siedmiu mórz (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1024.gif", stats: "Pijacka busola (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Młody Jack Truciciel (131 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1023.gif", stats: "Szczęśliwa Kotwica (w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1041.gif", stats: "Pneumatyczna noga Jacka (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1164.gif", stats: "Złoty hak przyszłości (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Eol (135 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1073.gif", stats: "Szyszak czterech wiatrów (w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1071.gif", stats: "Przyłbica wojennych piasków (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1072.gif", stats: "Chusta pustynnych koszmarów (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
        ],
        "Grubber Ochlaj (136 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien993.gif", stats: "Nagroda najmocniejszej głowy (b/h)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien991.gif", stats: "Oczko mistrza fermentacji (p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien992.gif", stats: "Błysk chmielowych szyszek (m/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
        ],
        "Mistrz Worundriel (139 lvl)": [
	    { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal101.gif", stats: "Kowadło Moradrana (i)||rarity=heroic" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1216.gif", stats: "Serce kuźni (a)||rarity=heroic" }, 
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1209.gif", stats: "Wytwór niemal doskonały (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
        ],
        "Wójt Fistuła (144 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1240.gif", stats: "Łapy krótkiego rozumu (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1239.gif", stats: "Pięści dobrostanu żony (b/h/p/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1241.gif", stats: "Dłonie górskich wstrząsów (b/h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
        ],
        "Teściowa Rumcajsa (145 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1157.gif", stats: "Obrączka matczynej miłości (a)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1096.gif", stats: "Odświętny bibelot świekry (b/h/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1095.gif", stats: "Prawdziwe oblicze teściowej (m/p/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
        ],
        "Berserker Amuno (148 lvl)": [
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1173.gif", stats: "Cholewy z zachodu (m/p)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1208.gif", stats: "Podeszwy braterskiej więzi (h/t)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1201.gif", stats: "Niezniszczalne trepy Amuno (b/w)||rarity=legendary" },
            { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
        ],
         "Fodug Zolash (150 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1209.gif", stats: "Sygnet łaski i zawahania (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1208.gif", stats: "Pieczęć pana twierdzy (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1274.gif", stats: "Krwawe dyrygentki (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
    ],
        
    "Goons Asterus (154 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1352.gif", stats: "System celowniczy Asterusa (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1185.gif", stats: "Goblińskie ustrojstwo (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/torba53.gif", stats: "Wielofunkcyjna torba goblina (i)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Adariel (155 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1194.gif", stats: "Wiedźmi łapacz snów (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1242.gif", stats: "Pieczęć czarnej magii (m)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1193.gif", stats: "Ampułka brzydoty (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Sheba Orcza Szamanka (160 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1199.gif", stats: "Źródło wielkiego nieszczęścia (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1198.gif", stats: "Przebudzone ślepie demona (b/h/t/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1199.gif", stats: "Miniaturowy portal (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Burkog Lorulk (160 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1259.gif", stats: "Wyraz olbrzymiej pogardy (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1099.gif", stats: "Skarb praorczej dynastii (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1208.gif", stats: "Odrąbana dłoń Burkoga (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Duch Władcy Klanów (165 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1348.gif", stats: "Przyłbica wielkiego zaszczytu (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1349.gif", stats: "Odznaczenie smokobija (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1350.gif", stats: "Maska orczej wyroczni (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Bragarth Myśliwy Dusz (170 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik631.gif", stats: "Kolia Łowcy Dusz (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien627.gif", stats: "Błysk smoczego oka (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Fursharag Pożeracz Umysłów (170 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik636.gif", stats: "Ozdoba Pożeracza Umysłów (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm564.gif", stats: "Esencja smoczej tężyzny (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Ziuggrael Strażnik Królowej (170 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice644.gif", stats: "Rękawice ze smoczej skóry (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik635.gif", stats: "Naszyjnik Królewskiego Strażnika (b/p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Lusgrathera Królowa Pramatka (175 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien638.gif", stats: "Ukryta potęga praorków (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien637.gif", stats: "Królewski pierścień pramatki (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Królowa Śniegu (175 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1230.gif", stats: "Skostniałe paluchy monarchini (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1231.gif", stats: "Uścisk nieskończonej śnieżycy (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1314.gif", stats: "Nienawistny chwyt królowej (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Wrzosera (177 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1270.gif", stats: "Wrzosowa plecionka driady (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty686.gif", stats: "Święta Dębina (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1403.gif", stats: "Przyłbica pani wrzosowisk (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Chryzoprenia (177 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1264.gif", stats: "Pąk Wabiciel (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1402.gif", stats: "Chryzantemowy diadem (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1225.gif", stats: "Cholewy leśnej monarchii (m)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Cantedewia (177 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1224.gif", stats: "Bezszelestny chód mchów (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1401.gif", stats: "Korona życiodajnych kalii (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal109.gif", stats: "Święte kwiecie driad (i)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Ogr Stalowy Pazur (183 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1246.gif", stats: "Stalowe pieścidełko (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1382.gif", stats: "Hełm ogrzego szaleństwa (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1218.gif", stats: "Buciory krwawego obłędu (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Torunia Ankelwald (186 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1272.gif", stats: "Złoty księżyc Ankelwaldów (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik722.gif", stats: "Osiem Nóg Fortuny (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik723.gif", stats: "Oko Opatrzności (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Pięknotka Mięsożerna (189 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1263.gif", stats: "Wonne kwiecie dezynfekcji (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1262.gif", stats: "Trio mięsożernych pąków (h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1264.gif", stats: "Piękno pełni rozkwitu (b/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Breheret Żelazny Łeb (192 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1410.gif", stats: "Żelazna Twarz (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1392.gif", stats: "Krwawa szczęka Valmira (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1318.gif", stats: "Dekapitorki (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Cerasus (193 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1259.gif", stats: "Źródło leśnego mroku (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1220.gif", stats: "Pnie wymuszonej symbiozy (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1219.gif", stats: "Cholewy krwawego przebudzenia (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Mysiur Myświórowy Król (197 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1221.gif", stats: "Szczurołapki (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1223.gif", stats: "Pantofle opasłego gryzonia (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1222.gif", stats: "Myświórowe kaprysy (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Sadolia Nadzorczyni Hurys (200 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik684.gif", stats: "Tchnienie Nagłej Grozy (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik683.gif", stats: "Podmuch Wiecznie Potępionych (b/h/t/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik682.gif", stats: "Piekielny Nietoperz (b/p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Bergermona Krwawa Hrabina (204 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien697.gif", stats: "Pierścień Mistrzyni Tortur (h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1404.gif", stats: "Nawiedzona chusta hrabiny (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien694.gif", stats: "Dłoń Diabła (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ciężka skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Sataniel Skrytobójca (204 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1316.gif", stats: "Szpon krwawych przesłuchań (b/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1313.gif", stats: "Łańcuchy ujarzmiania demonów (h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1317.gif", stats: "Kryjówka demonicznych sugestii (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ciężka skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Annaniel Wysysacz Marzeń (204 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien699.gif", stats: "Szpon Bahaala (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien695.gif", stats: "Ozdoba Piekielnego Portalu (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/tal/tal69.gif", stats: "Przenośny ołtarz Annaniela (i)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ciężka skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Gothardus Kolekcjoner Głów (204 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty679.gif", stats: "Powolny Puls Demona (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien698.gif", stats: "Płomień Żywnej Wiary (b/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien696.gif", stats: "Kościany Strażnik (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ciężka skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Zufulus Smakosz Serc (205 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm617.gif", stats: "Korona Wiecznej Gehenny (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm616.gif", stats: "Maska Smakosza Serc (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm615.gif", stats: "Diadem Tysiąca Świec (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Ciężka skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Czempion Furboli (210 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1265.gif", stats: "Światło odstraszające pająki (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1271.gif", stats: "Medalion doskonałości (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1315.gif", stats: "Dziedzictwo linii czempionów (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ciężka skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Arachniregina Colosseus (214 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1343.gif", stats: "Stalowe pająki (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1342.gif", stats: "Pięści zawodowego bohatera (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1344.gif", stats: "Muśnięcie powiewających pajęczyn (m)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ciężka skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Al'diphrin Ilythirahel (218 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1342.gif", stats: "Podeszwy uzurpatora (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1341.gif", stats: "Łup z Tass Zhil (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1343.gif", stats: "Cholewy chwilowej ekscytacji (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ciężka skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Marlloth Malignitas (220 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1441.gif", stats: "Wspomnienie sromotnej porażki (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1333.gif", stats: "Stukot historii (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1442.gif", stats: "Magazyn sił chaosu (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ciężka skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Arytodam olbrzymi (226 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1357.gif", stats: "Pokraczne łapy Arytodama (m)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1356.gif", stats: "Klamry degradacji środowiska (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1355.gif", stats: "Kajdany bagiennego bulgotania (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Ciężka skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Mocny Maddoks (231 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1452.gif", stats: "Stary Żabiec (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1453.gif", stats: "Smakosz Ambrozji Maddoków (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm1451.gif", stats: "Genealogiczne Algi (w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Ciężka skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Fangaj (235 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1366.gif", stats: "Źródło grzybowej zarazy (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1368.gif", stats: "Sznur psylocybków (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1367.gif", stats: "Najbardziej wyjątkowy okaz (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ciężka skrytka elektrycznej mocy (s)||rarity=legendary" }
    ],
    "Dendroculus (240 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1383.gif", stats: "Żywiczne korzonki (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik1342.gif", stats: "Oculus (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1382.gif", stats: "Konarowce (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ciężka skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Tolypeutes (245 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1404.gif", stats: "Rękawice ze skóry Tolypeutesa (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1402.gif", stats: "Mankiety obrońcy bogów (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1403.gif", stats: "Gest Teomama (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ciężka skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Cuaitl Citlalin (250 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1365.gif", stats: "Sygnet z kości konkwistadorów (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1366.gif", stats: "Ollin (p/w)||rarity=legendary" },
	{ img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1367.gif", stats: "Gniazdo wielkiej przenikliwości (m)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ciężka skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Yaotl (258 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm420.gif", stats: "Pozłacana podobizna bóstwa (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm419.gif", stats: "Płomienna maska kapłana (p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/hel/helm418.gif", stats: "Czaszka Huitzilopochtli (b/h/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ciężka skrytka jadowej mocy (s)||rarity=legendary" }
    ],
    "Quetzalcoatl (258 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1400.gif", stats: "Wyobrażenie Mictlantecuhtliego (b/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1401.gif", stats: "Stąpanie Dwóch Słońc (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1402.gif", stats: "Cholewy boskiego lśnienia (h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Ciężka skrytka lodowej mocy (s)||rarity=legendary" }
    ],
    "Wabicielka (260 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien1375.gif", stats: "Zalążek Chaosu (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1414.gif", stats: "Szałowe pazury Wabicielki (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice1413.gif", stats: "Dłoń władcy podziemi (b/h/p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ciężka skrytka stalowej mocy (s)||rarity=legendary" }
    ],
    "Pogardliwa Sybilla (263 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1423.gif", stats: "Wszechstronne obcasy Sybilli (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1422.gif", stats: "Pantofle infiltracji umysłów (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty1421.gif", stats: "Buciory wiedźmiej potęgi (p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ciężka skrytka ognistej mocy (s)||rarity=legendary" }
    ],
    "Chopesz (267 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ciężka skrytka stalowej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty514.gif", stats: "Lazur wód Wernoradu (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty515.gif", stats: "Bojowe obuwie Chopesza (b/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty516.gif", stats: "Skarb antycznych (h/t)||rarity=legendary" }
    ],
    "Neferkar Set (274 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ciężka skrytka elektrycznej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/set_but3.gif", stats: "Magia mrocznego Seta (m/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/set_but2.gif", stats: "Furia potężnego Seta (b/h)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/set_but1.gif", stats: "Niezłomność bezlitosnego Seta (p/w)||rarity=legendary" }
    ],
    "Chaegd Agnrakh (280 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ciężka skrytka jadowej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik736.gif", stats: "Obroża Przeistoczenia (b/h/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyj446.gif", stats: "Klejnot królewski (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien201.gif", stats: "Kryształ w obrączce Agnrakha (b/h/w)||rarity=legendary" }
    ],
    "Vaenra Charkhaam (280 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_03.gif.gif", stats: "Ciężka skrytka elektrycznej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik447.gif", stats: "Klejnot świątynny (b/p/w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/pie/pierscien197.gif", stats: "Kryształ w obrączce Vaenry (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/but/buty731.gif", stats: "Smocze Kroki (a)||rarity=legendary" }
    ],
    "Terrozaur (280 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ciężka skrytka ognistej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice580.gif", stats: "Uścisk wirujących piasków (m/p)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice581.gif", stats: "Pancerna pięść wojownika Shaiharrud (w)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice579.gif", stats: "Szpony gadzik jeźdźców (b/h/t)||rarity=legendary" }
    ],
    "Nymphemonia (287 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_01.gif", stats: "Ciężka skrytka lodowej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/nas/naszyjnik700.gif", stats: "Skarb Królestwa Driad (a)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice711.gif", stats: "Palce wymuszonej symbiozy (m/p/t)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/rek/rekawice712.gif", stats: "Szpony leśnego runa (b/h/w)||rarity=legendary" }
    ],
    "Zorin (300 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_04.gif.gif", stats: "Ciężka skrytka stalowej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/que/wladcy_krysz02.gif", stats: "Kryształ przeszywającego chłodu (i)||rarity=legendary" }
    ],
    "Furion (300 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_05.gif.gif", stats: "Ciężka skrytka jadowej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/que/wladcy_krysz01.gif", stats: "Kryształ wiecznej zmarzlizny (i)||rarity=legendary" }
    ],
    "Artenius (300 lvl)": [
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/bag/kuf_compontent_02.gif.gif", stats: "Ciężka skrytka ognistej mocy (s)||rarity=legendary" },
        { img: "https://micc.garmory-cdn.cloud/obrazki/itemy/que/wladcy_krysz03.gif", stats: "Kryształ lodowatego powiewu (i)||rarity=legendary" }
    ]
    };

// --- SYSTEM ULUBIONYCH ---
    window.toggleFav = (id) => {
        let favs = JSON.parse(localStorage.getItem('targ_favs') || '[]');
        if (favs.includes(id)) {
            favs = favs.filter(fid => fid !== id);
            window.alert("Usunięto z ulubionych.");
        } else {
            favs.push(id);
            window.playSound('coin');
            window.alert("Dodano do ulubionych!");
        }
        localStorage.setItem('targ_favs', JSON.stringify(favs));
        window.renderOffers();
    };

    // --- SYSTEM STATUSU ONLINE ---
    function startHeartbeat() {
        setInterval(async () => {
            if(currentUser) {
                await updateDoc(doc(db, "users", currentUser.uid), { lastActive: new Date().toISOString() });
            }
        }, 120000); 
    }
    onSnapshot(collection(db, "users"), (snap) => {
        snap.docs.forEach(d => {
            activeUsers[d.id] = d.data().lastActive;
        });
        window.renderOffers();
    });
    function isUserOnline(uid) {
        if (!activeUsers[uid]) return false;
        const last = new Date(activeUsers[uid]).getTime();
        const now = new Date().getTime();
        return (now - last) < 5 * 60 * 1000;
    }

    // --- KARCZMA (CZAT) ---
// --- KARCZMA (CZAT + KOŚCI) ---
    window.toggleKarczma = () => {
        const p = document.getElementById('karczmaPanel');
        p.classList.toggle('open');
    };

    window.sendChatMessage = async () => {
        const inp = document.getElementById('chatInput');
        const txt = inp.value.trim();
        if (!txt || !currentUser) return;
        
        await addDoc(collection(db, "chat"), {
            nick: currentNick,
            text: window.escapeHtml(txt),
            type: 'msg', // Zwykła wiadomość
            date: new Date().toISOString()
        });
        inp.value = "";
    };

    // NOWOŚĆ: Funkcja rzutu kością
    window.rollDice = async () => {
        if (!currentUser) return alert("Zaloguj się!");
        const result = Math.floor(Math.random() * 100) + 1; // Losuje 1-100
        
        await addDoc(collection(db, "chat"), {
            nick: currentNick,
            text: `🎲 rzucił(a) kośćmi i uzyskał(a) wynik: ${result}/100`,
            type: 'roll', // Specjalny typ wiadomości
            date: new Date().toISOString()
        });
        window.playSound('coin'); // Dźwięk monet przy rzucie
    };
    
    // NASŁUCH ENTER W CZACIE
    document.getElementById('chatInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendChatMessage();
    });

// ZAKTUALIZOWANE RENDEROWANIE (Obsługa kolorów dla rzutów)
    onSnapshot(query(collection(db, "chat"), orderBy("date", "asc"), limit(50)), (snap) => {
        const div = document.getElementById('chatMessages');
        div.innerHTML = "";
        snap.docs.forEach(d => {
            const m = d.data();
            const time = new Date(m.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            // Styl dla rzutu kością (Złoty tekst, kursywa)
            let msgStyle = "color: #eee;";
            let containerStyle = "";
            
            if (m.type === 'roll') {
                msgStyle = "color: var(--gold); font-weight: bold; font-style: italic;";
                containerStyle = "border-left: 3px solid var(--gold); background: rgba(255, 215, 0, 0.05);";
            }

            div.innerHTML += `
                <div class="chat-msg" style="${containerStyle}">
                    <div class="chat-top-row">
                        <span class="chat-nick">${window.escapeHtml(m.nick)}</span>
                        <span class="chat-time">${time}</span>
                    </div>
                    <div class="chat-text" style="${msgStyle}">${m.text}</div>
                </div>`;
        });
        div.scrollTop = div.scrollHeight;
    });

    // --- POCZTA ---
    window.openCompose = (recipientId, recipientNick, itemName) => {
        if (!currentUser) return alert("Zaloguj się!");
        composeTarget = { id: recipientId, nick: recipientNick, item: itemName };
        document.getElementById('composeRecipient').innerText = recipientNick;
        document.getElementById('composeSubject').innerText = itemName;
        document.getElementById('composeText').value = "";
        document.getElementById('composeModal').style.display = 'flex';
    };
    window.sendInternalMessage = async () => {
        const txt = document.getElementById('composeText').value;
        if (!txt) return alert("Pusto!");
        await addDoc(collection(db, "wiadomosci"), { fromId: currentUser.uid, fromNick: currentNick, toId: composeTarget.id, item: composeTarget.item, text: window.escapeHtml(txt), read: false, date: new Date().toISOString() });
        document.getElementById('composeModal').style.display = 'none';
        window.playSound('coin');
        alert("Wysłano gołębia!");
    };
    window.deleteMessage = async (msgId) => { if(confirm("Usunąć?")) await deleteDoc(doc(db, "wiadomosci", msgId)); };
    let unsubscribeMail = null;
    function startMailListener() {
        if (unsubscribeMail) unsubscribeMail();
        const q = query(collection(db, "wiadomosci"), where("toId", "==", currentUser.uid), orderBy("date", "desc"));
        unsubscribeMail = onSnapshot(q, (snap) => {
            inboxMessages = snap.docs.map(d => ({id: d.id, ...d.data()}));
            const unread = inboxMessages.filter(m => !m.read).length;
            const badge = document.getElementById('mailBadge');
            if (unread > 0) { badge.style.display = 'flex'; badge.innerText = unread; window.playSound('mail'); } else { badge.style.display = 'none'; }
            if(document.getElementById('mailboxModal').style.display === 'flex') renderMailList(inboxMessages);
        });
    }
    window.openMailbox = () => { document.getElementById('mailboxModal').style.display = 'flex'; renderMailList(inboxMessages); };
    function renderMailList(msgs) {
        const c = document.getElementById('mailboxContent');
        if (!msgs || msgs.length === 0) { c.innerHTML = '<div style="text-align:center;color:#666;padding:20px;">Pusto.</div>'; return; }
        c.innerHTML = "";
        msgs.forEach(m => {
            if (!m.read) updateDoc(doc(db, "wiadomosci", m.id), { read: true });
            c.innerHTML += `<div class="mail-item ${!m.read?'unread':''}"><button onclick="deleteMessage('${m.id}')" class="delete-mail-btn">🗑️</button><div class="mail-meta"><span>Od: <span class="mail-author">${m.fromNick}</span></span><span>${new Date(m.date).toLocaleString()}</span></div><div class="mail-subject">${!m.read?'<span style="color:var(--gold)">[NOWA]</span> ':''}Dotyczy: ${m.item}</div><div class="mail-body">${m.text}</div></div>`;
        });
    }

    // --- ENCYKLOPEDIA (NOWOŚĆ) ---
    window.toggleEncyclopedia = () => {
        const modal = document.getElementById('encyclopediaModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        if(modal.style.display === 'flex') window.switchBestiaryTab('herosi');
    };

    window.switchBestiaryTab = (cat) => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.tab-btn[onclick*="${cat}"]`).classList.add('active');
        window.renderBestiary(cat);
    };

window.toggleSpecialFields = () => {
    const typeEl = document.getElementById('offerType');
    if (!typeEl) return;
    const type = typeEl.value;

    // Resetowanie widoczności sekcji
    document.getElementById('field-sell').style.display = 'none';
    document.getElementById('field-buy').style.display = 'none';
    document.getElementById('field-trade').style.display = 'none';
    document.getElementById('field-gold').style.display = 'none';
    document.getElementById('chestBundleContainer').style.display = 'none';

    // Logika sekcji
    if (type === 'sprzedam') document.getElementById('field-sell').style.display = 'block';
    else if (type === 'kupie') document.getElementById('field-buy').style.display = 'block';
    else if (type === 'zamienie') document.getElementById('field-trade').style.display = 'block';
    else if (type === 'gold') document.getElementById('field-gold').style.display = 'grid';
   else if (type === 'chest') {
            document.getElementById('chestBundleContainer').style.display = 'block';
            // Resetujemy widok ceny (domyślnie pokaż, chyba że wybrano Kupię)
            window.toggleChestPrice(); 
            if(document.getElementById('chestRowsArea').innerHTML === "") window.addChestRow();
        }

    // --- Obsługa pól standardowych ---
    const hideSource = ['gold', 'exp', 'other', 'chest'].includes(type);
    const displayStyle = hideSource ? 'none' : 'block';

    ['sourceCategory', 'itemSource', 'itemSelect', 'sourceSearch', 'itemSearch', 'itemBonding'].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.style.display = displayStyle;
    });

    // --- NOWOŚĆ: Obsługa opcji "Obojętne" w kłódce (TEGO BRAKOWAŁO) ---
    const bondingSel = document.getElementById('itemBonding');
    const anyOption = bondingSel.querySelector('option[value="any"]');
    
    if (type === 'kupie') {
        // Przy kupnie pokazujemy opcję "Obojętne"
        anyOption.style.display = 'block'; 
    } else {
        // W każdym innym przypadku (np. Sprzedam) ukrywamy ją i resetujemy jeśli była wybrana
        anyOption.style.display = 'none';
        if (bondingSel.value === 'any') bondingSel.value = 'bound';
    }
    // --------------------------------------------------

    // Autouzupełnianie ikon i nazw
    const nameInput = document.getElementById('itemName');
    const imgInput = document.getElementById('itemImg');
    const preview = document.getElementById('livePreview');

    const specialMap = {
        gold: { name: "Złoto", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/zlo/zloto8.gif" },
        exp:  { name: "Pomoc / Expienie", img: "https://micc.garmory-cdn.cloud/obrazki/npc/kob/tunia.gif" },
        other: { name: "Inne", img: "https://micc.garmory-cdn.cloud/obrazki/itemy/neu/pyl-sakryfikacji.gif" }
    };

    if (type === 'chest') {
        nameInput.disabled = true;
        nameInput.placeholder = "Zestaw skrzyń...";
        nameInput.value = "";
        imgInput.style.display = 'none';
        preview.style.display = 'none';
    } 
    else if (specialMap[type]) {
        nameInput.disabled = false;
        nameInput.value = (type === 'gold') ? "" : specialMap[type].name; 
        imgInput.style.display = 'block';
        imgInput.value = specialMap[type].img;
        preview.style.display = 'flex';
        document.getElementById('previewIcon').src = specialMap[type].img;
        document.getElementById('previewName').innerText = nameInput.value || "Handel Złotem";
    } 
    else {
        nameInput.disabled = false;
        nameInput.placeholder = "Nazwa przedmiotu";
        const autoNames = Object.values(specialMap).map(m => m.name);
        if(autoNames.includes(nameInput.value)) nameInput.value = "";
        imgInput.style.display = 'block';
        preview.style.display = 'none';
    }
};

	// Funkcja ukrywająca cenę przy kupnie skrzynek
    window.toggleChestPrice = () => {
        const action = document.getElementById('chestAction').value;
        const totalInput = document.getElementById('chestPrice');
        const totalContainer = document.getElementById('chestInputsRow');

        // 1. Ukrywamy/Pokazujemy Cenę Główną (za zestaw)
        if (action === 'Kupię') {
            totalInput.style.display = 'none';
            totalContainer.style.display = 'block'; // Rozciągamy select
        } else {
            totalInput.style.display = 'block';
            totalContainer.style.display = 'grid';
        }

        // 2. Ukrywamy/Pokazujemy Ceny Cząstkowe (w każdym wierszu)
        const rowInputs = document.querySelectorAll('.chest-row-price');
        rowInputs.forEach(input => {
            input.style.display = (action === 'Kupię') ? 'none' : 'block';
            // Opcjonalnie czyścimy wartość przy przełączeniu na Kupię
            if (action === 'Kupię') input.value = '';
        });
    };
	
	window.addChestRow = () => {
        const area = document.getElementById('chestRowsArea');
        const rowId = Date.now(); 
        
        let optionsHtml = `<option value="">-- Wybierz skrzynię --</option>`;
        chestList.forEach(c => {
            optionsHtml += `<option value="${c.name}" data-img="${c.img}">${c.name}</option>`;
        });

        // Sprawdzamy czy ukryć cenę w nowym wierszu
        const currentAction = document.getElementById('chestAction').value;
        const priceDisplay = (currentAction === 'Kupię') ? 'none' : 'block';

        const div = document.createElement('div');
        div.className = 'chest-row';
        div.id = `row-${rowId}`;
        
        div.innerHTML = `
            <select class="chest-select" style="flex:3;">${optionsHtml}</select>
            <input type="number" class="chest-qty" placeholder="Ile" min="1" value="1" style="flex:0.8; text-align:center;">
            <input type="text" class="chest-row-price" placeholder="Cena (np. 10m)" style="flex:1.2; text-align:center; display: ${priceDisplay};">
            <button class="remove-chest-btn" onclick="removeChestRow('${rowId}')">✕</button>
        `;
        area.appendChild(div);
    };

    window.removeChestRow = (id) => {
        const row = document.getElementById(`row-${id}`);
        if(row) row.remove();
    };
	
window.renderBestiary = (category) => {
        const container = document.getElementById('bestiaryContent');
        container.innerHTML = "";
        
        if (!monstersList[category]) return;

        monstersList[category].forEach(mob => {
            const loot = lootTable[mob.name] || [];
            let lootHtml = "";
            
            loot.forEach(item => {
                // Wyciągamy czystą nazwę (bez rarity)
                const pureName = item.stats.split('||')[0].replace(/\s*\([^)]*\)$/, "");
                
                // Tworzymy link do MargoWorld
                const safeName = encodeURIComponent(pureName);
                const mwLink = `https://margoworld.pl/item?name=${safeName}`;

                // Zmieniliśmy <div> na <a> (link)
                lootHtml += `
                    <a href="${mwLink}" target="_blank" class="loot-item" title="${pureName} (Kliknij, aby sprawdzić)">
                        <img src="${item.img}" alt="${pureName}">
                    </a>
                `;
            });

            container.innerHTML += `
                <div class="bestiary-card">
                    <img src="${mob.img}" class="bestiary-mob-img">
                    <div class="bestiary-mob-name">${mob.name}</div>
                    <div class="loot-grid">
                        ${lootHtml || '<div style="color:#666;font-size:0.8em;">Brak danych o dropie</div>'}
                    </div>
                </div>
            `;
        });
    };

    // --- RENDEROWANIE OFERT ---
    function extractLevel(sourceName) {
        if (!sourceName) return 0;
        const match = sourceName.match(/\((\d+)\s*lvl\)/i);
        return match ? parseInt(match[1]) : 0;
    }
    function updateUserFilterOptions() {
        const select = document.getElementById('userFilterSelect');
        const currentVal = select.value;
        const uniqueUsers = [...new Set(allOffers.map(o => o.nick))].sort();
        select.innerHTML = '<option value="">👤 Wszyscy sprzedawcy</option>';
        uniqueUsers.forEach(nick => {
            const option = document.createElement('option');
            option.value = nick;
            option.innerText = nick;
            select.appendChild(option);
        });
        if (uniqueUsers.includes(currentVal)) select.value = currentVal;
    }
    window.updateSourceList = () => {
        const cat = document.getElementById('sourceCategory').value;
        const sel = document.getElementById('itemSource');
        const search = document.getElementById('sourceSearch');
        document.getElementById('livePreview').style.display = 'none'; 
        if(!cat) { search.style.display = 'none'; return; }
        search.style.display = 'block';
        sel.innerHTML = '<option value="">-- Przeciwnik --</option>';
        monstersList[cat].filter(m => m.name.toLowerCase().includes(search.value.toLowerCase())).forEach(m => {
            let o = document.createElement('option'); o.value = m.name; o.dataset.img = m.img; o.innerText = m.name; sel.appendChild(o);
        });
    };
    window.updateLootList = () => {
        const selSource = document.getElementById('itemSource');
        const srcName = selSource.value;
        const srcImg = selSource.options[selSource.selectedIndex]?.dataset.img;
        const selItem = document.getElementById('itemSelect');
        const searchItem = document.getElementById('itemSearch');
        const preview = document.getElementById('livePreview');
        const previewIcon = document.getElementById('previewIcon');
        const previewName = document.getElementById('previewName');
        if (srcImg) { preview.style.display = 'flex'; previewIcon.src = srcImg; previewName.innerText = srcName; } else { preview.style.display = 'none'; }
        if(!srcName || !lootTable[srcName]) { searchItem.style.display = 'none'; selItem.style.display = 'none'; return; }
        searchItem.style.display = 'block'; selItem.style.display = 'block';
        selItem.innerHTML = '<option value="">-- Przedmiot --</option>';
        lootTable[srcName].filter(i => i.stats.split('||')[0].toLowerCase().includes(searchItem.value.toLowerCase())).forEach(i => {
            let o = document.createElement('option'); o.value = JSON.stringify(i); o.innerText = i.stats.split('||')[0]; selItem.appendChild(o);
        });
    };
    window.fillItemDetails = () => {
        const val = document.getElementById('itemSelect').value;
        const preview = document.getElementById('livePreview');
        const previewIcon = document.getElementById('previewIcon');
        const previewName = document.getElementById('previewName');
        if(!val) { window.updateLootList(); return; }
        const data = JSON.parse(val);
        const name = data.stats.split('||')[0];
        document.getElementById('itemName').value = name;
        document.getElementById('itemImg').value = data.img;
        preview.style.display = 'flex'; 
        previewIcon.src = data.img;
        previewName.innerText = name;
        const statsPart = data.stats.split('||')[1];
        if (statsPart && statsPart.includes('opis=')) {
            document.getElementById('itemDesc').value = statsPart.split('opis=')[1].split(';')[0].replaceAll('[br]', '\n');
        } else { document.getElementById('itemDesc').value = ""; }
    };
    window.manualImgPreview = () => {
        const url = document.getElementById('itemImg').value;
        if(window.isValidImageUrl(url)) {
            document.getElementById('livePreview').style.display = 'flex';
            document.getElementById('previewIcon').src = url;
            document.getElementById('previewName').innerText = document.getElementById('itemName').value || "Twój przedmiot";
        }

	// --- OBSŁUGA UPLOADU Z DYSKU (Base64) ---
    window.handleFileUpload = (input) => {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            
            // Zabezpieczenie: Max 800KB (Firebase ma limit 1MB na cały dokument)
            if (file.size > 800 * 1024) {
                return window.alert("Obrazek jest za duży! Maksymalnie 800KB. Zmniejsz go lub użyj linku.");
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                // Wpisujemy kod obrazka do pola tekstowego
                document.getElementById('itemImg').value = e.target.result;
                // Odpalamy podgląd
                window.manualImgPreview();
                window.alert("Wczytano plik!");
            };
            reader.readAsDataURL(file);
        }
    };
	};
    function getTooltipHtml(dataName, dataImg) {
        const cleanName = dataName.replace(/\s*\([^)]*\)$/, "");
        let foundStats = "";
        let rarityClass = "legendary";
        for (const mob in lootTable) {
            const item = lootTable[mob].find(i => i.img === dataImg || i.stats.split('||')[0] === dataName);
            if (item) {
                const parts = item.stats.split('||');
                if(parts[1]) {
                    if(parts[1].includes('rarity=heroic')) rarityClass = 'heroic';
                    if(parts[1].includes('rarity=unique')) rarityClass = 'unique';
                    foundStats = parts[1].replace(/;/g, '<br>').replace(/rarity=[^<]+/, '');
                }
                break;
            }
        }
        let contentHtml = "";
        if (foundStats) {
            contentHtml = `<div class="tooltip-stats">${foundStats}</div>`;
        } else {
            const safeName = encodeURIComponent(cleanName);
            const mwLink = `https://margoworld.pl/item?name=${safeName}`;
            contentHtml = `
                <div class="tooltip-stats" style="margin-top:8px; padding-top:8px; border-top:1px dashed #555;">
                    <a href="${mwLink}" target="_blank" style="color:var(--gold); text-decoration:none; font-weight:bold; cursor:pointer; display:block; padding:5px; background:rgba(255,215,0,0.1); border-radius:4px;">
                        🔗 Sprawdź na MargoWorld
                     </a>
                </div>
            `;
        }
        return `
            <div class="tooltip-container" style="pointer-events: auto;">
                <div class="tooltip-name ${rarityClass}">${window.escapeHtml(cleanName)}</div>
                <img src="${dataImg}" class="tooltip-img">
                ${contentHtml}
            </div>
        `;
    }
    function parseGold(str) {
        if(!str) return 0;
        str = str.toString().toLowerCase().replace(',', '.').replace(/\s/g, '');
        let multiplier = 1;
        if (str.endsWith('g')) multiplier = 1000000000;
        else if (str.endsWith('m')) multiplier = 1000000;
        else if (str.endsWith('k')) multiplier = 1000;
        const num = parseFloat(str);
        if (isNaN(num)) return 0;
        return Math.floor(num * multiplier);
    }
    window.toggleCalc = () => {
        const modal = document.getElementById('calcModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    };
    window.calculateLoot = () => {
        const rawAmount = document.getElementById('calcAmount').value;
        const amount = parseGold(rawAmount);
        const totalPlayers = parseInt(document.getElementById('calcPlayers').value) || 1;
        const mode = document.getElementById('calcMode').value; // 'equal', 'finder', 'detector'
        const resultBox = document.getElementById('calcOutput');

        if(amount <= 0 || totalPlayers < 1) {
            resultBox.style.display = 'block';
            resultBox.style.color = 'var(--red)';
            resultBox.innerText = "Podaj poprawną kwotę i liczbę graczy!";
            return;
        }

        const format = (num) => num.toLocaleString('pl-PL');
        let html = `<div style="font-size:0.8em; color:#888; border-bottom:1px solid #333; padding-bottom:5px; margin-bottom:10px;">
            Sprzedaż: <b>${format(amount)}</b>
        </div>`;

        // --- TRYB: ZASADA ZNALAZCY (1 os. bierze 50%) ---
        if (mode === 'finder') {
            if (totalPlayers < 2) {
                // Jak jest 1 gracz, bierze wszystko
                html += `<div>Dla Ciebie: <span class="highlight-text">${format(amount)} złota</span></div>`;
            } else {
                const finderShare = Math.floor(amount * 0.50);
                const restPool = amount - finderShare;
                const restCount = totalPlayers - 1;
                const restShare = Math.floor(restPool / restCount);

                html += `
                    <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px dashed #444;">
                        👑 <b>Znalazca</b> (50%): <br>
                        <span class="highlight-text" style="font-size:1.3em;">${format(finderShare)} złota</span>
                    </div>
                    <div>👥 <b>Reszta ekipy</b> (${restCount} os.): <br>
                    <span style="color:#4fffa8; font-weight:bold; font-size:1.2em;">${format(restShare)} złota</span> <small>/os.</small>
                    </div>
                `;
            }
        } 
        // --- TRYB: WYKRYWAJKA (2 os. dzielą się 50%, czyli po 25%) ---
        else if (mode === 'detector') {
            if (totalPlayers < 2) {
                resultBox.style.display = 'block';
                resultBox.style.color = 'var(--red)';
                resultBox.innerText = "Do Wykrywajki potrzeba min. 2 graczy!";
                return;
            }
            
            const vipPool = Math.floor(amount * 0.50); // 50% dla VIP-ów
            const vipShare = Math.floor(vipPool / 2);  // Każdy VIP dostaje 25% całości
            
            const restPool = amount - vipPool;         // Drugie 50% dla reszty
            const restCount = totalPlayers - 2;        // Liczba "zwykłych" graczy

            html += `
                <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px dashed #444;">
                    🕵️ <b>Wykrywacz i Znalazca</b> (po 25%): <br>
                    <span class="highlight-text" style="font-size:1.3em; color:var(--purple);">${format(vipShare)} złota</span> <small>/os.</small>
                </div>
            `;

            if (restCount > 0) {
                const restShare = Math.floor(restPool / restCount);
                html += `
                    <div>👥 <b>Reszta ekipy</b> (${restCount} os.): <br>
                    <span style="color:#4fffa8; font-weight:bold; font-size:1.2em;">${format(restShare)} złota</span> <small>/os.</small>
                    </div>
                `;
            } else {
                html += `<div style="color:#666; font-size:0.8em;">(Tylko 2 osoby w podziale, biorą po 50%)</div>`;
            }
        } 
        // --- TRYB: RÓWNY PODZIAŁ ---
        else {
            const share = Math.floor(amount / totalPlayers);
            html += `
                <div>Dla każdego (${totalPlayers} os.): <br><span class="highlight-text" style="font-size:1.4em;">${format(share)} złota</span></div>
            `;
        }

        resultBox.style.display = 'block';
        resultBox.style.color = '#eee';
        resultBox.innerHTML = html;
        window.playSound('coin');
    };
    window.setFilter = (type, val) => {
        // Reset kategorii jeśli klikamy to samo, ustawiamy typ jeśli to typ
        if (type === 'cat' && currentFilters.cat === val) currentFilters.cat = 'all';
        else currentFilters[type] = val;

        document.querySelectorAll('.filter-btn').forEach(b => {
            const id = b.id.replace('f-', '');
            
            // Tuta była lista, w której brakowało 'archive'
            // Dodałem 'archive' oraz 'chest' do tablicy
            if(type==='type' && ['all','sprzedam','kupie','zamienie','gold','chest','exp','other','fav','mine','archive'].includes(id)) {
                b.classList.toggle('active', id === currentFilters.type);
            }
            
            if(type==='cat' && ['herosi','e2'].includes(id)) {
                b.classList.toggle('active', id === currentFilters.cat);
            }
        });
        
        window.renderOffers();
    };
window.renderOffers = () => {
    const list = document.getElementById('offersList');
    const search = document.getElementById('globalSearch').value.toLowerCase();
    const selectedUser = document.getElementById('userFilterSelect').value;
    const selectedProf = document.getElementById('profFilter').value;
    const minLvl = parseInt(document.getElementById('minLvlInput').value) || 0;
    const maxLvl = parseInt(document.getElementById('maxLvlInput').value) || 9999;
    const favs = JSON.parse(localStorage.getItem('targ_favs') || '[]');
    
    list.innerHTML = "";
    let count = 0;
    
    allOffers.forEach(data => {
        // --- 1. INICJALIZACJA DANYCH ---
        const isSold = data.status === 'sold';
        const isSkrytka = data.name.toLowerCase().includes('(s)');
        const isFav = favs.includes(data.id);
        const isOwner = currentUser && data.userId === currentUser.uid;
        const isHeros = monstersList.herosi.some(m => m.name === data.source);
        const isE2 = monstersList.e2.some(m => m.name === data.source);
        const monsterLvl = extractLevel(data.source);
        const isAdmin = currentNick === ADMIN_NICK;

        // --- 2. LOGIKA ARCHIWUM I WIDOCZNOŚCI (ZMIENIONA) ---
        
        if (currentFilters.type === 'archive') {
            // W samym archiwum chcemy TYLKO sprzedane
            if (!isSold) return;
        } 
        else if (currentFilters.type === 'all') {
            // W trybie "Wszystkie" NIE ROBIMY nic - przepuszczamy i sprzedane, i dostępne
        } 
        else {
            // W każdym innym konkretnym filtrze (Sprzedam, Kupię, Moje, Ulubione itd.) 
            // ukrywamy sprzedane, żeby zachować przejrzystość
            if (isSold) return;
        }

        // --- 3. FILTRY SPECJALNE I TYPY ---
        
        if (currentFilters.type === 'fav' && !isFav) return;
        if (currentFilters.type === 'mine' && !isOwner) return;

        if (currentFilters.type === 'chest') {
            if (data.type !== 'chest' && !isSkrytka) return;
        } 
        else if (currentFilters.type !== 'all' && 
                 currentFilters.type !== 'archive' && 
                 currentFilters.type !== 'mine' && 
                 currentFilters.type !== 'fav') {
            
            if (data.type !== currentFilters.type) return;
            if (currentFilters.type === 'sprzedam' && isSkrytka) return;
        }

        // Pozostałe filtry (Kategoria, Szukaj, Level, Profesja)
        if (currentFilters.cat === 'herosi' && !isHeros) return;
        if (currentFilters.cat === 'e2' && !isE2) return;
        if (!data.name.toLowerCase().includes(search)) return;
        if (selectedUser && data.nick !== selectedUser) return;
        if (monsterLvl < minLvl || monsterLvl > maxLvl) return;

        if (selectedProf && selectedProf !== 'a') {
            const match = data.name.match(/\(([^)]+)\)[^()]*$/);
            if (match) {
                if (!match[1].toLowerCase().includes(selectedProf)) return;
            } else { return; }
        }

        // --- 4. PRZYGOTOWANIE WIZUALNE (Kłódki, Klasy, Przyciski) ---
        
        // --- 4. PRZYGOTOWANIE WIZUALNE (Kłódki) ---
        let bondingIcon = "";
        const hideBondingFor = ['gold', 'chest', 'exp', 'other'];
        
        if (!hideBondingFor.includes(data.type) && !isSkrytka) {
            if (data.bonding === 'any') {
                // Ikona dla "Obojętne" (Dwie kłódki)
                bondingIcon = '<span title="Wiązanie: Obojętne (To i to)" style="margin-right:5px; color:#aaa; cursor:help;">🔓/🔒</span>';
            } 
            else if (data.bonding === 'unbound') {
                // Ikona dla odwiązanych (świecąca na złoto)
                bondingIcon = '<span title="Przedmiot Odwiązany" style="margin-right:5px; text-shadow:0 0 10px var(--gold); cursor:help;">🔓</span>';
            } 
            else {
                // Ikona dla związanych (lekko szara, domyślna)
                bondingIcon = '<span title="Przedmiot Związany" style="margin-right:5px; opacity: 0.5; cursor:help;">🔒</span>';
            }
        }

        let typeClass = "type-" + data.type;
        if (data.type === 'chest' || isSkrytka) typeClass = "type-chest";
        const soldClass = isSold ? "is-sold" : "";

        let imgHtml = "";
        if (data.img && data.img.includes('|')) {
            const urls = data.img.split('|');
            imgHtml = '<div class="multi-chest-wrapper">';
            urls.forEach(url => { imgHtml += `<img src="${url}" class="mini-chest-img">`; });
            imgHtml += '</div>';
        } else {
            imgHtml = `<img src="${data.img}" class="item-img">`;
        }

        // Przyciski
        let btnRes = "";
        if (!data.reservedBy && !isSold) {
            btnRes = `<button class="small-btn reserve-btn" onclick="reserveOffer('${data.id}')" title="Zarezerwuj">🛡️</button>`;
        } else if ((isOwner || isAdmin) && data.reservedBy && !isSold) {
            btnRes = `<button class="small-btn unreserve-btn" onclick="cancelReservation('${data.id}')" title="Cofnij rezerwację">🔓</button>`;
        }

        let mailBtn = (!isOwner && currentUser && !isSold) ? `<button class="small-btn msg-btn" onclick="openCompose('${data.userId}', '${window.escapeHtml(data.nick)}', '${window.escapeHtml(data.name)}')" title="Wyślij wiadomość">✉️</button>` : "";
        
        let ownerBtns = "";
        if (isOwner && !isSold) {
            ownerBtns += `<button class="small-btn edit-added" onclick="openFullEdit('${data.id}','${window.escapeHtml(data.name)}','${window.escapeHtml(data.price)}','${window.escapeHtml(data.desc)}','${window.escapeHtml(data.img)}','${data.bonding || 'bound'}', '${data.type}')">✏️</button>`;
            if (['sprzedam', 'gold', 'chest', 'exp', 'other'].includes(data.type)) {
                ownerBtns += `<button class="small-btn" onclick="markAsSold('${data.id}')" title="Oznacz jako sprzedane" style="border-color:var(--gold); color:var(--gold);">💰</button>`;
            }
        }
        
        let deleteBtn = (isOwner || isAdmin) ? `<button class="small-btn delete-btn" onclick="deleteOffer('${data.id}')" title="Usuń całkowicie">🗑️</button>` : "";

        let tooltipHtml = (['sprzedam', 'kupie', 'zamienie'].includes(data.type) && !isSkrytka) ? getTooltipHtml(data.name, data.img) : "";
        const displayName = data.name.replace(/\s*\([^)]*\)$/, "");
        const isOnline = isUserOnline(data.userId);
        const onlineHtml = isOnline ? '<span class="online-dot" title="Online"></span>' : '';

        // --- 5. RENDEROWANIE KARTY ---
        count++;
        list.innerHTML += `
            <div class="offer-card ${typeClass} ${soldClass}">
                ${tooltipHtml}
                ${isSold ? '<div class="sold-stamp">SPRZEDANE</div>' : ''}
                <div class="tag ${data.type}">${data.type.toUpperCase()}</div>
                <button class="fav-btn ${isFav?'active':''}" onclick="toggleFav('${data.id}')">❤</button>
                ${imgHtml}
                <div class="item-title">${bondingIcon}${window.escapeHtml(displayName)}</div>
                <div class="item-source">
                    <img src="${data.sourceImg}"> <span>${data.source}</span>
                </div>
                <div class="price-tag">${window.escapeHtml(data.price)}</div>
                ${data.reservedBy ? `<div style="font-size:0.7em; color:var(--green); margin:5px 0;">🔒 Rez: ${data.reservedBy}</div>` : ""}
                ${data.desc ? `<div style="font-size:0.8em; color:#888; font-style:italic; margin-bottom:10px; text-align:center;">"${window.escapeHtml(data.desc)}"</div>` : ""}
                <div class="seller-info">
                    <div class="seller-left">
                        <div class="avatar-wrapper">
                            <img src="${data.avatar}" class="tiny-avatar">
                            ${onlineHtml}
                        </div>
                        <b>${window.escapeHtml(data.nick)}</b>
                    </div>
                    <div class="btn-group">
                        ${mailBtn} ${btnRes} ${ownerBtns} ${deleteBtn}
                    </div>
                </div>
            </div>`;
    });
    document.getElementById('offerStats').innerText = `Widocznych ofert: ${count}`;
};
    window.loginGoogle = () => { signInWithPopup(auth, provider).catch(e => alert(e.message)); };
    document.getElementById('googleLoginBtn').addEventListener('click', window.loginGoogle);
    onAuthStateChanged(auth, async (user) => {
        currentUser = user;
        if(user) {
			
            const ref = doc(db, "users", user.uid);
            const snap = await getDoc(ref);
            if(snap.exists()) {
                currentNick = snap.data().nick;
                await updateDoc(ref, { lastActive: new Date().toISOString() });
            } else {
                let n = prompt("Twój nick:");
                if(n && n.trim()) { 
                    currentNick = n.trim(); 
                    await setDoc(ref, {nick:currentNick, lastActive: new Date().toISOString()}); 
                } else await signOut(auth);
            }
            document.getElementById('googleLoginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';
            document.getElementById('userAvatar').src = user.photoURL;
            document.getElementById('userNickDisplay').innerText = currentNick;
            document.getElementById('toggleAddBtn').style.display = 'block';
            document.getElementById('addOfferPanel').style.display = 'none'; 
            startMailListener();
            startHeartbeat();
			startAnnouncementListener(); // <--- DODAJ TO
			startSplitHistory();
        } else {
            document.getElementById('googleLoginBtn').style.display = 'flex';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('addOfferPanel').style.display = 'none';
            document.getElementById('toggleAddBtn').style.display = 'none';
        }
        window.renderOffers();
    });

	// Walidacja ceny (teraz obsługuje też PLN i ZŁ)
    window.validatePriceInput = (input) => {
        // Akceptuje: liczby + k/m/g LUB liczby + pln/zł (wielkość liter dowolna)
        const pattern = /^\d+(\.\d+)?\s*([kmg]|pln|zł)$/i;
        input.style.borderColor = pattern.test(input.value.trim()) ? 'var(--green)' : 'var(--red)';
    };

    // Pokazywanie pola dopłaty w "Zamienię"
    window.toggleSurchargeInput = () => {
        const chk = document.getElementById('tradeSurchargeCheck');
        const inp = document.getElementById('tradeSurchargeInput');
        inp.style.display = chk.checked ? 'block' : 'none';
        if (!chk.checked) inp.value = "";
    };
	
    window.addOffer = async () => {
        const type = document.getElementById('offerType').value;
        const sel = document.getElementById('itemSource');
        
        let finalPrice = "";
        let finalName = document.getElementById('itemName').value;
        let finalImg = document.getElementById('itemImg').value;
        let finalSource = sel.value;
        // Pobieramy obrazek potwora, ale zaraz go nadpiszemy dla ofert specjalnych
        let finalSourceImg = sel.options[sel.selectedIndex]?.dataset.img || ''; 
        let finalBonding = document.getElementById('itemBonding').value;

        // 1. Logika dla "SPRZEDAM"
        if (type === 'sprzedam') {
            const inp = document.getElementById('itemPrice');
            const pattern = /^\d+(\.\d+)?\s*([kmg]|pln|zł)$/i;
            if (!pattern.test(inp.value.trim())) {
                return alert("Błędna cena! Wpisz np: 150m, 50k, 20 PLN");
            }
            finalPrice = inp.value.trim().toLowerCase();
            if (!sel.value) return alert("Wybierz potwora z listy!");
        }

        // 2. Logika dla "KUPIĘ"
        else if (type === 'kupie') {
            const currency = document.getElementById('buyCurrency').value;
            finalPrice = `Płacę: ${currency}`;
            if (!sel.value) return alert("Wybierz co chcesz kupić!");
        }

        // 3. Logika dla "ZAMIENIĘ"
        else if (type === 'zamienie') {
            const surcharge = document.getElementById('tradeSurchargeInput').value.trim();
            const hasSurcharge = document.getElementById('tradeSurchargeCheck').checked;
            
            if (hasSurcharge && surcharge) {
                finalPrice = `Dopłata: ${surcharge}`;
            } else {
                finalPrice = "Wymiana";
            }
            if (!sel.value) return alert("Wybierz przedmiot!");
        }

        // 4. Logika dla "HANDEL ZŁOTEM"
        else if (type === 'gold') {
            const action = document.getElementById('goldAction').value;
            const amount = document.getElementById('goldAmount').value.trim();
            
            if (!amount) return alert("Podaj ilość złota!");
            
            finalName = `${action} Złoto`; 
            finalPrice = amount;           
            finalSource = "Kantor";
            finalSourceImg = ""; 
            finalBonding = "bound";
        }

        // 5. Logika dla "POMOC / EXPIENIE"
        else if (type === 'exp') {
            finalPrice = "Do dogadania";
            finalSource = "Usługa";
            finalSourceImg = ""; 
            finalBonding = "bound";
        }

        // 6. Logika dla "INNE"
        else if (type === 'other') {
            finalPrice = "Inne";
            finalSource = "Ogłoszenie";
            finalSourceImg = ""; 
            finalBonding = "bound";
        }

        // 7. Logika dla "SKRZYNKI" (ZAKTUALIZOWANA)
        // 7. Logika dla "SKRZYNKI" (POPRAWIONA)
        // 7. Logika dla "SKRZYNKI" (Z CENAMI CZĄSTKOWYMI)
        else if (type === 'chest') {
            const rows = document.querySelectorAll('.chest-row');
            if (rows.length === 0) return alert("Dodaj przynajmniej jedną skrzynkę!");
            
            const chestAction = document.getElementById('chestAction').value; // Sprzedam / Kupię
            const chestTotalInput = document.getElementById('chestPrice');
            const chestTotalPrice = chestTotalInput ? chestTotalInput.value.trim() : "";

            let chestSummary = [];
            let imagesArray = [];
            
            for (let row of rows) {
                const select = row.querySelector('.chest-select');
                const qty = row.querySelector('.chest-qty').value;
                const singlePrice = row.querySelector('.chest-row-price').value.trim();
                
                if (!select.value || qty < 1) return alert("Uzupełnij nazwy i ilość skrzynek!");
                
                // Budujemy opis
                let rowText = `${qty}x ${select.value.replace('Skrzynia ', '')}`;
                
                // Dopisz cenę TYLKO jeśli to sprzedaż i cena została wpisana
                if (chestAction === 'Sprzedam' && singlePrice) {
                    rowText += ` (${singlePrice})`;
                }
                
                chestSummary.push(rowText);
                
                const u = select.options[select.selectedIndex].dataset.img;
                if(u) imagesArray.push(u);
            }

            finalName = `${chestAction}: ` + chestSummary.join(', ');
            finalImg = imagesArray.join('|');
            
            // Logika ceny głównej (Sumy)
            if (chestAction === 'Kupię') {
                finalPrice = "Do dogadania";
            } else {
                // Jeśli wpisałeś cenę ogólną, użyj jej. Jeśli nie, napisz "Patrz opis"
                finalPrice = chestTotalPrice || "Patrz opis"; 
            }

            finalSource = "Skrzynki Herosów";
            finalSourceImg = ""; 
            finalBonding = "bound";
        }

        // Wysyłka do Firebase
        await addDoc(collection(db, "oferty"), {
            userId: currentUser.uid, 
            nick: currentNick, 
            avatar: currentUser.photoURL,
            type: type,
            bonding: finalBonding,
            name: finalName,
            price: finalPrice, 
            source: finalSource, 
            sourceImg: finalSourceImg,
            desc: document.getElementById('itemDesc').value,
            img: finalImg,
            date: new Date().toISOString(), 
            reservedBy: null
        });
        
        window.playSound('coin');
        window.alert("Dodano ofertę! ✅");
        
        // Reset formularza
        document.getElementById('addOfferPanel').style.display = 'none';
        document.getElementById('toggleAddBtn').innerText = '+ WYSTAW ARTEFAKT';
        
        // Reset do stanu początkowego
        document.getElementById('offerType').value = 'sprzedam';
        window.toggleSpecialFields();
        
        // Czyścimy inputy skrzynek
        document.getElementById('chestRowsArea').innerHTML = "";
        document.getElementById('chestPrice').value = "";
    };
    
    window.reserveOffer = async (id) => { if(!currentNick) return alert("Zaloguj się!"); await updateDoc(doc(db, "oferty", id), { reservedBy: currentNick }); window.playSound('click'); };
    window.cancelReservation = async (id) => { await updateDoc(doc(db, "oferty", id), { reservedBy: null }); window.playSound('click'); };
    window.deleteOffer = async (id) => { if(confirm("Usunąć?")) await deleteDoc(doc(db, "oferty", id)); };
    window.logout = () => signOut(auth);
	window.searchMargo = () => {
        const rawName = document.getElementById('itemName').value;
        if (!rawName) return window.alert("Wpierw wpisz lub wybierz przedmiot!");

        // Czyścimy nazwę: usuwamy wszystko od nawiasu w prawo, np. "Maska (m/p)" -> "Maska"
        const cleanName = rawName.split('(')[0].trim();

        // Budujemy bezpieczny link
        const url = `https://margoworld.pl/item?name=${encodeURIComponent(cleanName)}`;
        
        window.open(url, '_blank');
    };
		window.openFullEdit = (id, n, p, d, i, b, type) => {
        currentEditId = id;
        document.getElementById('fullEditName').value = n;
        document.getElementById('fullEditPrice').value = p;
        document.getElementById('fullEditDesc').value = d;
        document.getElementById('fullEditImg').value = i;
        
        const bondingSelect = document.getElementById('fullEditBonding');
        bondingSelect.value = b || 'bound';

        // Ukrywamy wybór kłódki, jeśli edytujemy złoto, skrzynki lub exp
        const hideBondingFor = ['gold', 'chest', 'exp', 'other'];
        if (hideBondingFor.includes(type)) {
            bondingSelect.style.display = 'none';
        } else {
            bondingSelect.style.display = 'block';
        }
        
        document.getElementById('editModal').style.display = 'flex';
    };
	window.closeFullEdit = () => document.getElementById('editModal').style.display='none';
    window.confirmFullEdit = async () => {
        // Pobieramy wartości z pól w oknie edycji
        const updatedName = document.getElementById('fullEditName').value;
        const updatedPrice = document.getElementById('fullEditPrice').value;
        const updatedDesc = document.getElementById('fullEditDesc').value;
        const updatedImg = document.getElementById('fullEditImg').value;
        const updatedBonding = document.getElementById('fullEditBonding').value; // <--- TEGO CI BRAKOWAŁO

        // Wysyłamy komplet danych do bazy Firebase
        await updateDoc(doc(db, "oferty", currentEditId), { 
            name: updatedName, 
            price: updatedPrice, 
            desc: updatedDesc, 
            img: updatedImg,
            bonding: updatedBonding // <--- TO MUSI TU BYĆ, żeby kłódka się zmieniała
        });

        window.closeFullEdit();
        window.alert("Ogłoszenie zaktualizowane! ✅");
    };
    window.updateLootList = () => {
        const selSource = document.getElementById('itemSource');
        const srcName = selSource.value;
        const srcImg = selSource.options[selSource.selectedIndex]?.dataset.img;
        const selItem = document.getElementById('itemSelect');
        const searchItem = document.getElementById('itemSearch');
        const preview = document.getElementById('livePreview');
        const previewIcon = document.getElementById('previewIcon');
        const previewName = document.getElementById('previewName');
        if (srcImg) { preview.style.display = 'flex'; previewIcon.src = srcImg; previewName.innerText = srcName; } else { preview.style.display = 'none'; }
        if(!srcName || !lootTable[srcName]) { searchItem.style.display = 'none'; selItem.style.display = 'none'; return; }
        searchItem.style.display = 'block'; selItem.style.display = 'block';
        selItem.innerHTML = '<option value="">-- Przedmiot --</option>';
        lootTable[srcName].filter(i => i.stats.split('||')[0].toLowerCase().includes(searchItem.value.toLowerCase())).forEach(i => {
            let o = document.createElement('option'); o.value = JSON.stringify(i); o.innerText = i.stats.split('||')[0]; selItem.appendChild(o);
        });
    };
    window.fillItemDetails = () => {
        const val = document.getElementById('itemSelect').value;
        const preview = document.getElementById('livePreview');
        const previewIcon = document.getElementById('previewIcon');
        const previewName = document.getElementById('previewName');
        if(!val) { window.updateLootList(); return; }
        const data = JSON.parse(val);
        const name = data.stats.split('||')[0];
        document.getElementById('itemName').value = name;
        document.getElementById('itemImg').value = data.img;
        preview.style.display = 'flex'; 
        previewIcon.src = data.img;
        previewName.innerText = name;
        const statsPart = data.stats.split('||')[1];
        if (statsPart && statsPart.includes('opis=')) {
            document.getElementById('itemDesc').value = statsPart.split('opis=')[1].split(';')[0].replaceAll('[br]', '\n');
        } else { document.getElementById('itemDesc').value = ""; }
    };
    onSnapshot(query(collection(db, "oferty"), orderBy("date", "desc")), (snap) => {
        allOffers = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        updateUserFilterOptions();
        window.renderOffers();
    });
    window.alert = function(message) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        let icon = '⚔️';
        if (message.toLowerCase().includes('błąd') || message.toLowerCase().includes('wybierz')) { toast.classList.add('error'); icon = '⚠️'; 
        } else if (message.toLowerCase().includes('wysłana') || message.toLowerCase().includes('skopiowano') || message.toLowerCase().includes('dodano')) { toast.classList.add('success'); icon = '✅'; }
        toast.innerHTML = `<span style="font-size:1.2em;">${icon}</span> <span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 4000);
    };
    const scrollBtn = document.getElementById("scrollTopBtn");
    window.onscroll = function() { 
        if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
            scrollBtn.style.display = "flex"; scrollBtn.style.alignItems = "center"; scrollBtn.style.justifyContent = "center";
        } else { scrollBtn.style.display = "none"; }
    };
    window.topFunction = function() { window.scrollTo({top: 0, behavior: 'smooth'}); }
    window.toggleAddOfferPanel = () => {
        const panel = document.getElementById('addOfferPanel');
        const btn = document.getElementById('toggleAddBtn');
        if (panel.style.display === 'none') {
            panel.style.display = 'block';
            btn.innerText = '− UKRYJ FORMULARZ';
            btn.style.background = '#333'; 
            btn.style.color = '#fff';
        } else {
            panel.style.display = 'none';
            btn.innerText = '+ WYSTAW ARTEFAKT';
            btn.style.background = 'linear-gradient(to bottom, #ffd700, #b8860b)';
            btn.style.color = '#000';
        }
    };

	// --- NAPRAWIONA OBSŁUGA UPLOADU ---
    window.handleFileUpload = (input) => {
        // Sprawdzamy czy coś wybrano
        if (input.files && input.files[0]) {
            const file = input.files[0];
            
            console.log("Wybrano plik:", file.name, "Rozmiar:", file.size); // To zobaczysz w konsoli F12

            // Zabezpieczenie: Max 800KB (Firebase ma limit 1MB na dokument)
            if (file.size > 800 * 1024) {
                return window.alert("Obrazek jest za duży! (Max 800KB). Zmniejsz go w Paintcie lub użyj linku.");
            }

            const reader = new FileReader();
            
            // Co ma się stać po wczytaniu pliku
            reader.onload = (e) => {
                const base64String = e.target.result;
                
                // Wpisujemy kod do pola tekstowego
                const imgInput = document.getElementById('itemImg');
                imgInput.value = base64String;
                
                // Wymuszamy odświeżenie podglądu
                if(window.manualImgPreview) {
                    window.manualImgPreview();
                } else {
                    // Awaryjny podgląd, gdyby funkcja manualImgPreview nie działała
                    document.getElementById('livePreview').style.display = 'flex';
                    document.getElementById('previewIcon').src = base64String;
                }
                
                window.alert("Wczytano plik z dysku! ✅");
            };

            // Jeśli wystąpi błąd
            reader.onerror = (error) => {
                console.error('Błąd:', error);
                window.alert("Błąd podczas wczytywania pliku.");
            };

            // Rozkaz wczytania pliku jako tekst (Base64)
            reader.readAsDataURL(file);
        } else {
            console.log("Anulowano wybór pliku");
        }
    };

// --- KALKULATOR ESENCJI (WG TWOJEJ LISTY) ---
    window.toggleEssence = () => {
        const modal = document.getElementById('essenceModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    };

    window.calculateEssence = () => {
        const lvlInput = document.getElementById('essLvl');
        const lvl = parseInt(lvlInput.value);
        const resultBox = document.getElementById('essResult');

        if (isNaN(lvl) || lvl < 20) {
            resultBox.style.display = 'block';
            resultBox.style.color = 'var(--red)';
            resultBox.innerHTML = "Minimalny poziom to 20!";
            return;
        }
        
        if (lvl > 300) {
             resultBox.style.display = 'block';
             resultBox.style.color = 'var(--red)';
             resultBox.innerHTML = "Maksymalny poziom to 300!";
             return;
        }

        let esencja = 0;

        // --- LOGIKA WG TWOJEJ ROZPISKI ---
        if (lvl >= 20 && lvl <= 24) {
            esencja = 12;
        } else {
            // Wzór, który pasuje do Twojej listy od 25 lvl w górę:
            // 25-34 -> 13
            // 35-44 -> 14
            // itd.
            esencja = Math.floor((lvl - 5) / 10) + 11;
        }

        resultBox.style.display = 'block';
        resultBox.style.color = '#cca3ff'; // Fioletowy kolor wyniku
        resultBox.innerHTML = `
            <div style="font-size:0.9em; color:#aaa; margin-bottom:5px;">Przedmiot ${lvl} lvl</div>
            <div style="font-size:1.8em; font-weight:bold; text-shadow: 0 0 10px #9b59b6;">${esencja} esencji</div>
        `;
        window.playSound('click');
    };

// --- ZESZYT DŁUŻNIKÓW ---
    let debtsUnsub = null;
    
    window.toggleDebts = () => {
        const modal = document.getElementById('debtsModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        if(modal.style.display === 'flex') startDebtsListener();
    };

    window.addDebt = async () => {
        if(!currentNick) return alert("Zaloguj się!");
        const who = document.getElementById('debtWho').value.trim();
        const amount = document.getElementById('debtAmount').value.trim();
        const note = document.getElementById('debtNote').value.trim();
        
        if(!who || !amount) return alert("Podaj KTO i ILE!");
        
        await addDoc(collection(db, "dlugi"), {
            lender: currentNick, // Kto pożyczył (ten kto wpisuje)
            lenderId: currentUser.uid,
            borrower: who,
            amount: amount,
            note: note,
            isPaid: false,
            date: new Date().toISOString()
        });
        
        document.getElementById('debtWho').value = "";
        document.getElementById('debtAmount').value = "";
        document.getElementById('debtNote').value = "";
        window.playSound('coin');
    };

    function startDebtsListener() {
        if(debtsUnsub) debtsUnsub();
        // Pobieramy długi gdzie my jesteśmy wierzycielem (dodałem) LUB dłużnikiem (opcjonalnie można filtrować)
        // Tutaj prosta wersja: widzimy długi które MY dodaliśmy (jako wierzyciel)
        const q = query(collection(db, "dlugi"), where("lenderId", "==", currentUser.uid), orderBy("date", "desc"));
        
        debtsUnsub = onSnapshot(q, (snap) => {
            const div = document.getElementById('debtsListContent');
            if(snap.empty) { div.innerHTML = "<div style='text-align:center; color:#666;'>Czysto. Nikt Ci nie wisi kasy.</div>"; return; }
            
            div.innerHTML = "";
            snap.docs.forEach(d => {
                const item = d.data();
                div.innerHTML += `
                    <div class="debt-item ${item.isPaid ? 'paid' : ''}">
                        <div class="debt-info">
                            <span class="debt-who">${window.escapeHtml(item.borrower)}</span>
                            <span class="debt-amount">${window.escapeHtml(item.amount)}</span>
                            <span style="font-size:0.8em; color:#888;">${window.escapeHtml(item.note)}</span>
                        </div>
                        <div class="debt-actions">
                            <button onclick="toggleDebtPaid('${d.id}', ${!item.isPaid})" class="small-btn" title="Oznacz jako spłacone" style="border-color:${item.isPaid ? '#555' : 'var(--green)'}; color:${item.isPaid ? '#555' : 'var(--green)'}">
                                ${item.isPaid ? '↺' : '✅'}
                            </button>
                            <button onclick="deleteDebt('${d.id}')" class="small-btn" style="border-color:#555; color:#666;">🗑️</button>
                        </div>
                    </div>
                `;
            });
        });
    }

    window.toggleDebtPaid = async (id, status) => {
        await updateDoc(doc(db, "dlugi", id), { isPaid: status });
        window.playSound('click');
    };
    
    window.deleteDebt = async (id) => {
        if(confirm("Usunąć ten wpis o długu?")) await deleteDoc(doc(db, "dlugi", id));
    };

    // --- ARCHIWUM CEN ---
    window.markAsSold = async (id) => {
        if(confirm("Oznaczyć jako SPRZEDANE? Oferta trafi do archiwum.")) {
            await updateDoc(doc(db, "oferty", id), { status: 'sold' });
            window.playSound('coin');
            window.alert("Sprzedane! Przeniesiono do archiwum.");
        }
    };

// --- GENERATOR ISKIER ---
    function createEmber() {
        const container = document.getElementById('embers-container');
        if(!container) return; // Zabezpieczenie

        const ember = document.createElement('div');
        ember.classList.add('ember');
        
        // Losowe parametry dla każdej iskierki
        const size = Math.random() * 4 + 2 + 'px'; // Wielkość 2-6px
        const left = Math.random() * 100 + 'vw';   // Pozycja pozioma
        const duration = Math.random() * 3 + 4 + 's'; // Czas lotu 4-7s
        const color = Math.random() > 0.5 ? '#ff4500' : '#ffd700'; // Pomarańcz lub złoto
        
        ember.style.width = size;
        ember.style.height = size;
        ember.style.left = left;
        ember.style.animationDuration = duration;
        ember.style.background = color;
        
        container.appendChild(ember);

        // Usuń iskrę po zakończeniu animacji, żeby nie zapychać pamięci
        setTimeout(() => {
            ember.remove();
        }, 7000);
    }

    // Twórz nową iskrę co 300ms (możesz zmienić na 100ms żeby było ich więcej)
    setInterval(createEmber, 350);

	// --- SYSTEM PODZIAŁÓW 2.0 (GRAFICZNY) ---
    let splitUnsub = null;
	let currentSplitCount = 0; // Ta zmienna będzie trzymać aktualną liczbę wpisów
// --- SYSTEM PODZIAŁÓW 2.0 (ZMIENNE STANU) ---
    // Upewnij się, że te dwie linie są wyżej niż funkcje, które ich używają
    var s_Bosses = []; 
    var s_Team = [];

    window.openSplitModal = () => {
        // 1. Pokazujemy okno
        document.getElementById('splitModal').style.display = 'flex';
        
        // 2. Ustawiamy domyślny tryb i odświeżamy widok sekcji szefa
        document.getElementById('splitMode').value = 'equal';
        window.updateSplitUI(); 
        
        // 3. Ładujemy listę graczy i historię
        loadSplitUsers();

        // 4. POWIADOMIENIA: Oznaczamy podziały jako przeczytane
        // Zapisujemy aktualną liczbę podziałów w pamięci przeglądarki
        localStorage.setItem('lastSplitCount', currentSplitCount);
        
        // Ukrywamy badge (czerwoną kropkę)
        const badge = document.getElementById('splitBadge');
        if(badge) badge.style.display = 'none';
    };

    window.selectSplitMobType = (type, btn) => {
        document.querySelectorAll('.type-btn-split').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sel = document.getElementById('splitMobSelect');
        sel.innerHTML = '<option value="">-- Wybierz potwora --</option>';
        sel.style.display = 'block';
        monstersList[type].forEach(m => {
            const opt = document.createElement('option');
            opt.value = m.name; opt.innerText = m.name; sel.appendChild(opt);
        });
        document.getElementById('splitLootSection').style.display = 'none';
    };

window.renderSplitLoot = (mobName) => {
        const grid = document.getElementById('splitLootGrid');
        const section = document.getElementById('splitLootSection');
        const hiddenInput = document.getElementById('splitSelectedName');
        const hiddenImgInput = document.getElementById('splitSelectedImg'); // <--- DODAJ TO
        
        grid.innerHTML = "";
        hiddenInput.value = "";
        if(hiddenImgInput) hiddenImgInput.value = ""; // Resetuj obrazek

        if(!mobName || !lootTable[mobName]) {
            section.style.display = 'none';
            return;
        }

        section.style.display = 'block';
        const items = lootTable[mobName];

        items.forEach(item => {
            let displayName = item.stats.split('||')[0].trim();
            
            const div = document.createElement('div');
            div.className = 'loot-card-select';
            
            div.innerHTML = `
                <img src="${item.img}" title="${displayName}" onerror="this.src='https://cdn.margonem.pl/obrazki/itemy/nas/pyt.gif'">
                <div class="loot-name-tooltip">${displayName}</div>
            `;
            
            div.onclick = () => {
                document.querySelectorAll('.loot-card-select').forEach(c => c.classList.remove('selected'));
                div.classList.add('selected');
                
                hiddenInput.value = displayName;
                if(hiddenImgInput) hiddenImgInput.value = item.img; // <--- TĘ LINIKĘ DOPISZ
                
                if(window.playSound) window.playSound('click');
            };
            
            grid.appendChild(div);
        });
    };

    window.updateSplitUI = () => {
        const mode = document.getElementById('splitMode').value;
        const bossSection = document.getElementById('bossSection');
        const teamLabel = document.getElementById('teamLabel');
        const bossLabel = document.getElementById('bossLabel');

        // Czyścimy poprzednie wybory przy zmianie trybu, żeby uniknąć błędów w liczeniu
        s_Bosses = [];
        s_Team = [];
        document.querySelectorAll('.boss-active, .team-active').forEach(el => el.classList.remove('boss-active', 'team-active'));

        if (mode === 'equal') {
            bossSection.style.display = 'none'; 
            teamLabel.innerHTML = "<span style='color:#2ecc71;'>👥 Zaznacz wszystkich uczestników bicia:</span>";
        } else if (mode === 'detector') {
            bossSection.style.display = 'block';
            bossLabel.innerText = "👁️ Zaznacz VIP-ów (Znalazca + Wykrywacz):";
            teamLabel.innerText = "⚔️ Zaznacz resztę osób (Ekipa):";
        } else {
            bossSection.style.display = 'block';
            bossLabel.innerText = "👑 Zaznacz Szefa / Znalazcę (50%):";
            teamLabel.innerText = "⚔️ Zaznacz resztę ekipy:";
        }
    };

    // Podmień loadSplitUsers, aby obsługiwało nową logikę
    async function loadSplitUsers() {
        const bGrid = document.getElementById('splitBossGrid');
        const tGrid = document.getElementById('splitTeamGrid');
        bGrid.innerHTML = ""; tGrid.innerHTML = "";
        
        const snap = await getDocs(collection(db, "users"));
        const users = []; snap.forEach(d => users.push(d.data().nick));
        
        users.sort().forEach(nick => {
            // Przycisk w siatce Szefów
            const bChip = document.createElement('div');
            bChip.className = 'user-chip';
            bChip.innerText = nick;
            bChip.onclick = () => {
                const mode = document.getElementById('splitMode').value;
                if (mode === 'finder') {
                    // Tylko jeden szef
                    document.querySelectorAll('#splitBossGrid .user-chip').forEach(c => c.classList.remove('boss-active'));
                    s_Bosses = [nick];
                    bChip.classList.add('boss-active');
                } else {
                    // Wielu VIPów (Wykrywajka)
                    if (s_Bosses.includes(nick)) {
                        s_Bosses = s_Bosses.filter(n => n !== nick);
                        bChip.classList.remove('boss-active');
                    } else {
                        s_Bosses.push(nick);
                        bChip.classList.add('boss-active');
                    }
                }
            };
            bGrid.appendChild(bChip);

            // Przycisk w siatce Ekipy
            const tChip = document.createElement('div');
            tChip.className = 'user-chip';
            tChip.innerText = nick;
            tChip.onclick = () => {
                if (s_Team.includes(nick)) {
                    s_Team = s_Team.filter(n => n !== nick);
                    tChip.classList.remove('team-active');
                } else {
                    s_Team.push(nick);
                    tChip.classList.add('team-active');
                }
            };
            tGrid.appendChild(tChip);
        });
    }

    // Pomocniczy format (bo w Twoim kodzie parseGold już jest)
function s_formatGold(n) {
        if (n === undefined || n === null || isNaN(n)) return "0";
        if (n >= 1000000000) return (n/1000000000).toFixed(2) + 'G';
        if (n >= 1000000) return (n/1000000).toFixed(1) + 'm';
        if (n >= 1000) return (n/1000).toFixed(0) + 'k';
        return n.toLocaleString();
    }

window.saveFinalSplit = async () => {
        if (!currentUser) return alert("Zaloguj się!");

        const item = document.getElementById('splitSelectedName').value;
        const itemImg = document.getElementById('splitSelectedImg').value;
        const amountStr = document.getElementById('splitFinalAmount').value;
        const mode = document.getElementById('splitMode').value;

        if (!item || !amountStr) return alert("Wybierz przedmiot i wpisz kwotę!");

        const total = parseGold(amountStr);
        if (total <= 0) return alert("Błędna kwota!");

        let bossShareEach = 0;
        let teamShareEach = 0;
        let description = "";

        // --- MATEMATYKA PODZIAŁÓW ---
        
        if (mode === 'equal') {
            // TRYB: RÓWNY PODZIAŁ
            if (s_Team.length === 0) return alert("Zaznacz uczestników w dolnej sekcji!");
            
            description = "Równy podział";
            teamShareEach = Math.floor(total / s_Team.length);
            bossShareEach = 0; // W tym trybie nie ma "Szefa"
            s_Bosses = [];    // Czyścimy szefów na wszelki wypadek
        } 
        else if (mode === 'finder') {
            // TRYB: ZASADA ZNALAZCY
            if (s_Bosses.length !== 1) return alert("Wybierz dokładnie jednego Znalazcę (50%)!");
            if (s_Team.length === 0) return alert("Zaznacz resztę ekipy!");

            description = "Zasada Znalazcy (50/50)";
            const poolBoss = Math.floor(total * 0.5);
            const poolRest = total - poolBoss;
            
            bossShareEach = poolBoss;
            teamShareEach = Math.floor(poolRest / s_Team.length);
        } 
        else if (mode === 'detector') {
            // TRYB: WYKRYWAJKA
            if (s_Bosses.length === 0) return alert("Zaznacz VIP-ów (Znalazca/Wykrywacz)!");
            if (s_Team.length === 0) return alert("Zaznacz resztę ekipy!");

            description = "Wykrywajka (50% dla VIP)";
            const poolVIP = Math.floor(total * 0.5);
            const poolRest = total - poolVIP;
            
            bossShareEach = Math.floor(poolVIP / s_Bosses.length);
            teamShareEach = Math.floor(poolRest / s_Team.length);
        }

        const msg = `Zapisać podział?\nItem: ${item}\nTryb: ${description}\n` + 
                    (bossShareEach > 0 ? `👑 VIP (${s_Bosses.length} os.): po ${s_formatGold(bossShareEach)}\n` : "") +
                    `⚔️ Ekipa (${s_Team.length} os.): po ${s_formatGold(teamShareEach)}`;

        if (confirm(msg)) {
            await addDoc(collection(db, "podzialy"), {
                item, itemImg, total,
                bosses: s_Bosses,
                bossShareEach,
                team: s_Team,
                teamShareEach,
                mode: description,
                date: new Date().toISOString(),
                authorId: currentUser.uid,
                author: currentNick
            });
            
            alert("Podział zapisany! ✅");
            // Resetuj okno
            document.getElementById('splitFinalAmount').value = "";
            document.querySelectorAll('.boss-active, .team-active, .selected').forEach(el => el.classList.remove('boss-active', 'team-active', 'selected'));
            s_Bosses = []; s_Team = [];
            window.playSound('coin');
        }
    };

function startSplitHistory() {
        const q = query(collection(db, "podzialy"), orderBy("date", "desc"), limit(15));
        
        splitUnsub = onSnapshot(q, (snap) => {
			currentSplitCount = snap.size; 
        	updateSplitBadge(currentSplitCount);
            
			const cont = document.getElementById('splitHistoryContent');
            if (!cont) return;

            cont.innerHTML = "<h4 style='color:#555; margin-bottom:10px; border-bottom:1px solid #222; padding-bottom:5px;'>Ostatnie wypłaty:</h4>";
            
            snap.forEach((docSnap) => {
                const d = docSnap.data();
                const id = docSnap.id;
                
                // Sprawdzamy uprawnienia (Admin lub Autor)
                const canDelete = (currentUser && (currentUser.uid === ADMIN_UID || currentUser.uid === d.authorId));
                const delBtn = canDelete ? `<span class="del-split-icon" onclick="deleteSplit('${id}')" style="margin-left:10px; cursor:pointer;">🗑️</span>` : '';

                // Pobieramy kwoty (zabezpieczenie przed starymi wpisami)
                const bShare = d.bossShareEach || 0;
                const tShare = d.teamShareEach || 0;
                const teamNames = (d.team && Array.isArray(d.team)) ? d.team.join(", ") : "Brak ekipy";

                // Informacja o VIPach (jeśli tryb to nie "equal")
                const bossInfo = (d.bosses && d.bosses.length > 0) 
                    ? `<div style="color:gold; font-size:0.9em; margin-top:3px;">👑 VIP: ${d.bosses.join(", ")} (po ${s_formatGold(bShare)})</div>` 
                    : '';

                cont.innerHTML += `
                    <div style="background:rgba(255,255,255,0.03); padding:10px; margin-bottom:10px; border-left:3px solid #00ffff; border-radius: 4px; display:flex; gap:12px; align-items:center;">
                        <div style="width:40px; height:40px; background:#000; border:1px solid #444; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                            <img src="${d.itemImg || 'https://micc.garmory-cdn.cloud/obrazki/itemy/nas/pyt.gif'}" style="max-width:32px; max-height:32px;" onerror="this.src='https://micc.garmory-cdn.cloud/obrazki/itemy/nas/pyt.gif'">
                        </div>

                        <div style="flex-grow:1; font-size:0.85em;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <b style="color:#fff;">${d.item || "Nieznany łup"}</b>
                                <div>
                                    <small style="color:#444;">${new Date(d.date).toLocaleDateString()}</small>
                                    ${delBtn}
                                </div>
                            </div>
                            
                            ${bossInfo}
                            
                            <div style="color:#888; font-size:0.9em; margin-top:2px;">
                                <span style="color:#00ffff;">⚔️</span> ${teamNames} 
                                <b style="color:#2ecc71; margin-left:5px;">+${s_formatGold(tShare)}</b>
                            </div>
                        </div>
                    </div>`;
            });

            if (snap.empty) {
                cont.innerHTML += "<div style='color:#444; text-align:center; padding:10px;'>Historia jest pusta</div>";
            }
        });
    }

	// --- SYSTEM POWIADOMIEŃ DLA PODZIAŁÓW ---
    function updateSplitBadge(currentCount) {
        const badge = document.getElementById('splitBadge');
        // Pobieramy z pamięci przeglądarki, ile podziałów użytkownik widział ostatnio
        const lastCount = parseInt(localStorage.getItem('lastSplitCount') || 0);
        
        if (currentCount > lastCount) {
            const newItems = currentCount - lastCount;
            badge.innerText = newItems;
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }

    // Wywołujemy to, gdy użytkownik otworzy okno (oznacza jako przeczytane)
    window.markSplitsAsRead = (count) => {
        localStorage.setItem('lastSplitCount', count);
        document.getElementById('splitBadge').style.display = 'none';
    };
	
    window.deleteSplit = async (id) => {
        if(confirm("Czy na pewno chcesz usunąć ten podział z historii?")) {
            try {
                await deleteDoc(doc(db, "podzialy", id));
                alert("Usunięto!");
            } catch (e) {
                alert("Błąd: Brak uprawnień lub problem z bazą.");
            }
        }
    };

	// Przełącznik okna ulepszania
    // --- OBSŁUGA EKSTRAKCJI ---
    window.toggleExtract = () => {
        const modal = document.getElementById('extractModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    };

    window.calculateExtraction = () => {
        const pu = parseInt(document.getElementById('extPU').value);
        const rate = parseFloat(document.getElementById('extRate').value);
        const resBox = document.getElementById('extResult');

        if (isNaN(pu) || pu <= 0) return alert("Wpisz poprawną ilość punktów ulepszenia!");

        // 1. Odzyskane PU (zaokrąglone do najbliższej całości)
        const recoveredPU = Math.round(pu * rate);
        // 2. Koszt w złocie: 60 * zainwestowane PU
        const costGold = pu * 60;
        // 3. Koszt w SŁ: 0.001 * zainwestowane PU (zaokrąglone do najbliższej)
        const costSL = Math.round(pu * 0.001);

        resBox.style.display = 'block';
        resBox.innerHTML = `
            <div style="color:#2ecc71; font-weight:bold; margin-bottom:8px; border-bottom:1px solid #333; padding-bottom:5px;">
                Wynik wydobycia (${rate*100}%):
            </div>
            <div style="display:flex; flex-direction:column; gap:5px;">
                <span>✨ Odzyskasz: <b style="color:#fff;">${recoveredPU.toLocaleString()} PU</b></span>
                <span style="color:#aaa; font-size:0.8em; margin-top:5px;">Koszt operacji (do wyboru):</span>
                <span>💰 Złoto: <b style="color:var(--gold);">${s_formatGold(costGold)}</b></span>
                <span>💎 SŁ: <b style="color:#4fffa8;">${costSL} szt.</b></span>
            </div>
            <div style="margin-top:8px; font-size:0.7em; color:#666; font-style:italic;">
                *Zasada zaokrąglania do najbliższej wartości zachowana.
            </div>
        `;
        window.playSound('coin');
    };

    // --- OBSŁUGA ULEPSZANIA ---
    window.toggleUpgrade = () => {
        const modal = document.getElementById('upgradeModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    };

    window.calculateUpgrade = () => {
        const lvl = parseInt(document.getElementById('upLvl').value);
        const rarity = document.getElementById('upRarity').value;
        const target = parseInt(document.getElementById('upTarget').value);
        const resBox = document.getElementById('upResult');

        if (isNaN(lvl) || lvl < 1) return alert("Wpisz poprawny poziom!");

        const e_vals = { common: 1, unique: 10, heroic: 100, legendary: 1000, improved: 0 };
        const n_vals = { common: 1, unique: 10, heroic: 30, improved: 40, legendary: 60 };
        const steps_percents = [0, 1.0, 1.1, 1.3, 1.6, 2.0];

        let e = e_vals[rarity];
        let n = n_vals[rarity];

        // 1. Obliczanie BAZOWEJ wartości PU
        let base_pu = 0;
        if (rarity === 'improved') {
            base_pu = 150 * lvl + 27000;
        } else {
            base_pu = (180 + lvl) * e;
        }

        // 2. Sumowanie procentów
        let total_percent = 0;
        for (let i = 1; i <= target; i++) {
            total_percent += steps_percents[i];
        }

        // 3. Finalne obliczenia z POPRAWKĄ (zaokrąglanie do 10 w dół)
        let raw_pu = Math.floor(base_pu * total_percent);
        
        // Magiczna linijka naprawiająca błąd (398 -> 390):
        let total_pu = Math.floor(raw_pu / 10) * 10; 

        // Złoto i Esencja bez zmian
        let total_gold = (10 * lvl + 1300) * lvl * n;
        let total_essence = Math.round((lvl / 10 + 10) * 3);

        resBox.style.display = 'block';
        resBox.innerHTML = `
            <div style="margin-bottom:8px; border-bottom:1px solid #333; padding-bottom:5px;">
                <span style="color:var(--gold);">Cel:</span> <b>Przedmiot ${lvl}lvl (${rarity}) od +0 do +${target}</b>
            </div>
            <div style="display:flex; flex-direction:column; gap:4px;">
                <span>✨ Wymagane PU: <b style="color:#fff;">${total_pu.toLocaleString()}</b></span>
                <span>💰 Wartość przedmiotu: <b style="color:var(--green);">${s_formatGold(total_gold)}</b></span>
                <span>🔮 Wartość esencji: <b style="color:#cca3ff;">${total_essence} szt.</b></span>
            </div>
            <div style="margin-top:8px; font-size:0.75em; color:#666; font-style:italic;">
                *Obliczenia zakładają ulepszanie od poziomu +0.
            </div>
        `;
        window.playSound('click');
    };
	window.toggleHelp = () => {
        const modal = document.getElementById('helpModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        window.playSound('click');
    };

	// --- SYSTEM ZŁOTE USTA ---
    let quotesUnsub = null;

    window.toggleQuotes = () => {
        const modal = document.getElementById('quotesModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        if(modal.style.display === 'flex') startQuotesListener();
    };

    window.addQuote = async () => {
        if(!currentUser) return alert("Zaloguj się!");
        const content = document.getElementById('quoteContent').value.trim();
        const author = document.getElementById('quoteAuthor').value.trim();

        if(!content || !author) return alert("Wpisz cytat i autora!");

        await addDoc(collection(db, "cytaty"), {
            text: content,
            author: author,
            addedBy: currentNick,
            addedById: currentUser.uid,
            date: new Date().toISOString()
        });

        document.getElementById('quoteContent').value = "";
        document.getElementById('quoteAuthor').value = "";
        window.playSound('coin');
    };

    window.deleteQuote = async (id) => {
        if(confirm("Usunąć ten cytat?")) await deleteDoc(doc(db, "cytaty", id));
    };

    function startQuotesListener() {
        if(quotesUnsub) quotesUnsub();
        
        quotesUnsub = onSnapshot(query(collection(db, "cytaty"), orderBy("date", "desc")), (snap) => {
            const list = document.getElementById('quotesList');
            list.innerHTML = "";
            
            if(snap.empty) {
                list.innerHTML = "<div style='color:#666; text-align:center; width:100%; grid-column:1/-1;'>Księga jest pusta. Dodaj pierwszy wpis!</div>";
                return;
            }

            snap.docs.forEach(d => {
                const data = d.data();
                // Usuwać może admin lub ten kto dodał
                const canDel = (currentUser && (currentUser.uid === ADMIN_UID || currentUser.uid === data.addedById));
                const delBtn = canDel ? `<span class="del-quote-btn" onclick="deleteQuote('${d.id}')">✕</span>` : '';
                
                // Losowy lekki obrót dla realizmu
                const rot = (Math.random() * 2 - 1).toFixed(1); 

                list.innerHTML += `
                    <div class="quote-card" style="transform: rotate(${rot}deg);">
                        ${delBtn}
                        <div class="quote-text">„${window.escapeHtml(data.text)}”</div>
                        <div class="quote-author">— ${window.escapeHtml(data.author)}</div>
                        <div class="quote-date">Dodano: ${new Date(data.date).toLocaleDateString()}</div>
                    </div>
                `;
            });
        });
    }

// --- SYSTEM JACKPOT (WERSJA PANCERNA) ---
    let jackpotUnsub = null;
    let jpTimerInterval = null;
    const JP_GAME_TIME = 60; 

    // Zmienne globalne (muszą być tutaj)
    let jackpotEndTime = 0;
    let timeOffset = 0;

	let currentTier = 'low'; // Domyślny pokój
    let isBettingProcessing = false; // Blokada spamu
    
    // Konfiguracja limitów dla każdego pokoju
    const TIER_CONFIG = {
        low:    { min: 1000000, max: 100000000,  label: "LOW (1m - 100m)", db: "jackpot_low", hist: "history_low" },
        medium: { min: 1000000, max: 500000000,  label: "MEDIUM (1m - 500m)", db: "jackpot_medium", hist: "history_medium" },
        high:   { min: 1000000, max: 10000000000, label: "NON-LIMIT (Max 10g)", db: "jackpot_high", hist: "history_high" }
    };

		window.openJackpot = () => {
        document.getElementById('jackpotModal').style.display = 'flex';
        // Zawsze otwieraj na Low przy starcie, albo zapamiętaj ostatni
        switchJackpotTier('low'); 
    };

window.joinJackpot = async () => {
        if(!currentUser) return alert("Zaloguj się!");
        
        // ANTY-SPAM: Jeśli już trwa wysyłanie, zablokuj
        if(isBettingProcessing) return; 
        
        const input = document.getElementById('jackpotBetAmount');
        const amount = parseGold(input.value);
        const conf = TIER_CONFIG[currentTier]; // Pobierz limity aktualnego pokoju

        // Sprawdzenie limitów pojedynczej wpłaty
        if(amount < conf.min) return alert(`Za mało! W tym pokoju minimum to ${s_formatGold(conf.min)}.`);
        if(amount > conf.max) return alert(`Za dużo! W tym pokoju maksimum to ${s_formatGold(conf.max)}.`);

        // Blokujemy przycisk na chwilę
        isBettingProcessing = true;
        const btn = document.getElementById('joinBtn');
        const originalText = btn.innerText;
        btn.innerText = "⏳...";
        btn.style.opacity = "0.5";

        try {
            // Używamy dynamicznej nazwy kolekcji (jackpot_low, jackpot_medium itd.)
            const jpRef = doc(db, conf.db, "current"); 
            const snap = await getDoc(jpRef);
            
            let data = { status: 'open', entries: [], startTime: null };
            if(snap.exists()) data = snap.data();

            // Limit łączny (zawsze 10g na osobę, dla bezpieczeństwa)
            let myTotalInRound = 0;
            if (data.entries) {
                data.entries.forEach(e => { if (e.uid === currentUser.uid) myTotalInRound += e.amount; });
            }
            if ((myTotalInRound + amount) > 10000000000) {
                throw "Osiągnąłeś globalny limit 10g na rundę.";
            }

            // ... (logika czasu bez zmian, tylko skrócona dla czytelności) ...
            const now = new Date().getTime();
            let isStuck = false;
            if (data.startTime) {
                let startMillis = (data.startTime.toMillis ? data.startTime.toMillis() : (data.startTime.seconds ? data.startTime.seconds*1000 : new Date(data.startTime).getTime()));
                if ((now - startMillis) > 90000) isStuck = true;
            }

            if(data.status !== 'open' && !isStuck) throw "Runda trwa! Poczekaj.";
            if (isStuck) { data.entries = []; data.startTime = null; data.status = 'open'; }

            const newEntry = {
                uid: currentUser.uid,
                nick: currentNick,
                avatar: currentUser.photoURL,
                amount: amount,
                color: getRandomColor()
            };

            const newEntries = [...(data.entries || []), newEntry];
            const uniquePlayers = new Set(newEntries.map(e => e.uid)).size;
            let newStartTime = data.startTime;

            if (uniquePlayers >= 2 && !data.startTime) newStartTime = serverTimestamp(); 
            else if (isStuck && uniquePlayers < 2) newStartTime = null;

            await setDoc(jpRef, { 
                entries: newEntries,
                status: 'open',
                winnerProcessing: false,
                startTime: newStartTime
            }, { merge: true });

            input.value = "";
            window.playSound('coin');

        } catch (error) {
            alert("Błąd: " + error);
        } finally {
            // Odblokuj przycisk po 1 sekudzie (dodatkowe zabezpieczenie przed double-click)
            setTimeout(() => {
                isBettingProcessing = false;
                btn.innerText = originalText;
                btn.style.opacity = "1";
            }, 1000);
        }
    };

    function startJackpotListener() {
        if(jackpotUnsub) jackpotUnsub();
        
        const conf = TIER_CONFIG[currentTier]; // Pobierz konfig dla obecnego pokoju
        
        // Nasłuchujemy odpowiedniej kolekcji (jackpot_low, jackpot_medium lub jackpot_high)
        jackpotUnsub = onSnapshot(doc(db, conf.db, "current"), (docSnap) => {
            if(!docSnap.exists()) {
                // Jeśli dokument nie istnieje, tworzymy go (pierwsze odpalenie)
                renderJackpotUI({entries: []});
                return;
            }
            const data = docSnap.data();
            
            if(docSnap.readTime) {
                timeOffset = docSnap.readTime.toMillis() - new Date().getTime(); 
            }

            renderJackpotUI(data);
            const timerEl = document.getElementById('jackpotTimer');

            if(data.status === 'open' && data.startTime) {
                // ... (logika czasu taka sama jak wcześniej) ...
                let startMillis = (data.startTime.toMillis ? data.startTime.toMillis() : (data.startTime.seconds ? data.startTime.seconds*1000 : new Date(data.startTime).getTime()));
                if (startMillis > 0) {
                    jackpotEndTime = startMillis + (JP_GAME_TIME * 1000);
                    timerEl.style.display = 'block';
                }
            } else {
                jackpotEndTime = 0;
                timerEl.style.display = 'none';
            }

            if(data.status === 'spinning' && !document.getElementById('jackpotStrip').classList.contains('spinning')) {
                timerEl.style.display = 'none';
                spinTheWheel(data.winner, data.entries);
            }
            
            if(data.status === 'open' && document.getElementById('jackpotStrip').classList.contains('spun')) {
                 resetJackpotVisuals();
            }
        });
        
        // Interwał timera bez zmian...
        if(jpTimerInterval) clearInterval(jpTimerInterval);
        jpTimerInterval = setInterval(() => {
             if (!jackpotEndTime) return;
             const nowSynced = new Date().getTime() + timeOffset;
             const diff = jackpotEndTime - nowSynced; 
             const timerEl = document.getElementById('jackpotTimer');

             if (diff > 0) {
                 let seconds = diff / 1000;
                 if (seconds > JP_GAME_TIME) seconds = JP_GAME_TIME;
                 timerEl.innerText = seconds.toFixed(2) + "s";
             } else {
                 timerEl.innerText = "LOSOWANIE...";
                 if (diff > -2000 && diff < 0) {
                     // Sprawdź dokument w aktualnym pokoju
                     const conf = TIER_CONFIG[currentTier];
                     getDoc(doc(db, conf.db, "current")).then(snap => {
                         const d = snap.data();
                         if(d && d.status === 'open' && !d.winnerProcessing) finalizeJackpot();
                     });
                 }
             }
        }, 50);
    }

    function renderJackpotUI(data) {
        const list = document.getElementById('jackpotPlayersList');
        const poolEl = document.getElementById('jackpotTotalPool');
        
        let total = 0;
        if(data.entries) data.entries.forEach(e => total += e.amount);
        poolEl.innerText = s_formatGold(total);

        list.innerHTML = "";
        if(!data.entries) return;

        let players = {};
        data.entries.forEach(e => {
            if(!players[e.uid]) players[e.uid] = { nick: e.nick, amount: 0, avatar: e.avatar, color: e.color };
            players[e.uid].amount += e.amount;
        });

        Object.values(players).sort((a,b) => b.amount - a.amount).forEach(p => {
            const percent = total > 0 ? ((p.amount / total) * 100).toFixed(1) : 0;
            list.innerHTML += `
                <div class="jp-row" style="border-left: 4px solid ${p.color}">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <img src="${p.avatar}" style="width:24px; height:24px; border-radius:50%;">
                        <span>${p.nick}</span>
                    </div>
                    <div style="text-align:right;">
                        <div style="color:var(--gold);">${s_formatGold(p.amount)}</div>
                        <div style="font-size:0.8em; color:#666;">${percent}%</div>
                    </div>
                </div>
            `;
        });
    }

async function finalizeJackpot() {
        const conf = TIER_CONFIG[currentTier];
        const jpRef = doc(db, conf.db, "current"); // Dynamiczna ścieżka

        try {
            await runTransaction(db, async (transaction) => {
                const sfDoc = await transaction.get(jpRef);
                if (!sfDoc.exists()) throw "Dokument nie istnieje!";
                const data = sfDoc.data();

                if (data.status !== 'open' || data.winnerProcessing) throw "Już wylosowano!";

                transaction.update(jpRef, { winnerProcessing: true });

                let total = 0;
                data.entries.forEach(e => total += e.amount);
                let randomPoint = Math.random() * total;
                let winner = null;
                let currentStack = 0;
                
                for(let e of data.entries) {
                    currentStack += e.amount;
                    if(randomPoint <= currentStack) { winner = e; break; }
                }

                transaction.update(jpRef, {
                    status: 'spinning',
                    winner: winner,
                    winnerTotal: total 
                });
            });
        } catch (e) { console.log(e); }
    }

    function spinTheWheel(winner, entries) {
        const strip = document.getElementById('jackpotStrip');
        const rail = document.querySelector('.jackpot-rail');
        strip.classList.add('spinning');
        
        const CARD_WIDTH = 80; 
        const MARGIN = 4;      
        const FULL_CARD = CARD_WIDTH + MARGIN; 
        const WINNER_INDEX = 75; 
        
        strip.innerHTML = "";
        strip.style.transition = "none";
        strip.style.transform = "translateX(0px)";

        let cardsHtml = "";
        for(let i=0; i < 100; i++) {
            let entry;
            if(i === WINNER_INDEX) {
                entry = winner; 
            } else {
                entry = entries.length > 0 ? entries[Math.floor(Math.random() * entries.length)] : {avatar:'', color:'#333'};
            }
            
            cardsHtml += `
                <div class="jp-card" style="width:80px; height:80px; margin:0 2px; flex-shrink:0; border-bottom: 4px solid ${entry.color || '#333'}; background:#222; border:2px solid #444; display:flex; align-items:center; justify-content:center;">
                    <img src="${entry.avatar}" style="width:100%; height:100%; object-fit:cover;" onerror="this.style.display='none'">
                </div>
            `;
        }
        strip.innerHTML = cardsHtml;

        document.getElementById('jackpotControls').style.display = 'none';

        setTimeout(() => {
            const containerWidth = rail.offsetWidth;
            const centerPosition = - (WINNER_INDEX * FULL_CARD) + (containerWidth / 2) - (FULL_CARD / 2);
            const jitter = Math.floor(Math.random() * 50) - 25; 
            const finalPosition = centerPosition + jitter;

            strip.style.transition = "transform 8s cubic-bezier(0.15, 0, 0.10, 1)"; 
            strip.style.transform = `translateX(${finalPosition}px)`;
            window.playSound('coin'); 
        }, 100);

        setTimeout(async () => {
            strip.classList.add('spun');
			showWinnerScreen(winner, entries);    
			
            if (currentUser && (currentUser.uid === winner.uid || currentNick === ADMIN_NICK)) {
                setTimeout(async () => {
                    await setDoc(doc(db, "jackpot", "current"), {
                        status: 'open',
                        entries: [],
                        startTime: null,
                        winner: null,
                        winnerProcessing: false
                    });
                }, 10000);
            }
        }, 8500);
    }

		function showWinnerScreen(winner, entries) {
        for(let i=0; i<20; i++) createEmber(); 
        
        document.getElementById('jackpotWinnerDisplay').style.display = 'block';
        document.getElementById('winnerNick').innerText = winner.nick;
        const totalStr = document.getElementById('jackpotTotalPool').innerText;
        
        // --- OBLICZANIE DŁUGÓW ---
        let debts = {};
        if (entries && entries.length > 0) {
            entries.forEach(e => {
                if (e.uid !== winner.uid) {
                    if (!debts[e.nick]) debts[e.nick] = 0;
                    debts[e.nick] += e.amount;
                }
            });
        }
        // -------------------------

        // Renderowanie listy dla "Tu i Teraz"
        let debtorsListHtml = "";
        const sortedDebtors = Object.keys(debts).sort((a,b) => debts[b] - debts[a]);
        
        if (sortedDebtors.length > 0) {
            debtorsListHtml += `<div style="margin-top:15px; border-top:1px dashed #555; padding-top:10px;">`;
            debtorsListHtml += `<div style="color:#aaa; font-size:0.8em; margin-bottom:5px; text-transform:uppercase;">Do odebrania od:</div>`;
            
            // Scroll dla długiej listy
            debtorsListHtml += `<div style="max-height: 150px; overflow-y: auto; padding-right: 5px;">`; 
            
            sortedDebtors.forEach(nick => {
                debtorsListHtml += `
                    <div style="display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.05); padding:4px 0;">
                        <span style="color:#fff;">${nick}</span>
                        <span style="color:#ff6666; font-weight:bold;">${s_formatGold(debts[nick])}</span>
                    </div>`;
            });
            
            debtorsListHtml += `</div>`; 
            debtorsListHtml += `</div>`; 
        } else {
            debtorsListHtml = `<div style="color:#666; font-size:0.8em; margin-top:10px;">(Wygrałeś własne wpłaty)</div>`;
        }

        document.getElementById('winAmount').innerHTML = `
            <div style="font-size:1.2em; color:var(--green); margin-bottom:10px;">Wygrywa pulę: <b>${totalStr}</b></div>
            ${debtorsListHtml}
        `;
        
        // Zapis do bazy (Zwycięzca)
        if(currentUser && currentUser.uid === winner.uid) { 
             
             // 1. Czat
             addDoc(collection(db, "chat"), {
                nick: "System Jackpot",
                text: `🎰 ${winner.nick} rozbił bank! Zgarnia: ${totalStr}!`,
                type: 'roll',
                date: new Date().toISOString()
            });

            // 2. Historia (POPRAWIONE: Zapisujemy tylko raz do właściwego pokoju)
            const conf = TIER_CONFIG[currentTier]; 
            const debtsToSave = debts || {}; 

            addDoc(collection(db, conf.hist), {
                nick: winner.nick,
                amount: totalStr,
                avatar: winner.avatar,
                date: new Date().toISOString(),
                debts: debtsToSave
            });
            
            // 3. Reset gry (po 10 sekundach)
            setTimeout(async () => {
                 await setDoc(doc(db, conf.db, "current"), {
                    status: 'open', entries: [], startTime: null, winner: null, winnerProcessing: false
                });
            }, 10000);
        }
    }
			
        
    
    function resetJackpotVisuals() {
        document.getElementById('jackpotStrip').style.transition = 'none';
        document.getElementById('jackpotStrip').style.transform = 'translateX(0)';
        document.getElementById('jackpotStrip').innerHTML = '';
        document.getElementById('jackpotStrip').classList.remove('spinning', 'spun');
        document.getElementById('jackpotWinnerDisplay').style.display = 'none';
        document.getElementById('jackpotControls').style.display = 'block';
    }

    function getRandomColor() {
        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#f1c40f', '#e67e22'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

	let historyUnsub = null;
    window.jackpotHistoryData = []; // Magazyn na dane

    function startJackpotHistoryListener() {
        if(historyUnsub) historyUnsub();
        
        const conf = TIER_CONFIG[currentTier];
        // Pobieramy historię z odpowiedniej kolekcji (history_low, history_medium...)
        const q = query(collection(db, conf.hist), orderBy("date", "desc"), limit(10));
        
        historyUnsub = onSnapshot(q, (snap) => {
            const div = document.getElementById('jackpotHistoryList');
            div.innerHTML = "";
            window.jackpotHistoryData = [];
            
            if(snap.empty) {
                div.innerHTML = "<div style='text-align:center; color:#444; padding:10px; font-size:0.8em;'>Brak historii w tym pokoju.</div>";
                return;
            }

            let index = 0;
            snap.forEach(d => {
                const h = d.data();
                window.jackpotHistoryData.push(h);
                const date = new Date(h.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                div.innerHTML += `
                    <div onclick="openHistoryDetails(${index})" style="cursor:pointer; display:flex; justify-content:space-between; align-items:center; padding:8px; border-bottom:1px solid rgba(255,255,255,0.05); font-size:0.85em; transition:0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <img src="${h.avatar}" style="width:24px; height:24px; border-radius:50%; border:1px solid #444;">
                            <span style="color:#aaa; font-weight:bold;">${window.escapeHtml(h.nick)}</span>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:var(--green); font-weight:bold;">${h.amount}</div>
                            <div style="color:#555; font-size:0.8em;">${date}</div>
                        </div>
                    </div>`;
                index++;
            });
        });
    }

	window.openHistoryDetails = (index) => {
        const data = window.jackpotHistoryData[index];
        if(!data) return;

        // Wypełniamy Modal
        document.getElementById('histDetNick').innerText = data.nick;
        document.getElementById('histDetAmount').innerText = data.amount;
        document.getElementById('histDetAvatar').src = data.avatar;

        const listDiv = document.getElementById('histDetList');
        listDiv.innerHTML = "";

        // Sprawdzamy czy są zapisane długi (stare wpisy ich nie mają)
        if (data.debts && Object.keys(data.debts).length > 0) {
            const sorted = Object.keys(data.debts).sort((a,b) => data.debts[b] - data.debts[a]);
            sorted.forEach(nick => {
                listDiv.innerHTML += `
                    <div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding:5px;">
                        <span style="color:#ccc;">${window.escapeHtml(nick)}</span>
                        <span style="color:#ff6666;">${s_formatGold(data.debts[nick])}</span>
                    </div>
                `;
            });
        } else {
            listDiv.innerHTML = "<div style='text-align:center; color:#555; font-style:italic;'>Brak danych o dłużnikach (stary wpis lub wygrana własna).</div>";
        }

        // Pokazujemy okno
        document.getElementById('historyDetailsModal').style.display = 'flex';
        window.playSound('click');
    };
	
	window.toggleSidebar = () => {
        const sidebar = document.getElementById('rightSidebar');
        const btn = document.querySelector('.sidebar-toggle-main');
        
        // Przełącz klasę
        sidebar.classList.toggle('sidebar-hidden');
        
        // Zmień ikonkę oka (opcjonalnie)
        if (sidebar.classList.contains('sidebar-hidden')) {
            btn.innerText = '◀'; // Strzałka, że można wysunąć
            btn.style.borderColor = '#00ffff'; // Podświetlenie
        } else {
            btn.innerText = '👁️'; // Oko, że widoczne
            btn.style.borderColor = '#555';
        }
        
        window.playSound('click');
    };

	window.switchJackpotTier = (tier) => {
        currentTier = tier;
        
        // 1. Zmiana wyglądu zakładek
        document.querySelectorAll('.jp-tab').forEach(t => t.className = 'jp-tab');
        let activeClass = (tier === 'low') ? 'active-low' : (tier === 'medium') ? 'active-mid' : 'active-high';
        document.getElementById(`tab-${tier}`).classList.add(activeClass);

        // 2. Aktualizacja napisów limitów
        const conf = TIER_CONFIG[tier];
        document.getElementById('poolLabel').innerText = tier.toUpperCase();
        document.getElementById('limitLabel').innerText = `Limit: ${s_formatGold(conf.min)} - ${s_formatGold(conf.max)}`;

        // 3. Reset widoku
        resetJackpotVisuals();
        document.getElementById('jackpotTotalPool').innerText = "0";
        document.getElementById('jackpotPlayersList').innerHTML = "<div style='padding:10px;text-align:center;color:#666'>Wczytywanie pokoju...</div>";

        // 4. Przełączenie nasłuchiwania bazy (Kluczowe!)
        startJackpotListener(); 
        startJackpotHistoryListener();
    };
	
</script>

<div id="toast-container"></div>
</body>
</html>

